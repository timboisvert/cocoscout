<% content_for :title, "Schedule an In-person Session" %>

<div class="w-full">
  <%= render partial: "shared/notice", locals: { notice: notice } %>


  <% if @audition.nil? %>

    <%= render partial: "shared/top_menu", locals: {
        breadcrumbs: [
          ["Auditions", manage_production_auditions_path(@production)],
          ["In-person Sessions", manage_production_audition_sessions_path(@production)]
        ],
        text: "#{@audition_session.start_at.strftime("%-m/%-d/%Y at %-l:%M %p")}",
        links: [
          {
            text: "Manage In-person Sessions",
            path: manage_production_audition_sessions_path(@production)
          }
        ]
      }
    %>

    <div class="w-full h-full flex items-center justify-center text-center text-sm text-gray-500" style="min-height: 60vh;">
      Select an auditionee below to view their Sign-up
    </div>

  <% else %>

    <%= render partial: "shared/top_menu", locals: {
        breadcrumbs: [
          ["Auditions", manage_production_auditions_path(@production)],
          ["In-person Sessions", manage_production_audition_sessions_path(@production)],
          ["#{@audition_session.start_at.strftime("%-m/%-d/%Y at %-l:%M %p")}", manage_production_audition_session_path(@production, @audition_session)]
        ],
        text: "#{@person.name}",
        links: [
          {
            text: "Manage In-person Sessions",
            path: manage_production_audition_sessions_path(@production)
          }
        ]
      }
    %>

    <div class="w-full" data-controller="tabs">
      <nav class="flex flex-wrap gap-2 border-b border-gray-200 mb-4">
        <button type="button" data-tabs-target="tab" data-index="0" data-action="tabs#select" class="px-3 lg:px-4 py-2 text-xs lg:text-sm font-medium bg-white border-b-2 text-pink-600 cursor-pointer whitespace-nowrap">Profile</button>
        <button type="button" data-tabs-target="tab" data-index="1" data-action="tabs#select" class="px-3 lg:px-4 py-2 text-xs lg:text-sm font-medium bg-gray-50 border-b-2 text-gray-500 cursor-pointer whitespace-nowrap">Resume</button>
        <button type="button" data-tabs-target="tab" data-index="2" data-action="tabs#select" class="px-3 lg:px-4 py-2 text-xs lg:text-sm font-medium bg-gray-50 border-b-2 text-gray-500 cursor-pointer whitespace-nowrap">Sign-up Questions</button>
        <button type="button" data-tabs-target="tab" data-index="3" data-action="tabs#select" class="px-3 lg:px-4 py-2 text-xs lg:text-sm font-medium bg-gray-50 border-b-2 text-gray-500 cursor-pointer whitespace-nowrap">Casting</button>
      </nav>

      <div data-tabs-target="panel">
        <%= render "shared/person_card", person: @person %>
      </div>

      <div data-tabs-target="panel" class="hidden">
        <% resume_preview = @person.safe_resume_preview(resize_to_limit: [1224, 1584]) %>
        <% if resume_preview %>
          <div class="w-full">
            <%= image_tag resume_preview, class: "object-contain" %>
          </div>
        <% else %>
          <p class="text-center mt-10">No resume found</p>
        <% end %>
      </div>

      <div data-tabs-target="panel" class="hidden">
        <% if @answers.any? %>
          <div class="mt-2">
            <%= render "manage/audition_requests/answers", answers: @answers %>
          </div>
        <% else %>
          <p class="text-center mt-10">No sign-up questions answered</p>
        <% end %>
      </div>

      <div data-tabs-target="panel" class="hidden">
        <div class="mt-2">
          <%= render "manage/casts/cast_membership_card", production: @production, person: @person %>
        </div>
      </div>

    </div>

  <% end %>

</div>

<%# Bottom Navigation Bar %>
<div class="fixed bottom-0 left-0 w-full lg:h-[84px] bg-white text-pink-500 p-2 pb-1 border-t-4 border-pink-500 lg:pl-56">

  <div class="flex justify-start lg:justify-center gap-1 flex-wrap">
      <% @audition_session.auditions.each do |audition| %>
        <%= link_to manage_production_audition_session_audition_path(@production, @audition_session, audition), class: "flex flex-col items-center rounded-lg" do %>
          <div
            data-controller="tooltip"
            data-tooltip-text="<%= audition.person.name.truncate(40, omission: "...") %>"
          >
            <% headshot_variant = audition.person.safe_headshot_variant(:thumb) %>
            <% if headshot_variant %>
              <%= image_tag headshot_variant, alt: audition.person.name, class: "w-12 h-12 lg:w-16 lg:h-16 rounded-lg object-cover" %>
            <% else %>
              <div class="w-12 h-12 lg:w-16 lg:h-16 rounded-lg bg-gray-300 flex items-center justify-center text-white font-bold text-xs lg:text-base">
                <%= audition.person.initials %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>

  </div>


</div>