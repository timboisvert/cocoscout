<%#
  Shared Audition Session Row Component

  Required params:
    - audition_session: AuditionSession object

  Optional params:
    - link_path: Path to link to (if nil, renders as div)
    - show_entity_headshots: Whether to show the entity headshot column (default: false)
    - entity: Entity to show headshot for (default: nil)
    - audition: Audition object to show acceptance status for (default: nil)
%>

<%
  # Set defaults for optional params
  show_entity_headshots = local_assigns.fetch(:show_entity_headshots, false)
  has_link = local_assigns[:link_path].present?
  production = audition_session.production
  audition = local_assigns[:audition]
%>

<%# Row wrapper - either link or div %>
<% row_classes = "flex bg-white items-center gap-4 px-3 py-2 border border-gray-200 rounded-lg hover:border-gray-400 transition-all" %>

<% content = capture do %>
  <%# Date Box %>
  <div class="flex-shrink-0 w-14 text-center">
    <div class="text-xs font-semibold text-pink-600 uppercase"><%= audition_session.start_at.strftime("%b") %></div>
    <div class="text-2xl font-bold text-gray-900"><%= audition_session.start_at.strftime("%-d") %></div>
    <div class="text-xs text-gray-500"><%= audition_session.start_at.strftime("%a") %></div>
  </div>

  <%# Audition Details %>
  <div class="flex-1 min-w-0">
    <div class="flex items-center gap-2 flex-wrap">
      <span class="font-medium text-gray-900"><%= production.name %></span>
      <span class="inline-flex items-center rounded-md bg-purple-50 px-2 py-1 text-xs font-medium text-purple-700 ring-1 ring-inset ring-purple-600/10">Audition</span>
      <% if audition.present? %>
        <% if audition.accepted? %>
          <span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/10">Confirmed</span>
        <% elsif audition.declined? %>
          <span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">Declined</span>
        <% else %>
          <span class="inline-flex items-center rounded-md bg-amber-50 px-2 py-1 text-xs font-medium text-amber-700 ring-1 ring-inset ring-amber-600/10">Pending</span>
        <% end %>
      <% end %>
    </div>
    <div class="text-sm text-gray-600">
      <%= audition_session.start_at.strftime("%l:%M %p").strip %>
      <% if audition_session.location.present? %>
        Â· <%= audition_session.location.name %>
      <% end %>
    </div>
  </div>

  <% if show_entity_headshots && local_assigns[:entity].present? %>
    <% headshot = entity.safe_headshot_variant(:thumb) %>
    <% if headshot %>
      <div class="flex-shrink-0 ml-2">
        <%= image_tag headshot, class: "w-10 h-10 rounded-lg object-cover", alt: entity.name %>
      </div>
    <% end %>
  <% end %>
<% end %>

<% if has_link %>
  <%= link_to link_path, class: "block" do %>
    <div class="<%= row_classes %>">
      <%= content %>
    </div>
  <% end %>
<% else %>
  <div class="<%= row_classes %>">
    <%= content %>
  </div>
<% end %>
