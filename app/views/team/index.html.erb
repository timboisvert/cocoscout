<% content_for :title, "Team" %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Team",
    links: []
  } %>

<div class="flex flex-col md:flex-row gap-2 mt-4">

    <div class="flex-1">

        <% @members.each do |member| %>

            <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex">
                <div class="w-2/3" >
                    <p class="font-bold text-lg"><%= member.email_address %></p>
                    <p class="text-sm text-gray-500">Role</p>
                </div>
                <div class="w-1/3 flex items-center" data-controller="team-role">
                    <span data-team-role-target="success" class="hidden mr-2 text-green-600">&#10003;</span>
                    <select
                        name="role"
                        class="border rounded-lg px-2 py-1"
                        data-team-role-target="select"
                        data-user-id="<%= member.id %>"
                        data-url="<%= update_role_team_index_path %>"
                        data-action="change->team-role#change"
                    >
                        <option value="member" <%= 'selected' if member.role_for_company(Current.production_company) == 'member' %>>Member</option>
                        <option value="admin" <%= 'selected' if member.role_for_company(Current.production_company) == 'admin' %>>Admin</option>
                    </select>
                </div>
            </div>


        <% end %>

    </div>

    <div class="flex-1 space-y-2">

        <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all">
            <h2 class="text-lg font-semibold mb-2">Invite a Team Member</h2>

            <% if @invitation_error %>
                <p class="text-sm text-pink-500 mb-2">Email address is required</p>
            <% end %>

            <%= form_with(model: @invitation, url: invite_team_index_path, method: :post) do |f| %>
                <div class="flex gap-2 items-center">
                    <%= f.email_field :email, placeholder: "Email address", class: "block shadow-sm rounded-lg border px-3 py-2 border-gray-400 focus:outline-pink-500 flex-1 w-full" %>
                    <%= f.submit "Send Invite", class: "px-3 py-2 rounded-lg bg-pink-500 text-white font-bold hover:bg-pink-600 cursor-pointer" %>
                </div>
            <% end %>
        </div>

        <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all">
            <h2 class="text-lg font-semibold mb-2">Pending Invitations</h2>

            <% if @invitations.any? %>
                <% @invitations.each do |invite| %>
                    <div class="flex items-center mb-2">
                        <span><%= invite.email %></span>
                        <%= button_to "Revoke", revoke_invite_team_index_path(id: invite.id), method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "text-xs text-pink-500 underline ml-2 cursor-pointer" %>
                    </div>
                <% end %>
            <% else %>
                <p class="text-sm text-gray-500">You don't currently have any pending invitations.</p>
            <% end %>
        </div>

    </div>

  </div>

</div>
