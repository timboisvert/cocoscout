<header class="hidden lg:flex fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 items-center justify-between z-50">
  <div class="flex items-center">
    <%= render "shared/navigation/dashboard_selector", current_dashboard: "production" %>
  </div>

  <div class="flex items-center mr-2 border-l border-slate-200 h-12">
    <!-- User Profile and Impersonation Banner -->
    <div class="flex items-center gap-3">
      <% if impersonating? %>
        <div class="flex items-center gap-3 bg-pink-100 border border-pink-300 px-4 py-2 rounded-lg">
          <div class="flex flex-col">
            <div class="text-xs font-semibold text-pink-800 uppercase">Impersonating</div>
            <div class="text-sm font-medium text-pink-900"><%= Current.user.person&.name || Current.user.email_address %></div>
          </div>
          <%= button_to stop_impersonating_user_path, method: :post, class: "px-3 py-1 rounded-md bg-pink-600 text-white font-semibold text-sm hover:bg-pink-700 transition cursor-pointer" do %>
            Stop
          <% end %>
        </div>
      <% end %>

      <div class="relative" data-controller="dropdown">
        <button data-action="click->dropdown#toggle click@window->dropdown#hide" class="flex items-center gap-3 hover:bg-slate-50 rounded-lg px-3 py-2 transition cursor-pointer h-12">
          <% if Current.user.person&.headshot&.attached? %>
            <%= image_tag Current.user.person.headshot, class: "w-8 h-8 rounded-lg object-cover" %>
          <% else %>
            <div class="w-8 h-8 rounded-lg bg-pink-100 text-pink-500 flex items-center justify-center font-semibold text-sm">
              <%= Current.user.person&.name&.split&.map(&:first)&.join&.upcase || Current.user.email_address[0].upcase %>
            </div>
          <% end %>
          <div class="flex flex-col items-start">
            <div class="text-sm font-medium text-slate-700"><%= Current.user.person&.name || Current.user.email_address %></div>
            <div class="text-xs text-slate-500"><%= Current.user.email_address %></div>
          </div>
          <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div data-dropdown-target="menu" class="hidden absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-lg border border-slate-200 py-1">
          <%= link_to "My Profile", profile_path, class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition cursor-pointer" %>

          <% if Current.organization.present? %>
            <div class="border-t border-slate-200 my-1"></div>

            <!-- Productions Section -->
            <div class="px-4 py-3">
              <div class="text-xs text-slate-500 font-semibold uppercase mb-2">Productions</div>
              <div class="flex flex-col gap-1">
                <%= link_to "Manage Productions", manage_productions_path, class: "text-xs text-pink-500 hover:text-pink-600 underline" %>
                <% if current_user_is_global_manager? %>
                  <%= link_to "Add a Production", new_manage_production_path, class: "text-xs text-pink-500 hover:text-pink-600 underline" %>
                <% end %>
              </div>
            </div>

            <!-- Organization Section -->
            <div class="px-4 py-3 border-t border-slate-100">
              <div class="text-xs text-slate-500 font-semibold uppercase mb-2">Organization</div>
              <div class="flex items-center justify-between mb-2">
                <div class="text-sm text-slate-900 font-medium"><%= Current.organization.name %></div>
              </div>
              <div class="flex flex-col gap-1">
                <% if current_user_is_global_manager? %>
                  <%= link_to "Manage this Organization", manage_organization_path(Current.organization), class: "text-xs text-pink-500 hover:text-pink-600 underline" %>
                <% end %>
                <% if Current.user.organizations.count > 1 %>
                  <%= link_to "Switch Organization", select_organization_path, class: "text-xs text-pink-500 hover:text-pink-600 underline" %>
                <% end %>
                <%= link_to "All My Organizations", manage_organizations_path, class: "text-xs text-pink-500 hover:text-pink-600 underline" %>
              </div>
            </div>
          <% end %>

          <% if Current.user.superadmin? %>
            <div class="border-t border-slate-200 my-1"></div>
            <%= link_to "Superadmin", superadmin_path, class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition cursor-pointer" %>
          <% end %>

          <div class="border-t border-slate-200 my-1"></div>

          <%= link_to "My Account", account_path, class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition cursor-pointer" %>
          <%= link_to "Sign Out", signout_path, data: { turbo_prefetch: false }, class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition cursor-pointer" %>
        </div>
      </div>
    </div>
  </div>
</header>
