<% content_for :title, "Money - #{@production.name}" %>

<%
  money_description = <<~HTML
    <p>
      This is your production's financial hub â€” the central place to track revenue, manage payouts,
      and understand your show economics.
    </p>
    <p>
      Use <strong>Financials</strong> to enter and track revenue data for each show.
      Use <strong>Payouts</strong> to calculate and distribute payments to your cast and crew.
    </p>
  HTML

  money_actions = [
    { icon: "chart-bar", text: "Financials", description: "Track revenue and costs for each show", path: manage_production_money_financials_path(@production) },
    { icon: "dollar-sign", text: "Payouts", description: "Calculate and distribute payments", path: manage_production_money_payouts_path(@production) }
  ]
%>

<div class="w-full mb-10" data-controller="money-filter">
  <%= render partial: "shared/notice", locals: { notice: notice, alert: alert } %>

  <%= render "shared/module_header",
    title: "Money",
    description: money_description,
    actions: money_actions
  %>

  <%# Shows & Events List with Filters %>
  <div class="border-t border-gray-200 pt-4 mt-2" data-controller="money-filter">
    <%# Filter Bar with toggle %>
    <%= render "shared/filters/filter_bar", bare: true, filter_groups: [
      {
        label: "Status",
        filters: [
          { text: "All", path: manage_production_money_index_path(@production, filter: "all", period: @selected_period), active: @filter == "all" },
          { text: "Awaiting Financials", path: manage_production_money_index_path(@production, filter: "awaiting_financials", period: @selected_period), active: @filter == "awaiting_financials" },
          { text: "Awaiting Calculation", path: manage_production_money_index_path(@production, filter: "awaiting_calculation", period: @selected_period), active: @filter == "awaiting_calculation" },
          { text: "Awaiting Payout", path: manage_production_money_index_path(@production, filter: "awaiting_payout", period: @selected_period), active: @filter == "awaiting_payout" },
          { text: "Paid", path: manage_production_money_index_path(@production, filter: "paid", period: @selected_period), active: @filter == "paid" }
        ]
      },
      { separator: true },
      {
        partial: "shared/filters/toggle_filter",
        locals: {
          label: "Hide Non-revenue Events",
          active: @hide_non_revenue,
          toggle_action: "click->money-filter#toggle"
        }
      }
    ] %>

    <% if @shows.any? %>
      <div class="space-y-2">
        <% @shows.each do |show| %>
          <%= render partial: "manage/payouts/money_show_row", locals: { show: show, production: @production, hide_non_revenue: @hide_non_revenue } %>
        <% end %>
      </div>
    <% else %>
      <div class="bg-gray-50 rounded-lg border border-dashed border-gray-300 p-8 text-center">
        <p class="text-gray-600">
          <% if @filter == "all" %>
            No past shows yet. Shows & events will appear here after they occur.
          <% elsif @filter == "awaiting_financials" %>
            All revenue events have financial data entered.
          <% elsif @filter == "awaiting_calculation" %>
            No shows awaiting calculation.
          <% elsif @filter == "awaiting_payout" %>
            No shows awaiting payout.
          <% elsif @filter == "paid" %>
            No paid shows yet.
          <% else %>
            No shows with this status.
          <% end %>
        </p>
      </div>
    <% end %>
  </div>
</div>
