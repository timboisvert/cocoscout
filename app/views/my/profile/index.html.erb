<% content_for :title, "Profile" %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Profile",
    links: [
        {
          text: "Edit Profile",
          path: profile_path
        }
      ]
  } %>


    <div class="md:flex-1 flex flex-col p-4">
        <h2 class="text-3xl font-bold"><%= Current.user.person.name %></h2>
        <p class="text-gray-500 mb-4 text-sm"><%= Current.user.person.pronouns %></p>

        <div class="flex items-center space-x-2 border-gray-200">
            <svg width="20" height="20" class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
            <%= mail_to Current.user.person.email, Current.user.person.email, class: "text-pink-500 text-sm hover:underline" %>
        </div>

        <div class="space-y-1 mt-1">
            <% Current.user.person.socials.each do |social| %>
                <div class="flex items-center space-x-2">
                    <%= social.icon(20) %>
                    <%= link_to social.handle, social.url, class: "text-pink-500 text-sm hover:underline", target: "_blank", rel: "noopener" %>
                </div>
            <% end %>
        </div>
    </div>

    <div class="flex flex-col md:flex-row w-full gap-8">
        <div class="p-4 md:w-1/2 justify-top items-start">
            <%= render partial: "shared/top_menu", locals: {
                breadcrumbs: [],
                text: "My Headshot",
                links: []
            } %>
            <% if Current.user.person.headshot.attached? %>
                <%= image_tag url_for(Current.user.person.headshot), class: "rounded-lg object-contain" %>
            <% else %>
                <p class="text-gray-500 text-sm">No headshot uploaded</p>
            <% end %>
        </div>
        <div class="p-4 md:w-1/2">
            <%= render partial: "shared/top_menu", locals: {
                breadcrumbs: [],
                text: "My Resume",
                links: []
            } %>
            <% if Current.user.person.resume.attached? %>
                <% resume_preview = Current.user.person.safe_resume_preview(resize_to_limit: [1224, 1584]) %>
                <% if resume_preview %>
                    <div class="w-full">
                        <%= image_tag resume_preview, class: "w-full object-contain" %>
                    </div>
                <% end %>
            <% else %>
                <p class="text-gray-500 text-sm">No resume uploaded</p>
            <% end %>
        </div>
    </div>

    <!-- Groups Section -->
    <div class="p-4">
        <%= render partial: "shared/top_menu", locals: {
            breadcrumbs: [],
            text: "My Groups & Ensembles",
            links: [
              {
                text: "Manage Groups",
                path: my_groups_path
              }
            ]
        } %>
        <% user_groups = Current.user.person.groups.where(archived_at: nil).order(:name) %>
        <% if user_groups.any? %>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
                <% user_groups.each do |group| %>
                    <%= link_to public_profile_path(group.public_key), class: "block" do %>
                        <div class="border border-gray-200 rounded-lg p-4 hover:border-pink-500 transition-all">
                            <div class="flex items-center gap-3">
                                <% if group.headshot.attached? %>
                                    <%= image_tag group.safe_headshot_variant(:thumb), class: "w-12 h-12 rounded-lg object-cover" %>
                                <% else %>
                                    <div class="w-12 h-12 rounded-lg bg-gray-200 flex items-center justify-center text-gray-600 font-bold text-xs">
                                        <%= group.name.split.map(&:first).join.upcase %>
                                    </div>
                                <% end %>
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-gray-900 truncate"><%= group.name %></div>
                                    <div class="text-xs text-gray-500"><%= pluralize(group.members.count, 'member') %></div>
                                </div>
                            </div>
                        </div>
                    <% end %>
                <% end %>
            </div>
        <% else %>
            <p class="text-gray-500 text-sm mt-4">You're not part of any groups yet. <%= link_to "Create a group", my_new_group_path, class: "text-pink-500 hover:underline" %></p>
        <% end %>
    </div>

</div>