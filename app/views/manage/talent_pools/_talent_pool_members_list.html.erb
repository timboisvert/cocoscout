<%# Renders the list of people in a talent pool, for AJAX refresh %>
<% can_manage = current_user_can_manage?(talent_pool.production) %>
<% cache ["talent_pool_members_v2", talent_pool.id, talent_pool.updated_at.to_i, talent_pool.talent_pool_memberships.maximum(:updated_at)&.to_i, can_manage] do %>
  <div class="flex flex-wrap gap-2 w-full"
      data-talent-pool-id="<%= talent_pool.id %>"
      data-droppable-talent-pool
      data-action="dragover->talent-pool-person#dragOver dragend->talent-pool-person#dragEnd dragleave->talent-pool-person#dragLeave drop->talent-pool-person#drop">
    <% if talent_pool.members.any? %>
      <% talent_pool.members.each do |member| %>

        <%= link_to member.is_a?(Person) ? manage_person_path(member) : manage_group_path(member) do %>
          <div class="flex flex-col bg-white items-center p-3 border border-gray-200 rounded-lg hover:border-gray-400 transition-all relative group w-[120px] cursor-grab active:cursor-grabbing"
              draggable="true"
              data-action="dragstart->talent-pool-person#dragStart dragend->talent-pool-person#dragEnd"
              data-person-id="<%= member.id %>"
              data-member-type="<%= member.class.name %>"
              data-source-talent-pool-id="<%= talent_pool.id %>">
            <% headshot_variant = member.safe_headshot_variant(:thumb) %>
            <% if headshot_variant %>
                <%= image_tag headshot_variant, alt: member.name, class: "w-12 h-12 rounded-lg object-cover mb-1" %>
            <% elsif member.is_a?(Person) %>
                <div class="w-12 h-12 rounded-lg bg-gray-300 flex items-center justify-center mb-1 text-white font-bold">
                <%= member.initials %>
                </div>
            <% else %>
                <div class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center mb-1 text-blue-600">
                  <i class="fa-solid fa-users text-xl"></i>
                </div>
            <% end %>
            <span class="font-medium text-xs text-center"><%= member.name.truncate(20, omission: '...') %></span>

            <% if can_manage %>
              <button type="button"
                  class="absolute bottom-2 left-2 right-2 z-20 text-pink-500 bg-white rounded-md px-2 py-1 text-xs font-bold shadow hover:bg-pink-100 transition-all border border-pink-200 opacity-0 group-hover:opacity-100 cursor-pointer"
                  data-action="talent-pool-person#remove"
                  data-person-id="<%= member.id %>"
                  data-member-type="<%= member.class.name %>"
                  data-remove-button>
                  Remove
              </button>
            <% end %>
          </div>
        <% end %>

      <% end %>
    <% end %>

    <% if can_manage %>
      <button type="button"
          class="flex flex-col items-center p-3 bg-gray-50 border border-dashed border-gray-200 rounded-lg justify-center cursor-pointer hover:border-pink-500 transition-all relative group w-[120px]"
          data-talent-pool-id="<%= talent_pool.id %>"
          data-talent-pool-name="<%= talent_pool.name %>"
          onclick="document.getElementById('add-member-modal')?.dispatchEvent(new CustomEvent('open-modal', { detail: { talentPoolId: '<%= talent_pool.id %>', talentPoolName: '<%= talent_pool.name %>' } }))">
          <div class="w-12 h-12 rounded-lg bg-gray-50 flex items-center justify-center mb-1 text-pink-500 font-bold text-xl">
              +
          </div>
          <span class="font-medium text-xs text-center text-gray-500">Add member</span>
      </button>
    <% end %>

  </div>
<% end %>