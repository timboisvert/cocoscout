<div class="p-6">
  <div class="flex items-center justify-between mb-4">
    <p class="text-sm text-gray-600">Members of this group</p>
    <% if membership&.owner? || membership&.write? %>
      <%= render "shared/button", text: "Invite Member", variant: "outline", size: "small", type: :button, data: { action: "click->group-members#openInviteModal" } %>
    <% end %>
  </div>

  <div class="space-y-2">
    <% group.group_memberships.includes(:person).each do |member| %>
      <div class="flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:border-gray-300 transition">
        <% if member.person.headshot.attached? %>
          <%= image_tag member.person.headshot.variant(:thumb), class: "w-10 h-10 rounded-lg object-cover" %>
        <% else %>
          <div class="w-10 h-10 rounded-lg bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-sm">
            <%= member.person.initials %>
          </div>
        <% end %>

        <div class="flex-1 min-w-0">
          <%= link_to member.person.name, public_profile_path(member.person.public_key), target: "_blank", class: "text-sm font-medium text-gray-900 hover:text-pink-600 truncate block" %>
        </div>

        <div class="flex items-center gap-2">
          <% if membership&.owner? && member.person != Current.user.person %>
            <%= select_tag "role_#{member.id}",
                options_for_select([['Owner', 'owner'], ['Editor', 'write'], ['Viewer', 'view']], member.permission_level),
                data: { action: "change->group-members#updateRole", membership_id: member.id },
                class: "text-sm px-3 py-1.5 border border-gray-300 rounded-lg focus:border-pink-500 focus:ring-pink-500" %>
          <% else %>
            <span class="inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium <%= member.owner? ? 'bg-pink-100 text-pink-700' : member.write? ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700' %>">
              <%= member.owner? ? 'Owner' : member.write? ? 'Editor' : 'Viewer' %>
            </span>
          <% end %>

          <% if membership&.owner? && !(member.person == Current.user.person && group.group_memberships.where(permission_level: :owner).count == 1) %>
            <button type="button"
                    data-action="click->group-members#removeMember"
                    data-membership-id="<%= member.id %>"
                    class="px-3 py-1.5 text-xs text-red-600 hover:text-red-700 hover:bg-red-50 border border-red-200 hover:border-red-300 rounded-lg font-medium cursor-pointer transition">
              Remove
            </button>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if group.group_invitations.pending.any? %>
      <div class="mt-4 pt-4 border-t border-gray-200 space-y-2">
        <p class="text-xs font-medium text-gray-500 uppercase mb-3">Pending Invitations</p>
        <% group.group_invitations.pending.each do |invitation| %>
          <div class="flex items-center gap-3 p-3 border border-gray-200 rounded-lg bg-gray-50">
            <div class="w-10 h-10 rounded-lg bg-gray-200 flex items-center justify-center text-gray-500 font-bold text-sm">
              <%= invitation.name.split.map(&:first).join.upcase[0..1] %>
            </div>

            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-900"><%= invitation.name %></p>
              <p class="text-xs text-gray-500"><%= invitation.email %></p>
            </div>

            <div class="flex items-center gap-2">
              <span class="inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-medium bg-yellow-100 text-yellow-700">
                Invited
              </span>

              <% if membership&.owner? || membership&.write? %>
                <%= button_to "Revoke",
                      revoke_group_invitation_path(group, invitation),
                      method: :delete,
                      data: { turbo_confirm: "Revoke invitation to #{invitation.email}?" },
                      class: "text-xs text-pink-500 hover:text-pink-600 underline cursor-pointer" %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <details class="mt-4 group">
    <summary class="cursor-pointer p-3 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 transition list-none">
      <div class="flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-600 flex-shrink-0">
          <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
        </svg>
        <span class="text-sm font-medium text-gray-700">About Permission Levels</span>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-gray-600 ml-auto transition-transform group-open:rotate-180">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
        </svg>
      </div>
    </summary>
    <div class="mt-2 p-4 bg-white border border-gray-200 rounded-lg text-sm text-gray-700 space-y-2">
      <p><strong class="text-gray-900">Owner:</strong> Full control - can edit everything and manage members</p>
      <p><strong class="text-gray-900">Editor:</strong> Can edit profile content but not manage members</p>
      <p><strong class="text-gray-900">Viewer:</strong> Can view the edit page but cannot make changes</p>
    </div>
  </details>
</div>
