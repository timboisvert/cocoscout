<% content_for :title, @group.name %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Directory", manage_directory_path]
    ],
    text: @group.name,
    links: []
  } %>

  <%# Hero Section with Headshot, Name, Email, Profile Link %>
  <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 mb-6">
    <div class="flex items-center gap-3 sm:gap-4 flex-1 min-w-0">
      <% headshot_variant = @group.safe_headshot_variant(:thumb) %>
      <% if headshot_variant %>
        <%= image_tag headshot_variant, class: "w-12 h-12 rounded-lg object-cover flex-shrink-0" %>
      <% else %>
        <div class="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center text-black font-bold flex-shrink-0">
          <%= @group.name[0..1].upcase %>
        </div>
      <% end %>
      <div class="min-w-0 flex-1">
        <div class="font-bold text-lg sm:text-xl text-gray-900 truncate"><%= @group.name %></div>
        <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-gray-500">
          <% if @group.email.present? %>
            <%= link_to @group.email, "mailto:#{@group.email}", class: "text-pink-500 hover:underline truncate max-w-[200px] sm:max-w-none" %>
          <% end %>
        </div>
      </div>
    </div>
    <% if @group.public_key.present? %>
      <div class="flex-shrink-0">
        <%= render partial: "shared/button", locals: { text: "Public Profile", path: public_profile_path(@group.public_key), variant: "primary", target: "_blank" } %>
      </div>
    <% end %>
  </div>

  <div class="w-full" data-controller="tabs">
    <nav class="flex space-x-2 border-b border-gray-200 mb-4 overflow-x-auto -mx-5 px-5 scrollbar-hide">
      <button type="button" data-tabs-target="tab" data-index="0" data-action="tabs#select" class="px-3 sm:px-4 py-2 text-sm font-medium bg-white border-b-2 text-pink-600 cursor-pointer whitespace-nowrap flex-shrink-0">Profile</button>
      <button type="button" data-tabs-target="tab" data-index="1" data-action="tabs#select" class="px-3 sm:px-4 py-2 text-sm font-medium bg-gray-50 border-b-2 text-gray-500 cursor-pointer whitespace-nowrap flex-shrink-0">Members</button>
      <button type="button" data-tabs-target="tab" data-index="2" data-action="tabs#select" class="px-3 sm:px-4 py-2 text-sm font-medium bg-gray-50 border-b-2 text-gray-500 cursor-pointer whitespace-nowrap flex-shrink-0">Notes</button>
    </nav>

    <div data-tabs-target="panel">
      <%= render "shared/group_card", group: @group %>
    </div>

    <div data-tabs-target="panel" class="hidden">
      <% if @group.members.empty? %>
        <p class="text-left text-gray-500 text-sm">No members found.</p>
      <% else %>
        <div class="space-y-3">
          <% @group.members.each do |member| %>
            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
              <%= link_to manage_person_path(member), class: "flex items-center space-x-4" do %>
                <% headshot = member.primary_headshot %>
                <% if headshot&.image&.attached? %>
                  <%= image_tag url_for(headshot.image.variant(:thumb)), class: "w-12 h-12 rounded-full object-cover" %>
                <% else %>
                  <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                    <span class="text-gray-500 text-sm font-semibold"><%= member.initials %></span>
                  </div>
                <% end %>
                <div class="flex-1">
                  <div class="text-sm font-semibold text-gray-900"><%= member.name %></div>
                  <div class="text-xs text-gray-500"><%= member.email %></div>
                </div>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <%# Notes Tab %>
    <div data-tabs-target="panel" class="hidden">
      <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
        <%= render "shared/card_header", title: "Producer Notes" %>
        <div class="p-4">
          <p class="text-sm text-gray-500 mb-4">Private notes about this group. Only visible to producers.</p>
          <%= form_with model: [:manage, @group], url: manage_group_path(@group), method: :patch, data: { turbo: true } do |form| %>
            <div class="mb-4">
              <%= form.rich_text_area :producer_notes, class: "min-h-[200px]" %>
            </div>
            <%= render "shared/button", text: "Save Notes", variant: "primary", type: :submit %>
          <% end %>
        </div>
      </div>
    </div>

  </div>

</div>
