<%
# Shared filter bar component with mobile toggle and white container
#
# Parameters:
#   toggle_label: String - Label for mobile toggle button (default: "Filters & View Options")
#   wrapper_data_controller: String (optional) - Additional data-controller to add to the filter bar wrapper
#   filter_groups: Array of hashes - Each hash defines a filter group:
#     {
#       label: String - Label for the filter group (e.g., "View", "Events")
#       filters: Array of hashes - Individual filter buttons:
#         {
#           text: String - Button text
#           path: String - Link path
#           active: Boolean - Whether this filter is active
#           data: Hash (optional) - data attributes
#         }
#       OR
#       partial: String - Path to a partial to render instead of filters array
#       locals: Hash (optional) - Locals to pass to the partial
#       OR
#       separator: Boolean - If true, renders a vertical separator line
#     }
#
# Example usage:
#    render "shared/filters/filter_bar",
#       toggle_label: "Filters & View Options",
#       wrapper_data_controller: "filter-select",
#       filter_groups: [
#         {
#           label: "View",
#           filters: [
#             { text: "All", path: my_shows_path(filter: 'all'), active: @filter == 'all' },
#             { text: "Recent", path: my_shows_path(filter: 'recent'), active: @filter == 'recent' }
#           ]
#         },
#         { separator: true },
#         {
#           label: "Include",
#           partial: "shared/filters/entity_filter",
#           locals: { path_helper: method(:my_shows_path), current_filter: @filter }
#         }
#       ]
%>
<%
toggle_label ||= "Filters & View Options"
wrapper_data_controller ||= nil
text_size ||= "sm"

# Build data-controller attribute
data_controller_attr = ["show-toggle"]
data_controller_attr << wrapper_data_controller if wrapper_data_controller
data_controller_value = data_controller_attr.join(" ")
%>

<div data-controller="<%= data_controller_value %>" class="mb-4">
  <!-- Mobile filter button -->
  <button type="button" data-action="click->show-toggle#toggle" class="lg:hidden w-full flex items-center justify-between px-4 py-2 mb-3 rounded-md border border-gray-200 bg-white text-gray-700 hover:border-gray-300">
    <span class="text-sm font-medium"><%= toggle_label %></span>
    <span data-show-toggle-target="icon">
      <svg xmlns="http://www.w3.org/2000/svg" class="size-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
    </span>
  </button>

  <div data-show-toggle-target="content" class="hidden lg:block">
    <!-- Filter Bar -->
    <div class="bg-white rounded-lg border border-gray-200 p-3 mb-3">
      <div class="flex flex-wrap gap-4 items-center">
        <% filter_groups.each do |group| %>
          <% if group.is_a?(Hash) && group[:separator] %>
            <div class="h-8 w-px bg-gray-200"></div>
          <% elsif group.is_a?(Hash) && group[:partial] %>
            <%= render group[:partial], **(group[:locals] || {}) %>
          <% elsif group.is_a?(Hash) && group[:filters] %>
            <div class="flex items-center gap-2">
              <% if group[:label] %>
                <span class="text-xs font-medium text-gray-500 uppercase tracking-wide"><%= group[:label] %></span>
              <% end %>
              <div class="flex gap-1">
                <% group[:filters].each do |filter| %>
                  <%= link_to filter[:text],
                          filter[:path],
                          data: filter[:data] || { turbo_prefetch: false },
                          class: "px-3 py-1.5 rounded text-xs font-medium transition #{filter[:active] ? 'bg-pink-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}"
                  %>
                <% end %>
              </div>
            </div>
          <% elsif group.is_a?(Array) %>
            <div class="flex gap-1">
              <% group.each do |filter| %>
                <% if filter[:icon_svg] %>
                  <%= link_to filter[:path],
                          data: filter[:data_attributes] || { turbo_prefetch: false },
                          title: filter[:title],
                          class: "px-3 py-1 rounded-md border text-#{text_size || 'sm'} flex items-center gap-2 transition #{filter[:always_pink] || filter[:active] ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200 hover:border-gray-300'}" do %>
                    <%= filter[:icon_svg].html_safe %>
                    <span><%= filter[:text] %></span>
                  <% end %>
                <% else %>
                  <%= link_to filter[:text],
                          filter[:path],
                          data: filter[:data_attributes] || { turbo_prefetch: false },
                          title: filter[:title],
                          class: "px-3 py-1 rounded-md border text-#{text_size || 'sm'} transition #{filter[:active] ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200 hover:border-gray-300'}"
                  %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
