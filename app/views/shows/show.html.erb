<% content_for :title, "Show: #{@show.date_and_time.strftime("%A, %B %-d, %Y")}" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
       ["Shows", production_shows_path(@production)]
    ],
    text: @show.date_and_time.strftime("%A, %B %-d, %Y"),
    links: []
  } %>


  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
    <!-- Left: Cast Members -->
    <div>
      <h2 class="font-bold text-lg mb-3">Cast Members</h2>
      <div id="show-cast-members" data-controller="drag-cast-member">
        <% @production.casts.each do |cast| %>
          <% cast.people.each do |person| %>
            <div class="flex items-center gap-2 mb-2 p-2 bg-gray-50 rounded shadow cursor-move"
                 data-drag-cast-member-target="person"
                 data-person-id="<%= person.id %>"
                 draggable="true">
              <% if person.headshot.attached? %>
                <%= image_tag person.headshot.variant(:thumb), alt: person.stage_name, class: "w-8 h-8 rounded object-cover" %>
              <% else %>
                <div class="w-8 h-8 rounded bg-gray-300 flex items-center justify-center text-white font-bold">
                  <%= person.initials %>
                </div>
              <% end %>
              <span><%= person.stage_name %></span>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Right: Roles -->
    <div>
      <h2 class="font-bold text-lg mb-3">Roles</h2>
      <div id="show-roles" data-controller="drop-role">
          <% @show.production.roles.each do |role| %>
            <div id="show-roles" data-controller="drop-role" data-show-id="<%= @show.id %>">
          <div class="mb-3 p-3 bg-white border rounded shadow min-h-[60px] flex flex-col justify-between"
               data-drop-role-target="role"
               data-role-id="<%= role.id %>"
               data-action="drop->drop-role#assign dragover->drop-role#allowDrop">
            <div class="font-semibold"><%= role.name %></div>
            <div class="text-xs text-gray-500 mt-1">
              Assigned:
              <% assignments = @show.show_person_role_assignments.where(role: role) %>
              <% if assignments.any? %>
                <% assignments.each do |assignment| %>
                  <span class="inline-block bg-pink-100 text-pink-700 rounded px-2 py-1 mr-1"><%= assignment.person.stage_name %></span>
                <% end %>
              <% else %>
                <span class="text-gray-400">(none)</span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

</div>
