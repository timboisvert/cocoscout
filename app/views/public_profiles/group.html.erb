<% content_for :title, @entity.name %>

<div class="w-full max-w-6xl mx-auto px-4 py-8">

  <%# Hero Section %>
  <div class="bg-white border border-gray-200 rounded-lg p-8 mb-6">
    <div class="flex items-start gap-6">
      <% if @entity.headshot.attached? %>
        <%= image_tag @entity.headshot.variant(:thumb), class: "w-32 h-32 rounded-lg object-cover" %>
      <% else %>
        <div class="w-32 h-32 rounded-lg bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-3xl">
          <%= @entity.initials %>
        </div>
      <% end %>

      <div class="flex-1">
        <div class="flex items-center justify-between">
          <h1 class="text-4xl font-bold text-gray-900"><%= @entity.name %></h1>
          <% if Current.user %>
            <% membership = @entity.group_memberships.find_by(person: Current.user.person) %>
            <% if membership && (membership.owner? || membership.write?) %>
              <%= link_to "Edit Group", my_edit_group_path(@entity), class: "px-4 py-2 text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 rounded-md" %>
            <% end %>
          <% end %>
        </div>

        <% if @entity.bio.present? %>
          <p class="text-gray-700 mt-4 whitespace-pre-line"><%= @entity.bio %></p>
        <% end %>
      </div>
    </div>
  </div>

  <%# Contact Section %>
  <% if @entity.email.present? || @entity.phone.present? || @entity.website.present? || @entity.socials.any? %>
    <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Contact</h2>

      <div class="space-y-3">
        <% if @entity.email.present? %>
          <div class="flex items-center gap-2">
            <svg width="20" height="20" class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
              <path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/>
            </svg>
            <%= mail_to @entity.email, @entity.email, class: "text-pink-600 hover:text-pink-700" %>
          </div>
        <% end %>

        <% if @entity.phone.present? %>
          <div class="flex items-center gap-2">
            <svg width="20" height="20" class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path d="M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"/>
            </svg>
            <%= link_to @entity.phone, "tel:#{@entity.phone}", class: "text-pink-600 hover:text-pink-700" %>
          </div>
        <% end %>

        <% if @entity.website.present? %>
          <div class="flex items-center gap-2">
            <svg width="20" height="20" class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.3c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64H348.7c2.2 20.4 3.3 41.8 3.3 64zm28.8-64H503.9c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6c78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7c10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5c11.6 26 20.9 58.2 27 94.7zm-209 0H18.6C48.6 85.9 112.2 29.1 190.6 8.4C165.1 42.6 145.3 96.1 135.3 160zM8.1 192H131.2c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zM194.7 446.6c-11.6-26-20.9-58.2-27-94.6H344.3c-6.1 36.4-15.5 68.6-27 94.6c-10.5 23.6-22.2 40.7-33.5 51.5C272.6 508.8 263.3 512 256 512s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6C112.2 482.9 48.6 426.1 18.6 352H135.3zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6c25.5-34.2 45.2-87.7 55.3-151.6H493.4z"/>
            </svg>
            <%= link_to @entity.website, @entity.website, target: "_blank", rel: "noopener", class: "text-pink-600 hover:text-pink-700" %>
          </div>
        <% end %>

        <% @entity.socials.each do |social| %>
          <div class="flex items-center gap-2">
            <%= social.icon(20) %>
            <%= link_to social.handle, social.url, target: "_blank", rel: "noopener", class: "text-pink-600 hover:text-pink-700" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Resume Section %>
  <% if @entity.resume.attached? %>
    <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold text-gray-900">Resume / EPK</h2>
        <%= link_to "Download", rails_blob_path(@entity.resume, disposition: "attachment"), class: "px-4 py-2 text-sm font-medium text-pink-600 border border-pink-600 rounded-md hover:bg-pink-50" %>
      </div>

      <% resume_preview = @entity.safe_resume_preview(resize_to_limit: [1224, 1584]) %>
      <% if resume_preview %>
        <div class="w-full">
          <%= image_tag resume_preview, class: "w-full object-contain border border-gray-200 rounded" %>
        </div>
      <% end %>
    </div>
  <% end %>

  <%# Members Section %>
  <div class="bg-white border border-gray-200 rounded-lg p-6">
    <h2 class="text-2xl font-bold text-gray-900 mb-4">
      Members
      <span class="text-lg font-normal text-gray-500">(<%= @entity.group_memberships.count %>)</span>
    </h2>

    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      <% @entity.group_memberships.includes(:person).each do |membership| %>
        <%= link_to public_profile_path(membership.person.public_key), class: "group" do %>
          <div class="flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:border-pink-400 hover:shadow-md transition-all">
            <% if membership.person.headshot.attached? %>
              <%= image_tag membership.person.headshot.variant(:thumb), class: "w-20 h-20 rounded-lg object-cover mb-2" %>
            <% else %>
              <div class="w-20 h-20 rounded-lg bg-pink-100 flex items-center justify-center text-pink-600 font-bold mb-2">
                <%= membership.person.initials %>
              </div>
            <% end %>
            <span class="text-sm font-medium text-gray-900 text-center group-hover:text-pink-600">
              <%= membership.person.name %>
            </span>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>

</div>
