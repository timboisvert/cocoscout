<%
  # Profile videos form section
  # Parameters:
  # - person_form: the form builder
%>

<div id="videos" class="bg-white border border-gray-200 rounded-lg overflow-hidden mb-6" data-controller="profile-section">
  <%= render "shared/section_header",
    title: "Videos & Reels",
    collapsible: true,
    visibility_toggle: true,
    visibility_field_name: "person[profile_visibility_settings][videos_visible]",
    visibility_checked: @person.videos_visible? %>

  <div class="p-6 space-y-4" data-profile-section-target="content">
    <p class="text-sm text-gray-600 mb-4">
      Add links to your demo reels, performance videos, or other video content. Supports YouTube, Vimeo, and other video platforms.
    </p>

    <div id="videos-container" class="space-y-4">
      <%= person_form.fields_for :profile_videos do |video_form| %>
        <div class="border border-gray-200 rounded-lg p-4 video-item">
          <%= video_form.hidden_field :id %>
          <%= video_form.hidden_field :position %>
          <%= video_form.hidden_field :_destroy, value: "0", class: "destroy-field" %>

          <div class="flex flex-col sm:flex-row gap-4">
            <div class="flex-1 space-y-3">
              <div>
                <%= video_form.label :title, "Title", class: "block text-sm font-medium text-gray-700" %>
                <%= video_form.text_field :title,
                    placeholder: "e.g., Demo Reel 2024",
                    class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-pink-500 focus:ring-pink-500" %>
              </div>

              <div>
                <%= video_form.label :url, "Video URL", class: "block text-sm font-medium text-gray-700" %>
                <%= video_form.text_field :url,
                    placeholder: "https://youtube.com/watch?v=... or https://vimeo.com/...",
                    class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-pink-500 focus:ring-pink-500" %>
              </div>
            </div>

            <div class="flex-shrink-0 flex items-start">
              <button type="button"
                      class="text-red-600 hover:text-red-800 text-sm"
                      onclick="this.closest('.video-item').querySelector('.destroy-field').value = '1'; this.closest('.video-item').style.display = 'none';">
                Remove
              </button>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <button type="button"
            id="add-video"
            class="inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
      Add Video
    </button>

    <template id="video-template">
      <div class="border border-gray-200 rounded-lg p-4 video-item">
        <input type="hidden" name="person[profile_videos_attributes][NEW_RECORD][position]" value="">
        <input type="hidden" name="person[profile_videos_attributes][NEW_RECORD][_destroy]" value="0" class="destroy-field">

        <div class="flex flex-col sm:flex-row gap-4">
          <div class="flex-1 space-y-3">
            <div>
              <label class="block text-sm font-medium text-gray-700">Title</label>
              <input type="text"
                     name="person[profile_videos_attributes][NEW_RECORD][title]"
                     placeholder="e.g., Demo Reel 2024"
                     class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-pink-500 focus:ring-pink-500">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Video URL</label>
              <input type="text"
                     name="person[profile_videos_attributes][NEW_RECORD][url]"
                     placeholder="https://youtube.com/watch?v=... or https://vimeo.com/..."
                     class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-pink-500 focus:ring-pink-500">
            </div>
          </div>

          <div class="flex-shrink-0 flex items-start">
            <button type="button"
                    class="text-red-600 hover:text-red-800 text-sm"
                    onclick="this.closest('.video-item').querySelector('.destroy-field').value = '1'; this.closest('.video-item').style.display = 'none';">
              Remove
            </button>
          </div>
        </div>
      </div>
    </template>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('add-video')?.addEventListener('click', function() {
          const template = document.getElementById('video-template');
          const container = document.getElementById('videos-container');

          if (template && container) {
            const clone = template.content.cloneNode(true);
            const html = clone.querySelector('.video-item').outerHTML;
            const newHtml = html.replace(/NEW_RECORD/g, new Date().getTime());

            container.insertAdjacentHTML('beforeend', newHtml);
          }
        });
      });
    </script>
  </div>
</div>
