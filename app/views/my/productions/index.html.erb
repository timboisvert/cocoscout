<% content_for :title, "My Productions" %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "My Productions",
    links: []
  } %>

  <% if @productions.any? %>
    <div class="grid grid-cols-1 gap-1 mt-2">
      <% @productions.each do |production| %>
        <% entities = @production_entities[production.id] || [] %>
        <%= link_to my_production_path(production), class: "p-4 bg-white border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex items-center gap-4 no-underline" do %>
          <% logo_variant = production.safe_logo_variant(:small) %>
          <% if logo_variant %>
            <%= image_tag logo_variant, alt: "#{production.name} logo", class: "w-[80px] object-contain rounded flex-shrink-0" %>
          <% else %>
            <div class="w-[80px] h-[50px] rounded bg-gray-100 flex items-center justify-center text-gray-400 text-sm flex-shrink-0">
              No logo
            </div>
          <% end %>

          <div class="flex-1 min-w-0">
            <div class="font-bold text-lg text-gray-900"><%= production.name %></div>
            <div class="text-sm text-gray-500"><%= production.organization.name %></div>
          </div>

          <% if @groups.any? && entities.any? %>
            <div class="flex items-center gap-1">
              <% entities.first(3).each do |entity_info| %>
                <% headshot = entity_info[:entity].safe_headshot_variant(:thumb) %>
                <% if headshot %>
                  <%= image_tag headshot, class: "w-8 h-8 rounded-lg object-cover", alt: entity_info[:entity].name, title: entity_info[:entity].name %>
                <% end %>
              <% end %>
              <% if entities.size > 3 %>
                <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center text-gray-500 text-xs" title="<%= entities.drop(3).map { |e| e[:entity].name }.join(', ') %>">
                  +<%= entities.size - 3 %>
                </div>
              <% end %>
            </div>
          <% end %>

          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
          </svg>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-12">
      <p class="text-gray-500">You're not in the talent pool for any productions yet.</p>
      <p class="text-sm text-gray-400 mt-2">When a producer adds you to their talent pool, you'll see their production here.</p>
    </div>
  <% end %>

</div>
