
<nav class="hidden w-56 bg-white border-r border-r-2 border-gray-200 lg:flex flex-col transition-all duration-200 ease-in-out z-20 justify-between fixed left-0 top-16 h-[calc(100vh-4rem)]">
  <div class="flex-1 overflow-y-auto">

    <div class="mt-2">

      <% if Current.organization.present? %>

        <%
        # Check if user has team access to any production
        has_team_access = Current.user.accessible_productions.where(organization: Current.organization).any? { |p| Current.user.role_for_production(p).present? }

        # Build links based on access level
        links = []

        if has_team_access
          # Full navigation for production team members
          links = [
            {
              label: "Home",
              path: manage_path,
              active: controller_name == "manage" && action_name == "index"
            },
            {
              label: "Messages",
              path: manage_messages_path,
              active: controller_name == "messages"
            },
            {
              label: "Shows & Events",
              path: manage_shows_path,
              active: ["shows", "org_shows", "vacancies", "show_wizard"].include?(controller_name)
            },
            {
              label: "Casting",
              path: manage_casting_path,
              active: ["casting", "org_casting", "casting_availability", "roles", "talent_pools", "casting_tables", "org_roles", "org_talent_pools", "org_availability"].include?(controller_name)
            },
            {
              label: "Sign-ups",
              path: manage_signups_path,
              active: ["signups", "org_signups", "sign_up_forms", "auditions", "audition_cycles", "audition_requests", "audition_sessions", "sign_up_form_wizard", "audition_cycle_wizard", "org_auditions", "org_forms"].include?(controller_name)
            },
            {
              label: "Money",
              path: manage_money_index_path,
              active: controller_name == "money" || controller_name == "money_financials" || controller_name == "money_payouts" || controller_name == "show_payouts" || controller_name == "show_financials"
            },
            {
              label: "Directory",
              path: manage_directory_path,
              active: ["directory", "people", "groups"].include?(controller_name)
            }
          ]
        else
          # Limited navigation for reviewer-only users
          links = [
            {
              label: "Sign-ups",
              path: manage_signups_path,
              active: ["signups", "org_signups", "sign_up_forms", "auditions", "audition_cycles", "audition_requests", "audition_sessions"].include?(controller_name)
            }
          ]
        end
        %>

        <% links.each do |item| %>
          <% if item[:label] == "Messages" %>
            <div class="relative">
              <%= render "shared/nav_link", text: item[:label], path: item[:path], active: item[:active] %>
              <% unread_count = Current.user&.unread_message_count.to_i %>
              <% if unread_count > 0 %>
                <span class="absolute top-2 right-2 inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold text-white bg-pink-500 rounded-full" data-unread-badge><%= unread_count > 99 ? "99+" : unread_count %></span>
              <% end %>
            </div>
          <% else %>
            <%= render "shared/nav_link", text: item[:label], path: item[:path], active: item[:active], badge: item[:badge] %>
          <% end %>
        <% end %>

      <% end %>

    </div>

  </div>

  <!-- Bottom section -->
  <div class="flex justify-center pb-0">
    <%= render "shared/cocoscout_logo", size: :large %>
  </div>

</nav>