<% content_for :title, "My Shows" %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Shows & Events", my_shows_path],
      [@production.name, my_production_path(@production)]
    ],
    text: @show.date_and_time.strftime("%B %d, %Y at %l:%M %p"),
    links: []
  } %>

    <div class="grid grid-cols-1 gap-2 mt-2">

      <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex flex-col sm:flex-row sm:items-top gap-4">
          <% if @production.logo.attached? %>
              <div class="w-full sm:w-auto sm:flex-shrink-0">
                  <%= image_tag @production.logo.variant(:small), alt: "#{@production.name} logo", class: "w-full sm:w-[100px] object-contain rounded" %>
              </div>
          <% end %>
          <div class="w-full sm:w-auto text-left">
              <div class="font-bold text-lg sm:text-xl"><%= @production.name %></div>

              <% if @show.secondary_name.present? %>
                <div class="mb-1 text-sm sm:text-md"><%= @show.secondary_name %></div>
              <% end %>

              <div class="flex items-center gap-2 pt-2">
                <% event_type_badge_classes = case @show.event_type
                  when "rehearsal" then "bg-blue-50 text-blue-700 ring-blue-600/10"
                  when "meeting" then "bg-green-50 text-green-700 ring-green-600/10"
                  else "bg-pink-50 text-pink-700 ring-pink-600/10"
                end %>
                <span class="inline-flex items-center justify-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset w-20 flex-shrink-0 <%= event_type_badge_classes %>">
                  <%= @show.event_type.titleize %>
                </span>
                <% date_classes = @show.canceled ? "text-red-400 line-through" : "" %>
                <div class="text-sm sm:text-md <%= date_classes %>"><%= @show.date_and_time.strftime("%B %d, %Y at %l:%M %p") %></div>
                <% if @show.canceled %>
                  <span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 w-20 justify-center text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">Canceled</span>
                <% end %>
              </div>
          </div>
      </div>

      <div class="col-span-1 space-y-2">

        <% if @show.event_type == "show" %>
          <div class="flex flex-col w-full p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex items-top">
            <%= render partial: "shared/top_menu", locals: {
              breadcrumbs: [],
              text: "Full Cast",
              links: []
            } %>

            <div class="text-sm sm:text-md">
              <table>
                <% @show_person_role_assignments.each do |assignment| %>
                  <tr class="<%= 'text-pink-500' if assignment.person == Current.user.person %>">
                    <td class=""><%= assignment.role.name %></td>
                    <td class="pl-4 font-bold"><%= assignment.person.name %></td>
                  </tr>
                <% end %>
              </table>
            </div>

          </div>
        <% end %>

        <div class="flex flex-col w-full p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex items-top">
          <%= render partial: "shared/top_menu", locals: {
            breadcrumbs: [],
            text: "Location",
            links: []
          } %>

          <% if @show.location.present? %>
            <div class="text-xs sm:text-md flex flex-col md:flex-row md:space-x-4">
              <div class="md:w-1/2 ">
                <div class="font-bold"><%= @show.location.name %></div>
                <div class="text-gray-500">
                  <%= @show.location.address1 %><br>
                  <% if @show.location.address2.present? %>
                  <%= @show.location.address2 %><br>
                  <% end %>
                  <%= "#{@show.location.city}, #{@show.location.state} #{@show.location.postal_code}" %>
                </div>

                <% if @show.location.notes.present? %>
                  <div class="mt-2">
                    <div class="font-bold">Notes/Instructions:</div>
                    <div class="text-gray-500">
                      <%= @show.location.notes %>
                    </div>
                  </div>
                <% end %>
              </div>

              <div class="md:w-1/2 mt-4 md:mt-0">
                <% loc = @show.location %>
                <% if loc.present? %>
                  <% address = [loc.address1, loc.address2, loc.city, loc.state, loc.postal_code].compact.reject(&:blank?).join(', ') %>
                  <div class="w-full">
                    <iframe
                      width="100%"
                      height="400"
                      style="border:0"
                      loading="lazy"
                      allowfullscreen
                      referrerpolicy="no-referrer-when-downgrade"
                      src="https://www.google.com/maps?q=<%= URI.encode_www_form_component(address) %>&output=embed">
                    </iframe>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

        </div>


        <% if @show.poster.present? || @show.show_links.any? %>
          <div class="flex flex-col w-full p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex items-top">
            <%= render partial: "shared/top_menu", locals: {
              breadcrumbs: [],
              text: "Social Media & Links",
              links: []
            } %>

            <% if @show.poster.present? %>
              <div class="mt-2">
                <%= image_tag url_for(@show.poster.variant(:small)), class: "" %>
              </div>
            <% end %>

            <% if @show.show_links.any? %>
              <div class="mt-2 flex flex-col space-y-1">
                <% @show.show_links.each do |link| %>
                  <%= link_to link.url, link.url, target: "_blank", rel: "noopener", class: "text-sm text-pink-500 underline" %>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>

      </div>

    </div>



</div>