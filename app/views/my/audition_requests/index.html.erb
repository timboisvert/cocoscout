<% content_for :title, "Sign-ups" %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "My Sign-ups",
    links: []
  } %>

    <div class="flex w-full space-x-2">
        <div class="flex flex-1 space-x-2 mb-2">
            <!-- Left: Sorting links -->
            <%= link_to "All",
                    my_audition_requests_path(requests_filter: "all"),
                    data: { turbo_prefetch: false },
                    class: "px-3 py-1 rounded-md border text-sm #{(@requests_filter == "all") ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
            %>
            <%= link_to "Open",
                    my_audition_requests_path(requests_filter: "open"),
                    data: { turbo_prefetch: false },
                    class: "px-3 py-1 rounded-md border text-sm #{(@requests_filter == "open") ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
            %>
        </div>
    </div>


    <% if @audition_requests.any? %>

        <div class="grid grid-cols-1 gap-2 mt-2">
            <% @audition_requests.each do |audition_request| %>
                <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex items-top">

                    <% production = audition_request.audition_cycle.production %>

                    <div class="grid grid-cols-1 sm:grid-cols-5 gap-2 w-full">
                        <div class="col-span-1 sm:col-span-3 items-center">

                            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
                                <% logo_variant = production.safe_logo_variant(:small) %>
                                <% if logo_variant %>
                                    <div class="w-full sm:w-auto sm:flex-shrink-0">
                                        <%= image_tag logo_variant, alt: "#{production.name} logo", class: "w-full sm:w-[100px] object-contain rounded" %>
                                    </div>
                                <% end %>
                                <div class="w-full sm:w-auto text-left">
                                    <div class="font-bold text-lg sm:text-xl"><%= production.name %></div>

                                    <% cycle = audition_request.audition_cycle %>

                                    <% if cycle.editable_by_talent? %>

                                        <% if cycle.closes_at > 1.day.from_now %>
                                            <div class="text-xs text-gray-500 mt-1">

                                                <% if cycle.audition_type == "in_person" %>
                                                    Sign-ups
                                                <% elsif cycle.audition_type == "video_upload" %>
                                                    Video auditions
                                                <% end %>
                                                close on <%= cycle.closes_at.strftime('%b %d, %Y') %> at <%= cycle.closes_at.strftime('%l:%M %p') %>
                                            </div>
                                        <% else %>
                                            <div class="text-xs <%= cycle.closes_at < 4.hours.from_now ? 'text-red-500' : 'text-gray-500' %> mt-1" data-controller="countdown" data-countdown-until-value="<%= cycle.closes_at.utc.iso8601 %>">
                                                <% if cycle.audition_type == "in_person" %>
                                                    Sign-ups
                                                <% elsif cycle.audition_type == "video_upload" %>
                                                    Video auditions
                                                <% end %>
                                                close in <span data-countdown-target="clock" class="text-pink-500"></span>
                                            </div>
                                        <% end %>

                                        <%= link_to "Edit my Sign-up", my_submit_audition_request_form_path(cycle.token), class: "text-xs text-pink-500 underline", target: "_blank" %>

                                    <% elsif cycle.timeline_status == :closed || !cycle.active %>
                                        <div class="text-xs text-gray-500 mt-1">Sign-up window closed on <%= cycle.closes_at.strftime('%b %d, %Y') %></div>
                                    <% elsif cycle.timeline_status == :upcoming %>
                                        <div class="text-xs text-gray-500 mt-1">Sign-ups open on <%= cycle.opens_at.strftime('%b %d, %Y') %></div>
                                    <% end %>
                                </div>
                            </div>
                        </div>

                        <div class="col-span-1 sm:col-span-2 mt-2 sm:mt-0 flex flex-col justify-center items-start">
                            <div class="text-lg">
                                <% if audition_request.audition_cycle.audition_type == "in_person" %>
                                    <%= in_person_signup_status_name(audition_request) %>
                                 <% elsif audition_request.audition_cycle.audition_type == "video_upload" %>
                                    <%= video_audition_status_name(audition_request) %>
                                <% end %>
                            </div>
                            <div class="text-sm text-gray-500 mt-1">
                                <% if audition_request.audition_cycle.audition_type == "in_person" %>
                                    <%= in_person_signup_status_text(audition_request) %>
                                 <% elsif audition_request.audition_cycle.audition_type == "video_upload" %>
                                    <%= video_audition_status_text(audition_request) %>
                                <% end %>

                            </div>
                        </div>
                    </div>
                </div>
            <% end %>
        </div>
    <% else %>
         <p class="text-gray-500 text-sm pt-2">
            <% if @requests_filter == "all" %>
                You haven't signed up for any auditions.
            <% elsif @requests_filter == "open" %>
                None of the shows you've applied for are currently auditioning.
            <% end %>
        </p>
    <% end %>

</div>