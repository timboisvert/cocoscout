<% content_for :title, "Edit Show: #{@show.date_and_time.strftime("%A, %B %-d, %Y")}" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
       ["Shows", manage_production_shows_path(@production)]
    ],
    text: @show.date_and_time.strftime("%A, %B %-d, %Y"),
    links: []
  } %>

<%= form_with(model: [:manage, @production, @show], class: "contents") do |form| %>
<% if @show.errors.any? %>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-lg mt-3">
      <h2><%= pluralize(@show.errors.count, "error") %> prohibited this show from being saved:</h2>

      <ul class="list-disc ml-6">
        <% @show.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="flex gap-4 w-full">
    <div class="w-full md:w-1/2">
      <%= form.label :date_and_time %>
      <%= form.datetime_field :date_and_time, class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-pink-500": @show.errors[:date_and_time].none?, "border-red-400 focus:outline-pink-500": @show.errors[:date_and_time].any?}] %>
    </div>

    <div class="w-full md:w-1/2">
      <%= form.label :location_id, "Location" %>
      <%= form.collection_select :location_id, Location.all, :id, :name, { prompt: "Select a location" }, { class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", ( @show.errors[:location_id].any? ? "border-red-400" : "border-gray-400" )], required: true } %>
      <div class="mt-1 ml-1">
        <%= link_to "Manage Locations", manage_locations_path, class: "text-pink-500 underline text-sm" %>
      </div>
    </div>
  </div>

  <div class="my-5">
    <%= form.label :secondary_name %>
    <div class="text-sm text-gray-500">(eg. If the show on this particular date has a sub-name or special name to go along with the Production name)</div>
    <%= form.text_field :secondary_name, class: ["w-128 shadow-sm rounded-lg border px-3 py-2 mt-2", {"border-gray-400 focus:outline-pink-500": @show.errors[:secondary_name].none?, "border-red-400 focus:outline-pink-500": @show.errors[:secondary_name].any?}] %>
  </div>

  <div class="text-md pt-5">Show Poster</div>
  <div class="my-2 flex p-4 border border-gray-200 rounded-lg hover:border-gray-400 hover:shadow-sm transition-all items-top max-w-md">
      <div class="md:mr-5 w-full">

          <% if @show.poster.attached? %>
              <div class="mb-4">
                  <%= image_tag url_for(@show.poster), class: "rounded shadow max-w-72 rounded-lg border border-gray-200" %>
              </div>
          <% end %>

          <div class="flex items-center justify-between">
            <%= form.label :image, "Update Show Poster:", class: "text-sm" %>
            <span class="text-sm text-gray-500">(JPEG, JPG, or PNG)</span>
          </div>

          <div class="block shadow-sm rounded-lg border px-3 py-2 mt-2 border-gray-400">
              <%= form.file_field :poster, class: "text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:text-white file:bg-pink-500 hover:file:bg-pink-600" %>
          </div>

      </div>
  </div>

  <div class="mt-10" data-controller="show-links">
    <label>Show Links</label>
    <div class="text-sm text-gray-500 mb-2">Add links related to this show (e.g. ticketing, event page, social media posts, etc.)</div>
    <div id="show-links-fields" data-show-links-target="list" class="mt-1">
      <%= form.fields_for :show_links do |show_link_form| %>
        <div class="flex items-center mb-2 show-links-fields-row" data-show-links-target="row">
          <%= show_link_form.hidden_field :id %>
          <%= show_link_form.hidden_field :_destroy, value: "0", class: "destroy-flag" %>
          <%= show_link_form.text_field :url, placeholder: "URL", class: "inline-block w-128 shadow-sm rounded-lg border px-3 py-2 mr-2 border-gray-400 focus:outline-pink-500" %>
          <%= link_to "Remove", '#', class: "remove-show-link text-pink-500 underline text-sm", data: { action: "show-links#remove" } %>
        </div>
      <% end %>
    </div>
    <%= link_to "Add Show Link", '#', class: "text-pink-500 underline text-sm", data: { action: "show-links#add" } %>
    <template data-show-links-target="template">
      <div class="flex items-center mb-2 show-links-fields-row" data-show-links-target="row">
        <input type="hidden" name="show[show_links_attributes][new_show_links][id]" />
        <input type="hidden" name="show[show_links_attributes][new_show_links][_destroy]" value="0" class="destroy-flag" />
        <input type="text" name="show[show_links_attributes][new_show_links][url]" placeholder="URL" class="inline-block w-128 shadow-sm rounded-lg border px-3 py-2 mr-2 border-gray-400 focus:outline-pink-500" />
        <a href="#" class="remove-show-link text-pink-500 underline text-sm" data-action="show-links#remove">Remove</a>
      </div>
    </template>
  </div>

  <div class="w-full border-t border-gray-200 pt-5 my-5">
    <%= form.submit "Update Show", class: "sm:w-auto rounded-lg px-3.5 py-2.5 text-white bg-pink-500 hover:bg-pink-600 focus:ring-4 focus:outline-none focus:ring-pink-300 dark:focus:ring-pink-800 inline-block font-medium cursor-pointer" %>
    <%= link_to "Back", 'javascript:history.back()', class: "w-full sm:w-auto text-center mt-2 sm:mt-0 sm:ml-2 rounded-lg px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
  </div>


<% end %>


</div>
