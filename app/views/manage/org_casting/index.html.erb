<% content_for :title, "Casting" %>

<%
  casting_actions = [
    { icon: "table-cells", text: "Casting Tables", description: "Batch cast multiple shows", path: manage_casting_tables_path },
    { icon: "users", text: "Roles", description: "Define positions to fill", path: manage_casting_roles_path },
    { icon: "user-group", text: "Talent Pool", description: "Manage who can be cast", path: manage_casting_talent_pools_path }
  ]

  description = <<~HTML
    <p>
      This is your organization's casting hub â€” view and manage cast assignments across all productions.
      From here, you can see upcoming and past shows, who's assigned to each role, and make changes on the fly.
    </p>
  HTML
%>

<div class="w-full" data-controller="linked-highlight">
  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render "shared/module_header",
    title: "Casting",
    description: description,
    actions: casting_actions
  %>

  <div class="border-t border-gray-200 pt-4 mt-2">
    <%= render "shared/filters/filter_bar", filter_groups: [
      {
        label: "View",
        filters: [
          { text: "Upcoming", path: manage_casting_path(filter: "upcoming"), active: @filter == "upcoming" },
          { text: "Past", path: manage_casting_path(filter: "past"), active: @filter == "past" }
        ]
      }
    ] %>

    <!-- Show Cast Assignments Section -->
    <div>
      <% if @shows.any? %>
        <div class="space-y-1">
          <% @shows.each do |show| %>
            <%
              production = show.production
              roles = @roles_by_production[production.id] || []
              sign_up_regs = @sign_up_registrations_by_show[show.id] || []
            %>
            <%= render "manage/casting/cast_card",
                       show: show,
                       production: production,
                       title: nil,
                       roles: roles,
                       roles_count: roles.size,
                       people_by_id: @people_by_id,
                       groups_by_id: @groups_by_id,
                       sign_up_registrations: sign_up_regs,
                       show_production: true %>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-sm"><%= @filter == "past" ? "No past shows with casting enabled." : "No upcoming shows with casting enabled." %></p>
      <% end %>
    </div>
  </div>
</div>
