<div data-controller="cast-membership-card">
    <div class="p-5 border border-gray-200 rounded-lg hover:border-gray-400 transition-all" data-cast-membership-card-target="card">

        <h1 class="font-bold text-lg">
            Cast Membership
        </h1>

        <% casts = person.casts.where(production: production) %>
        <% all_casts = production.casts.to_a %>
        <% available_casts = all_casts - casts.to_a %>
        <% if casts.any? %>
            <% casts.each do |cast| %>
                <div class="p-2 mt-1 rounded-lg bg-pink-500 text-white text-xs flex items-center justify-between">
                    <strong><%= cast.name %></strong>
                    <a href="<%= remove_from_cast_person_path(person, cast_id: cast.id) %>"
                       data-action="cast-membership-card#remove"
                       data-person-id="<%= person.id %>"
                       data-cast-id="<%= cast.id %>"
                       data-turbo-prefetch="false"
                       class="ml-2 text-white text-xs underline hover:text-gray-200">
                      Remove
                    </a>
                </div>
            <% end %>
        <% else %>
            <div class="text-sm text-gray-500 mt-1">
                Not currently cast in this production
            </div>
        <% end %>

        <% if available_casts.any? %>
            <div class="w-full mt-1">
                <a
                    href="#"
                    class="text-pink-500 underline text-xs"
                    onclick="event.preventDefault(); this.classList.add('hidden'); document.getElementById('add-to-cast-form').classList.toggle('hidden')">
                    Add to
                    <%= casts.any? ? "another" : "a" %>
                    cast
                </a>
            </div>
        <% end %>

        <div id="add-to-cast-form" class="hidden w-full mt-2">
            <% if available_casts.any? %>
                <%= form_with url: add_to_cast_person_path(production, person), method: :post, html: { class: "flex gap-2 items-center", data: { action: "cast-membership-card#add", cast_membership_card_target: "form" } } do |f| %>
                    <%= select_tag :cast_id, options_from_collection_for_select(available_casts, :id, :name), class: "block shadow-sm rounded-lg border px-3 py-2 w-full border-gray-400 focus:outline-pink-500" %>
                    <%= hidden_field_tag :person_id, person.id %>
                    <%= submit_tag "Add", class: "px-3 py-1 rounded bg-pink-500 text-white font-bold hover:bg-pink-600 cursor-pointer" %>
                <% end %>
            <% end %>
        </div>
    </div>
</div>