<% content_for :title, "#{@show.secondary_name.presence || @show.event_type.titleize} - #{@production.name}" %>

<div class="w-full bg-gradient-to-b from-gray-50 to-white min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">

    <%# Show Hero Section %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6">
      <% show_poster_variant = @show.safe_poster_variant(:small) %>
      <% production_poster = @production.primary_poster %>
      <% has_show_poster = show_poster_variant.present? %>
      <% has_production_poster = production_poster&.image&.attached? %>
      <% has_any_poster = has_show_poster || has_production_poster %>

      <div class="relative">
        <div class="absolute inset-0 bg-gradient-to-br from-pink-50 via-white to-purple-50 opacity-50"></div>

        <div class="relative flex flex-col sm:flex-row items-stretch">
          <% if has_any_poster %>
            <%# Poster - Left Side %>
            <div class="flex-shrink-0 w-full sm:w-48 md:w-64 bg-gray-50 flex items-center justify-center">
              <% if has_show_poster %>
                <%= image_tag show_poster_variant, class: "w-full h-auto object-contain max-h-80", alt: @show.secondary_name.presence || @show.event_type.titleize %>
              <% elsif has_production_poster %>
                <% production_poster_variant = production_poster.safe_image_variant(:small) %>
                <% if production_poster_variant %>
                  <%= image_tag production_poster_variant, class: "w-full h-auto object-contain max-h-80", alt: @production.name %>
                <% end %>
              <% end %>
            </div>
          <% end %>

          <%# Event Details - Right Side %>
          <div class="flex-1 p-6 sm:p-8">
            <%# Event Type Badge %>
            <div class="mb-3">
              <span class="inline-flex items-center rounded-md bg-pink-50 px-3 py-1 text-sm font-medium text-pink-700 ring-1 ring-inset ring-pink-600/10">
                <%= @show.event_type.titleize %>
              </span>
              <% if @show.past? %>
                <span class="inline-flex items-center rounded-md bg-gray-100 px-3 py-1 text-sm font-medium text-gray-600 ml-2">
                  Past Event
                </span>
              <% end %>
            </div>

            <%# Event Name %>
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 inter-bold leading-tight mb-2">
              <%= @show.secondary_name.presence || @show.event_type.titleize %>
            </h1>

            <%# Production Name %>
            <div class="text-lg text-gray-600 mb-4">
              <%= link_to @production.name, public_profile_path(@production.public_key), class: "hover:text-pink-600 transition-colors" %>
            </div>

            <%# Date and Time %>
            <div class="flex items-center gap-3 text-gray-700 mb-3">
              <svg class="w-5 h-5 text-pink-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <span class="font-medium"><%= @show.date_and_time.strftime("%A, %B %-d, %Y") %></span>
            </div>

            <div class="flex items-center gap-3 text-gray-700 mb-3">
              <svg class="w-5 h-5 text-pink-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span><%= @show.date_and_time.strftime("%l:%M %p") %></span>
            </div>

            <%# Online Event indicator (in hero) %>
            <% if @show.is_online? %>
              <div class="flex items-start gap-3 text-gray-700">
                <svg class="w-5 h-5 text-pink-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                </svg>
                <div>
                  <div class="font-medium">Online Event</div>
                  <% if @show.online_location_info.present? %>
                    <div class="text-sm text-gray-500"><%= @show.online_location_info %></div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <%# Show Links Section %>
    <% if @show.show_links.any? %>
      <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-gray-100">
          <h2 class="text-lg font-semibold text-gray-900">Links</h2>
        </div>
        <div class="p-4">
          <div class="flex flex-wrap gap-3">
            <% @show.show_links.each do |link| %>
              <%= link_to link.url, target: "_blank", rel: "noopener", class: "inline-flex items-center gap-2 px-4 py-2 bg-pink-50 text-pink-700 rounded-lg hover:bg-pink-100 transition-colors" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                </svg>
                <span><%= link.text.presence || "Link" %></span>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <%# Location Section with Map %>
    <% if @show.location.present? %>
      <% loc = @show.location %>
      <% address = [loc.address1, loc.address2, loc.city, loc.state, loc.postal_code].compact.reject(&:blank?).join(', ') %>
      <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-gray-100">
          <h2 class="text-xl font-semibold text-gray-900">Location</h2>
        </div>
        <div class="p-4 flex flex-col lg:flex-row gap-4">
          <%# Left: Location Info %>
          <div class="lg:w-1/3 space-y-3">
            <div>
              <div class="text-lg font-medium text-gray-900 mb-1"><%= loc.name %></div>
              <% if loc.address1.present? %>
                <div class="text-sm text-gray-700"><%= loc.address1 %></div>
              <% end %>
              <% if loc.address2.present? %>
                <div class="text-sm text-gray-700"><%= loc.address2 %></div>
              <% end %>
              <% if loc.city.present? || loc.state.present? || loc.postal_code.present? %>
                <div class="text-sm text-gray-700">
                  <%= loc.city %><% if loc.city.present? && loc.state.present? %>,<% end %> <%= loc.state %> <%= loc.postal_code %>
                </div>
              <% end %>
            </div>

            <div class="flex flex-wrap gap-2 pt-2">
              <a href="http://maps.apple.com/?address=<%= URI.encode_www_form_component(address) %>" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                </svg>
                Open in Maps
              </a>
              <a href="https://www.google.com/maps/search/?api=1&query=<%= URI.encode_www_form_component(address) %>" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                </svg>
                Google Maps
              </a>
            </div>
          </div>

          <%# Right: Map %>
          <div class="lg:w-2/3">
            <div class="w-full h-[300px] lg:h-full min-h-[250px]">
              <iframe
                width="100%"
                height="100%"
                style="border:0; border-radius: 0.5rem;"
                loading="lazy"
                allowfullscreen
                referrerpolicy="no-referrer-when-downgrade"
                src="https://www.google.com/maps?q=<%= URI.encode_www_form_component(address) %>&output=embed">
              </iframe>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <%# Cast Section (show if there are assignments) %>
    <% cast_assignments = @show.show_person_role_assignments %>
    <% if cast_assignments.any? %>
      <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-gray-100">
          <h2 class="text-xl font-semibold text-gray-900">Cast</h2>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3">
            <% cast_assignments.each do |assignment| %>
              <% member = assignment.assignable %>
              <% has_public_profile = member.respond_to?(:public_profile_enabled) && member.public_profile_enabled && member.public_key.present? %>
              <% if has_public_profile %>
                <%= link_to public_profile_path(member.public_key), class: "group text-center" do %>
                  <div class="aspect-square rounded-lg overflow-hidden bg-gray-100 mb-2">
                    <% if member.primary_headshot&.image&.attached? %>
                      <% headshot_variant = member.primary_headshot.safe_image_variant(:small) %>
                      <% if headshot_variant %>
                        <%= image_tag headshot_variant, class: "w-full h-full object-cover group-hover:scale-105 transition-transform", alt: member.name %>
                      <% else %>
                        <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-400 to-pink-600">
                          <span class="text-xl font-bold text-white"><%= member.initials %></span>
                        </div>
                      <% end %>
                    <% else %>
                      <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-400 to-pink-600">
                        <span class="text-xl font-bold text-white"><%= member.initials %></span>
                      </div>
                    <% end %>
                  </div>
                  <p class="text-xs font-medium text-gray-900 group-hover:text-pink-600 transition-colors truncate"><%= member.name %></p>
                  <% if member.is_a?(Group) %>
                    <p class="text-xs text-gray-500 truncate">Group</p>
                  <% end %>
                <% end %>
              <% else %>
                <div class="text-center">
                  <div class="aspect-square rounded-lg overflow-hidden bg-gray-100 mb-2">
                    <% if member.primary_headshot&.image&.attached? %>
                      <% headshot_variant = member.primary_headshot.safe_image_variant(:small) %>
                      <% if headshot_variant %>
                        <%= image_tag headshot_variant, class: "w-full h-full object-cover", alt: member.name %>
                      <% else %>
                        <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-300 to-gray-400">
                          <span class="text-xl font-bold text-white"><%= member.initials %></span>
                        </div>
                      <% end %>
                    <% else %>
                      <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-300 to-gray-400">
                        <span class="text-xl font-bold text-white"><%= member.initials %></span>
                      </div>
                    <% end %>
                  </div>
                  <p class="text-xs font-medium text-gray-700 truncate"><%= member.name %></p>
                  <% if member.is_a?(Group) %>
                    <p class="text-xs text-gray-500 truncate">Group</p>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <%# Footer %>
    <div class="text-center text-sm text-gray-400 mt-8">
      Powered by <a href="<%= root_path %>" class="text-pink-500 hover:text-pink-600">CocoScout</a>
    </div>

  </div>
</div>
