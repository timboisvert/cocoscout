<% content_for :title, @group.name %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      { text: "Groups", path: manage_groups_path }
    ],
    text: @group.name,
    links: [
      { text: "Edit Group", path: edit_manage_group_path(@group) },
      { text: "View Public Profile", path: public_profile_path(@group.public_key), target: "_blank" }
    ]
  } %>

  <div class="max-w-4xl mx-auto mt-6 space-y-6">

    <%# Group Info Card %>
    <div class="bg-white border border-gray-200 rounded-lg p-6">
      <div class="flex items-start gap-6">
        <% if @group.headshot.attached? %>
          <%= image_tag @group.headshot.variant(:thumb), class: "w-32 h-32 rounded-lg object-cover" %>
        <% else %>
          <div class="w-32 h-32 rounded-lg bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-3xl">
            <%= @group.initials %>
          </div>
        <% end %>

        <div class="flex-1">
          <h2 class="text-2xl font-bold text-gray-900"><%= @group.name %></h2>

          <% if @group.bio.present? %>
            <p class="text-gray-700 mt-3 whitespace-pre-line"><%= @group.bio %></p>
          <% end %>

          <div class="mt-4 space-y-2">
            <% if @group.email.present? %>
              <div class="flex items-center gap-2 text-sm">
                <svg width="16" height="16" class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                  <path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/>
                </svg>
                <%= @group.email %>
              </div>
            <% end %>

            <% if @group.phone.present? %>
              <div class="flex items-center gap-2 text-sm">
                <svg width="16" height="16" class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                  <path d="M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"/>
                </svg>
                <%= @group.phone %>
              </div>
            <% end %>

            <% if @group.website.present? %>
              <div class="flex items-center gap-2 text-sm">
                <svg width="16" height="16" class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                  <path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.3c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64H348.7c2.2 20.4 3.3 41.8 3.3 64zm28.8-64H503.9c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6c78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7c10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5c11.6 26 20.9 58.2 27 94.7zm-209 0H18.6C48.6 85.9 112.2 29.1 190.6 8.4C165.1 42.6 145.3 96.1 135.3 160zM8.1 192H131.2c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zM194.7 446.6c-11.6-26-20.9-58.2-27-94.6H344.3c-6.1 36.4-15.5 68.6-27 94.6c-10.5 23.6-22.2 40.7-33.5 51.5C272.6 508.8 263.3 512 256 512s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6C112.2 482.9 48.6 426.1 18.6 352H135.3zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6c25.5-34.2 45.2-87.7 55.3-151.6H493.4z"/>
                </svg>
                <%= link_to @group.website, @group.website, target: "_blank", rel: "noopener", class: "text-pink-600 hover:text-pink-700" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <%# Members Card %>
    <div class="bg-white border border-gray-200 rounded-lg p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">
        Members
        <span class="text-gray-500 font-normal">(<%= @group.group_memberships.count %>)</span>
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <% @group.group_memberships.includes(:person).each do |membership| %>
          <div class="flex items-center gap-3 p-3 border border-gray-200 rounded-lg">
            <%= link_to manage_person_path(membership.person), class: "flex items-center gap-3 flex-1 min-w-0" do %>
              <% if membership.person.headshot.attached? %>
                <%= image_tag membership.person.headshot.variant(:thumb), class: "w-12 h-12 rounded-lg object-cover" %>
              <% else %>
                <div class="w-12 h-12 rounded-lg bg-pink-100 flex items-center justify-center text-pink-600 font-bold">
                  <%= membership.person.initials %>
                </div>
              <% end %>

              <div class="flex-1 min-w-0">
                <div class="text-sm font-medium text-gray-900 truncate"><%= membership.person.name %></div>
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium <%= membership.owner? ? 'bg-pink-100 text-pink-700' : membership.write? ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700' %>">
                  <%= membership.permission_level.titleize %>
                </span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

  </div>

</div>
