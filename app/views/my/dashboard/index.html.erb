<div class="w-full">

  <!-- Upcoming Shows & Events -->
  <div class="border border-gray-200 rounded-lg overflow-hidden mb-6">
    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
      <h3 class="text-md font-semibold text-gray-900 coustard-regular">Upcoming Shows (next 45 days)</h3>
      <div class="flex gap-2">
        <%= link_to "My Shows & Events", my_shows_path, class: "text-pink-500 text-xs underline" %>
      </div>
    </div>
    <div class="p-4">
      <% if @upcoming_show_entities.any? %>
        <div class="space-y-3">
          <% @upcoming_show_entities.each do |item| %>
            <% show = item[:show] %>
            <% entity = item[:entity] %>
            <div class="flex items-start p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors gap-2">
              <%= link_to my_show_path(show), class: "flex-1 min-w-0 no-underline" do %>
                <p class="font-bold text-sm <%= 'line-through text-red-400' if show.canceled %>"><%= show.production.name %></p>
                <div class="text-xs text-gray-600 mt-1">
                  <% if show.canceled %>
                    <span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">Canceled</span>
                  <% end %>
                  <% event_label = show.event_type.titleize %>
                  <%= event_label %> on <span class="text-pink-500"><%= show.date_and_time.strftime('%A, %b %d, %Y') %></span> at <span class="text-pink-500"><%= show.date_and_time.strftime('%l:%M %p') %></span>
                </div>
                <% assignment = show.show_person_role_assignments.find { |a| a.assignable == entity } %>
                <% if assignment %>
                  <div class="text-xs text-gray-600 mt-1">
                    Role: <strong class="text-pink-500"><%= assignment.role.name %></strong>
                  </div>
                <% end %>
              <% end %>
              <% if @groups.any? %>
                <% headshot = entity.safe_headshot_variant(:thumb) %>
                <% if headshot %>
                  <%= image_tag headshot, class: "w-10 h-10 rounded-lg object-cover", alt: entity.name %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-sm">No upcoming shows & events scheduled.</p>
      <% end %>
    </div>
  </div>

  <!-- Upcoming Auditions -->
  <div class="border border-gray-200 rounded-lg overflow-hidden mb-6">
    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
      <h3 class="text-md font-semibold text-gray-900 coustard-regular">Upcoming Auditions</h3>
      <div class="flex gap-2">
        <%= link_to "My Auditions", my_auditions_path, class: "text-pink-500 text-xs underline" %>
      </div>
    </div>
    <div class="p-4">
      <% if @upcoming_audition_entities.any? %>
        <div class="space-y-3">
          <% @upcoming_audition_entities.each do |item| %>
            <% audition_session = item[:audition_session] %>
            <% entity = item[:entity] %>
            <% production = audition_session.production %>
            <div class="flex items-start p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors gap-2">
              <%= link_to my_auditions_path, class: "flex-1 min-w-0 no-underline" do %>
                <p class="font-bold text-sm"><%= production.name %></p>
                <div class="text-xs text-gray-600 mt-1">
                  Audition scheduled for <span class="text-pink-500"><%= audition_session.start_at.strftime('%A, %b %d, %Y') %></span> at <span class="text-pink-500"><%= audition_session.start_at.strftime('%l:%M %p') %></span>
                </div>
              <% end %>
              <% if @groups.any? %>
                <% headshot = entity.safe_headshot_variant(:thumb) %>
                <% if headshot %>
                  <%= image_tag headshot, class: "w-10 h-10 rounded-lg object-cover", alt: entity.name %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-sm">You don't have any upcoming auditions.</p>
      <% end %>
    </div>
  </div>

  <!-- Open Sign-ups -->
  <div class="border border-gray-200 rounded-lg overflow-hidden mb-6">
    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
      <h3 class="text-md font-semibold text-gray-900 coustard-regular">Open Sign-ups</h3>
      <div class="flex gap-2">
        <%= link_to "My Sign-ups", my_audition_requests_path(requests_filter: :all), class: "text-pink-500 text-xs underline" %>
      </div>
    </div>
    <div class="p-4">
      <% if @open_audition_request_entities.any? %>
        <div class="space-y-3">
          <% @open_audition_request_entities.each do |item| %>
            <% audition_request = item[:audition_request] %>
            <% entity = item[:entity] %>
            <% production = audition_request.audition_cycle.production %>
            <div class="flex items-start p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors gap-2">
              <%= link_to my_audition_requests_path(requests_filter: :open), class: "flex-1 min-w-0 no-underline" do %>
                <div <% if audition_request.audition_cycle.closes_at.present? %>data-controller="countdown" data-countdown-until-value="<%= audition_request.audition_cycle.closes_at.utc.iso8601 %>"<% end %>>
                  <p class="font-bold text-sm"><%= production.name %></p>
                  <div class="text-xs text-gray-600 mt-1">
                    <% if audition_request.audition_cycle.audition_type == "in_person" %>
                      Audition Sign-ups
                    <% elsif audition_request.audition_cycle.audition_type == "video_upload" %>
                      Video Auditions
                    <% end %>
                    <% if audition_request.audition_cycle.closes_at.present? %>
                      close
                      <% if audition_request.audition_cycle.closes_at > 1.day.from_now %>
                        on <span class="text-pink-500"><%= audition_request.audition_cycle.closes_at.strftime('%A, %b %d, %Y') %></span> at <span class="text-pink-500"><%= audition_request.audition_cycle.closes_at.strftime('%l:%M %p') %></span>
                      <% else %>
                        in <span data-countdown-target="clock" class="text-pink-500"></span>
                      <% end %>
                    <% else %>
                      <span class="text-gray-500">(open-ended)</span>
                    <% end %>
                  </div>
                </div>
              <% end %>
              <% if @groups.any? %>
                <% headshot = entity.safe_headshot_variant(:thumb) %>
                <% if headshot %>
                  <%= image_tag headshot, class: "w-10 h-10 rounded-lg object-cover", alt: entity.name %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-sm">None of the shows you've applied for are currently auditioning.</p>
      <% end %>
    </div>
  </div>

  <!-- Open Questionnaires -->
  <div class="border border-gray-200 rounded-lg overflow-hidden mb-6">
    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
      <h3 class="text-md font-semibold text-gray-900 coustard-regular">Open Questionnaires</h3>
      <div class="flex gap-2">
        <%= link_to "My Questionnaires", my_questionnaires_path, class: "text-pink-500 text-xs underline" %>
      </div>
    </div>
    <div class="p-4">
      <% if @pending_questionnaire_entities.any? %>
        <div class="space-y-3">
          <% @pending_questionnaire_entities.each do |item| %>
            <% questionnaire = item[:questionnaire] %>
            <% entity = item[:entity] %>
            <% production = questionnaire.production %>
            <div class="flex items-start p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors gap-2">
              <%= link_to my_questionnaires_path, class: "flex-1 min-w-0 no-underline" do %>
                <p class="font-bold text-sm"><%= production.name %></p>
                <div class="text-xs text-gray-600 mt-1">
                  <%= questionnaire.title %>
                  <% if questionnaire.questionnaire_responses.exists?(respondent: entity) %>
                    - <span class="text-pink-600">Responded</span>
                  <% else %>
                    - <span class="text-pink-500">Not yet responded</span>
                  <% end %>
                </div>
              <% end %>
              <% if @groups.any? %>
                <% headshot = entity.safe_headshot_variant(:thumb) %>
                <% if headshot %>
                  <%= image_tag headshot, class: "w-10 h-10 rounded-lg object-cover", alt: entity.name %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-sm">You don't have any pending questionnaires.</p>
      <% end %>
    </div>
  </div>

</div>
