<% content_for :title, "Agreement - #{@production.name}" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice, alert: alert } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Productions", my_productions_path],
      [@production.name, my_production_path(@production)]
    ],
    text: "Agreement"
  } %>

  <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
    <% if @signature.present? %>
      <!-- Already Signed -->
      <div class="p-4 bg-pink-50 border-b border-pink-200">
        <div class="flex items-center gap-3">
          <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-pink-200">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-pink-700">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </span>
          <div>
            <p class="text-sm font-medium text-pink-800">Agreement Signed</p>
            <p class="text-sm text-pink-700">You signed this agreement on <%= @signature.signed_on %></p>
          </div>
        </div>
      </div>

      <div class="p-6">
        <div class="prose prose-sm max-w-none text-gray-700">
          <%= simple_format(markdown_to_html(@signature.content_snapshot)) %>
        </div>
      </div>

      <!-- TODO: PDF download button -->
      <!--
      <div class="p-4 border-t border-gray-200 bg-gray-50">
        <button class="text-sm text-pink-600 hover:text-pink-700 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          Download PDF
        </button>
      </div>
      -->

    <% elsif @agreement_content.present? %>
      <!-- Needs Signature -->
      <div class="p-4 bg-pink-50 border-b border-pink-200">
        <div class="flex items-start gap-3">
          <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-pink-200 flex-shrink-0 mt-0.5">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-pink-700">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </span>
          <div>
            <p class="text-sm font-medium text-pink-800">Agreement Required</p>
            <p class="text-sm text-pink-700">
              Please review and sign this agreement to be eligible for casting in <%= @production.name %>.
            </p>
          </div>
        </div>
      </div>

      <div class="p-6">
        <div class="prose prose-sm max-w-none text-gray-700 mb-6 [&_ul]:list-disc [&_ul]:pl-5 [&_ol]:list-decimal [&_ol]:pl-5 [&_li]:my-1">
          <%= @agreement_content %>
        </div>

        <%= form_with url: my_sign_production_agreement_path(@production), method: :post, class: "border-t border-gray-200 pt-6" do |f| %>
          <div class="flex items-start gap-3 mb-6">
            <input type="checkbox"
                   id="agree_checkbox"
                   required
                   class="mt-1 h-4 w-4 rounded border-gray-300 accent-pink-500">
            <label for="agree_checkbox" class="text-sm text-gray-700">
              I have read and agree to the terms of this agreement
            </label>
          </div>

          <%= render "shared/button", text: "Sign Agreement", variant: "primary", size: "medium", type: :submit %>
        <% end %>
      </div>

    <% else %>
      <!-- No Agreement Required -->
      <div class="p-6 text-center">
        <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No Agreement Required</h3>
        <p class="text-gray-600">This production doesn't require a performer agreement.</p>
      </div>
    <% end %>
  </div>
</div>
