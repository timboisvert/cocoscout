<% content_for :title, "Contracts" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice, alert: alert } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Money", manage_money_index_path]
    ],
    text: "Contracts",
    links: [
      { icon: "plus", text: "New Contract", path: manage_new_contract_wizard_path }
    ]
  } %>

  <%# Payments Card - only show if there are late or upcoming payments %>
  <% if @has_payments %>
    <div class="border border-gray-200 rounded-lg overflow-hidden mb-8">
      <%= render "shared/card_header", title: "Late and Upcoming Payments" %>
      <div class="p-4 space-y-2">
        <%# Late payments first %>
        <% @late_payments.each do |payment| %>
          <%= render "contract_payment_row", payment: payment %>
        <% end %>

        <%# Then upcoming payments %>
        <% @upcoming_payments.each do |payment| %>
          <%= render "contract_payment_row", payment: payment %>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Contracts List %>
  <% if @sorted_contracts.any? %>
    <div class="border border-gray-200 rounded-lg overflow-hidden mb-8">
      <%= render "shared/card_header", title: "Active Contracts" %>
      <div class="p-4 space-y-2">
        <% @sorted_contracts.each do |contract| %>
          <%= render "contract_list_row", contract: contract %>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Past Contracts %>
  <% if @completed_contracts.any? %>
    <div class="border border-gray-200 rounded-lg overflow-hidden mb-8">
      <%= render "shared/card_header", title: "Past Contracts" %>
      <div class="p-4 space-y-2">
        <% @completed_contracts.each do |contract| %>
          <%= render "contract_list_row", contract: contract %>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Empty state %>
  <% if @contracts.empty? %>
    <div class="bg-gray-50 rounded-lg border border-dashed border-gray-300 p-12 text-center">
      <%= icon("file-text", class: "w-12 h-12 text-gray-400 mx-auto mb-4") %>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No contracts yet</h3>
      <p class="text-gray-600 mb-4">
        Create a contract when an external group wants to rent your space or perform at your venue.
      </p>
      <%= render "shared/button", text: "New Contract", variant: "primary", icon: "plus", path: manage_new_contract_wizard_path %>
    </div>
  <% end %>
</div>
