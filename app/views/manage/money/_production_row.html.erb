<%#
  Money Production Row - Four Panel Layout

  Required:
    - summary: Hash with production summary data

  Optional:
    - link_path: Path to navigate to when clicking (defaults to financials)

  Panels (in-house):
    1. Production name and basic info
    2. Gross Revenue
    3. Direct Costs
    4. Gross Profit

  Panels (third-party):
    1. Production name and basic info
    2. Contract Revenue (received)
    3. Pending Payments
    4. Status indicator
%>

<%
  production = summary[:production]
  is_third_party = summary[:is_third_party]
  gross_revenue = summary[:gross_revenue] || 0
  row_link_path = local_assigns[:link_path] || manage_money_production_financials_path(production)
%>

<div class="bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all">
  <%= link_to row_link_path, class: "block" do %>
    <div class="flex flex-col lg:flex-row lg:items-stretch">

      <%# Panel 1: Production Info %>
      <div class="flex-1 flex items-center gap-4 px-4 py-3 rounded-t-lg lg:rounded-l-lg lg:rounded-tr-none">
        <%# Production Logo or Initials %>
        <% logo_variant = production.safe_logo_variant(:small) %>
        <% if logo_variant %>
          <div class="flex-shrink-0 w-14 h-8 rounded flex items-center justify-center overflow-hidden">
            <%= image_tag logo_variant, alt: "#{production.name} logo", class: "w-full h-full object-cover rounded" %>
          </div>
        <% else %>
          <div class="flex-shrink-0 w-14 h-8 rounded-lg bg-pink-100 flex items-center justify-center">
            <span class="text-sm font-bold text-pink-600"><%= production.initials %></span>
          </div>
        <% end %>

        <%# Production Details %>
        <div class="flex-1 min-w-0">
          <div class="flex items-center gap-2">
            <span class="font-medium text-gray-900"><%= production.name %></span>
            <% if is_third_party %>
              <span class="inline-flex items-center rounded-full bg-pink-100 px-2 py-0.5 text-xs font-medium text-pink-700">Contract</span>
            <% end %>
          </div>
          <div class="text-sm text-gray-600">
            <% if is_third_party %>
              <%= summary[:total_shows] %> <%= "event".pluralize(summary[:total_shows]) %>
            <% else %>
              <%= summary[:revenue_shows] %> revenue <%= "event".pluralize(summary[:revenue_shows]) %>
            <% end %>
          </div>
        </div>
      </div>

      <% if is_third_party %>
        <%# Check for revenue share contracts %>
        <% is_revenue_share = summary[:is_revenue_share] %>
        <% our_share = summary[:our_share] %>
        <% their_share = summary[:their_share] %>

        <%# Third-party: Contract Revenue %>
        <div class="w-full lg:w-1/4 px-4 py-3 border-t lg:border-t-0 lg:border-l border-gray-200 flex flex-col justify-center">
          <% if is_revenue_share %>
            <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Revenue Share</div>
            <div class="text-sm font-medium text-gray-900"><%= our_share %>/<%= their_share %> Split</div>
            <div class="text-[10px] text-gray-500">We receive <%= our_share %>%</div>
          <% else %>
            <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Contract Revenue</div>
            <div class="text-sm font-medium text-gray-900"><%= number_to_currency(gross_revenue) %></div>
          <% end %>
        </div>

        <%# Third-party: Pending Payments %>
        <div class="w-full lg:w-1/4 px-4 py-3 border-t lg:border-t-0 lg:border-l border-gray-200 flex flex-col justify-center">
          <% if is_revenue_share %>
            <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Received</div>
            <% if gross_revenue > 0 %>
              <div class="text-sm font-medium text-gray-900"><%= number_to_currency(gross_revenue) %></div>
            <% else %>
              <div class="text-sm text-gray-400">TBD</div>
            <% end %>
          <% else %>
            <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Pending</div>
            <% pending_amount = summary[:pending_amount] || 0 %>
            <% if pending_amount > 0 %>
              <div class="text-sm font-medium text-amber-600"><%= number_to_currency(pending_amount) %></div>
            <% else %>
              <div class="text-sm text-gray-400">$0.00</div>
            <% end %>
          <% end %>
        </div>

        <%# Third-party: Status %>
        <div class="w-full lg:w-1/4 px-4 py-3 border-t lg:border-t-0 lg:border-l border-gray-200 rounded-b-lg lg:rounded-r-lg lg:rounded-bl-none flex flex-col justify-center">
          <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Status</div>
          <% overdue_count = summary[:overdue_count] || 0 %>
          <% pending_count = summary[:pending_count] || 0 %>
          <% if overdue_count > 0 %>
            <div class="text-sm font-medium text-red-600"><%= overdue_count %> overdue</div>
          <% elsif pending_count > 0 %>
            <div class="text-sm font-medium text-amber-600"><%= pending_count %> pending</div>
          <% else %>
            <div class="text-sm font-medium text-green-600">All received</div>
          <% end %>
        </div>

      <% else %>
        <%# In-house: Gross Revenue %>
        <%
          production_expenses = summary[:production_expenses] || 0
          cost_of_shows = (summary[:show_expenses] || 0) + production_expenses + (summary[:total_payouts] || 0)
          gross_profit = gross_revenue - cost_of_shows
        %>
        <div class="w-full lg:w-1/4 px-4 py-3 border-t lg:border-t-0 lg:border-l border-gray-200 flex flex-col justify-center">
          <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Gross Revenue</div>
          <div class="text-sm font-medium text-gray-900"><%= number_to_currency(gross_revenue) %></div>
        </div>

        <%# In-house: Direct Costs %>
        <div class="w-full lg:w-1/4 px-4 py-3 border-t lg:border-t-0 lg:border-l border-gray-200 flex flex-col justify-center">
          <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Direct Costs</div>
          <% if cost_of_shows > 0 %>
            <div class="text-sm font-medium text-red-600"><%= number_to_currency(cost_of_shows) %></div>
          <% else %>
            <div class="text-sm text-gray-400">$0.00</div>
          <% end %>
        </div>

        <%# In-house: Gross Profit %>
        <div class="w-full lg:w-1/4 px-4 py-3 border-t lg:border-t-0 lg:border-l border-gray-200 rounded-b-lg lg:rounded-r-lg lg:rounded-bl-none flex flex-col justify-center">
          <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Gross Profit</div>
          <div class="text-sm font-medium <%= gross_profit >= 0 ? 'text-green-600' : 'text-red-600' %>">
            <%= number_to_currency(gross_profit) %>
          </div>
        </div>
      <% end %>

    </div>
  <% end %>
</div>
