<% content_for :title, "My Shows" %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
        ["Shows & Events", my_shows_path]
    ],
    text: @production.name,
    links: []
  } %>

    <div class="grid grid-cols-1 gap-1 mt-2">

        <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex flex-col sm:flex-row sm:items-top gap-4">
            <div class="w-full sm:w-auto sm:flex-shrink-0 flex items-top">
                <% logo_variant = @production.safe_logo_variant(:small) %>
                <% if logo_variant %>
                    <%= image_tag logo_variant, alt: "#{@production.name} logo", class: "w-full sm:w-[100px] object-contain rounded" %>
                <% end %>
            </div>
            <div class="w-full sm:w-auto text-left flex items-top">
                <div class="font-bold text-lg sm:text-xl"><%= @production.name %></div>
            </div>
        </div>

        <div class="col-span-1">

            <% @shows.each do |show| %>

                <%= link_to my_show_path(show.production, show), class: "" do %>
                    <% assignment = @assignments_by_show[show] %>
                    <div class="mb-1 border p-3 rounded-lg border-gray-200 hover:border-gray-400">

                        <div class="flex items-start gap-2">
                            <div class="flex-1">
                                <div class="font-bold">
                                    <% date_classes = show.canceled ? "text-red-400 line-through" : "" %>
                                    <div class="text-sm sm:text-base font-semibold <%= date_classes %>">
                                        <%= show.date_and_time.strftime("%B %d, %Y") %> <span class="font-normal">at</span>
                                        <%= show.date_and_time.strftime("%l:%M %p") %>
                                        <% if show.canceled %>
                                            <span class="inline-flex items-center rounded-md bg-red-50 px-1.5 py-0.5 text-[10px] sm:text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10 ml-2">Canceled</span>
                                        <% end %>
                                    </div>
                                </div>

                                <div class="flex items-center gap-1 flex-wrap">
                                    <% event_type_badge_classes = case show.event_type
                                        when "rehearsal" then "bg-blue-50 text-blue-700 ring-blue-600/10"
                                        when "meeting" then "bg-green-50 text-green-700 ring-green-600/10"
                                        else "bg-pink-50 text-pink-700 ring-pink-600/10"
                                    end %>
                                    <span class="mr-2 inline-flex items-center justify-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset <%= event_type_badge_classes %>">
                                        <%= show.event_type.titleize %>
                                    </span>

                                    <% if show.secondary_name.present? %>
                                        <span class="text-xs sm:text-sm text-gray-600 font-medium"><%= show.secondary_name %></span>
                                    <% end %>

                                    <span class="inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-[10px] sm:text-xs font-medium ring-1 ring-inset bg-gray-50 text-gray-700 ring-gray-600/10">
                                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" /></svg>
                                      <%= show.location.name %>
                                    </span>
                                </div>

                                <% if show.event_type == "show" %>
                                    <div class="text-sm text-gray-500 mt-1">
                                        <% if assignment %>
                                            My Role: <strong class="text-pink-500"><%= assignment.role.name %></strong>
                                        <% else %>
                                            You aren't assigned a role for this show.
                                        <% end %>
                                    </div>
                                <% end %>
                            </div>
                        </div>

                    </div>
                <% end %>

            <% end %>
        </div>

    </div>



</div>