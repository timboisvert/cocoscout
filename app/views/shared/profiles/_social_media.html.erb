<%
  # Social Media & Links section
  # Parameters:
  # - entity: Person or Group instance
  entity_name = entity.is_a?(Person) ? 'person' : 'group'
  form_url = entity.is_a?(Person) ? update_profile_path : update_group_path(entity)
%>

<div id="social-media" class="bg-white border border-gray-200 rounded-lg overflow-hidden mb-6" data-controller="profile-section">
<%= form_with(model: entity, scope: entity_name, url: form_url, method: :patch, id: "social-media-form", data: { controller: "profile-auto-save", turbo: true }) do |entity_form| %>
  <%= render "shared/section_header",
    title: "Social Media & Links",
    collapsible: true,
    visibility_toggle: entity.is_a?(Person),
    visibility_field: "social_media_visible",
    visibility_checked: entity.is_a?(Person) ? entity.social_media_visible? : true %>

  <div class="p-6" data-profile-section-target="content">
    <div data-controller="socials">
      <div id="socials-fields" data-socials-target="list" class="space-y-2">
        <%= entity_form.fields_for :socials do |social_form| %>
          <div class="flex items-center gap-2 socials-fields-row" data-socials-target="row"<% if social_form.object.persisted? %> data-socials-persisted="true"<% end %>>
            <%= social_form.hidden_field :id %>
            <%= social_form.hidden_field :_destroy, value: "0", data: { socials_target: "destroy", action: "change->profile-auto-save#save" } %>
            <%= social_form.select :platform, Social.platforms.keys.map { |k| [k.titleize, k] }, {}, class: "w-32 rounded-lg border border-gray-300 px-3 py-2", data: { action: "change->profile-auto-save#save" } %>
            <%= social_form.text_field :handle, placeholder: "Username/Handle", class: "flex-1 rounded-lg border border-gray-300 px-3 py-2", data: { action: "blur->profile-auto-save#save" } %>
            <button type="button" class="text-xs text-pink-500 hover:text-pink-700 underline cursor-pointer flex-shrink-0" data-action="socials#remove">Remove</button>
          </div>
        <% end %>
      </div>
      <div class="mt-2">
        <button type="button"
                class="inline-flex items-center gap-2 px-4 py-2 bg-white hover:bg-pink-50 text-pink-600 border border-pink-200 hover:border-pink-300 rounded-lg text-sm font-medium transition-all cursor-pointer"
                data-action="socials#add">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          Add Social
        </button>
      </div>
      <template id="socials-template" data-entity-name="<%= entity_name %>">
        <div class="flex items-center gap-2 socials-fields-row" data-socials-target="row">
          <select name="" class="w-32 rounded-lg border border-gray-300 px-3 py-2" data-field-type="platform">
            <% Social.platforms.keys.each do |platform| %>
              <option value="<%= platform %>"><%= platform.titleize %></option>
            <% end %>
          </select>
          <input type="text" name="" class="flex-1 rounded-lg border border-gray-300 px-3 py-2" placeholder="Username/Handle" data-field-type="handle" />
          <button type="button" class="text-xs text-pink-500 hover:text-pink-700 underline cursor-pointer flex-shrink-0" data-action="socials#remove">Remove</button>
        </div>
      </template>
    </div>
  </div>
<% end %>
</div>
