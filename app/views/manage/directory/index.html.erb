<% content_for :title, "Directory" %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Directory",
    links: [
      { text: "Invite People", path: new_manage_person_path, global_manager_required: true }
    ]
  } %>

  <% if @entries.any? %>

    <div data-controller="show-toggle" class="mb-4">
      <!-- Mobile filter button -->
      <button type="button" data-action="click->show-toggle#toggle" class="lg:hidden w-full flex items-center justify-between px-4 py-2 mb-3 rounded-md border border-gray-200 bg-white text-gray-700 hover:border-gray-300">
        <span class="text-sm font-medium">Filters & View Options</span>
        <span data-show-toggle-target="icon">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </span>
      </button>

      <!-- Filter sections -->
      <div data-show-toggle-target="content" class="hidden lg:flex flex-col lg:flex-row w-full space-y-3 lg:space-y-0 lg:space-x-2">

        <div class="flex space-x-1 lg:flex-1">
          <!-- Left: Sorting links -->
          <div class="flex items-center text-sm text-gray-500">Sort:</div>
        <%= link_to "Aâ†’Z",
                manage_directory_path(order: "alphabetical"),
                data: { turbo_prefetch: false },
                class: "px-3 py-1 rounded-md border text-sm #{(@order == "alphabetical") ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
        <%= link_to "Newest",
                manage_directory_path(order: "newest"),
                data: { turbo_prefetch: false },
                class: "px-3 py-1 rounded-md border text-sm #{(@order == "newest") ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
        <%= link_to "Oldest",
                manage_directory_path(order: "oldest"),
                data: { turbo_prefetch: false },
                class: "px-3 py-1 rounded-md border text-sm #{(@order == "oldest") ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
      </div>

      <div class="flex space-x-1 lg:flex-1 lg:justify-center">
        <!-- Center: Show links -->
        <div class="flex items-center text-sm text-gray-500">Show:</div>

        <%= link_to manage_directory_path(show: "tiles"), class: "px-2 py-1 rounded-md border #{@show == 'tiles' ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
          </svg>
        <% end %>

        <%= link_to manage_directory_path(show: "list"), class: "px-2 py-1 rounded-md border #{@show == 'list' ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        <% end %>
      </div>

      <div class="flex space-x-1 lg:flex-1 lg:justify-end">
        <!-- Right: Type filter -->
        <div class="flex items-center text-sm text-gray-500">Show:</div>
        <%= link_to "All",
                manage_directory_path(type: "all"),
                class: "px-3 py-1 rounded-md border text-sm #{@type == 'all' ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
        <%= link_to "People",
                manage_directory_path(type: "people"),
                class: "px-3 py-1 rounded-md border text-sm #{@type == 'people' ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
        <%= link_to "Groups",
                manage_directory_path(type: "groups"),
                class: "px-3 py-1 rounded-md border text-sm #{@type == 'groups' ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
      </div>

      <div class="flex space-x-1 lg:flex-1">
        <!-- Include filter -->
        <div class="flex items-center text-sm text-gray-500">Include:</div>
        <%= link_to "Cast Members",
                manage_directory_path(filter: "cast-members"),
                class: "px-3 py-1 rounded-md border text-sm text-nowrap #{@filter == 'cast-members' ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
        <%= link_to "Everyone",
                manage_directory_path(filter: "everyone"),
                class: "px-3 py-1 rounded-md border text-sm #{@filter == 'everyone' ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
      </div>

      </div>
    </div>

    <% if @show == "tiles" %>
      <div class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-2 w-full mt-4">
        <% @entries.each do |entry| %>

          <%= link_to entry.is_a?(Person) ? manage_directory_person_path(entry) : manage_directory_group_path(entry) do %>
            <div class="flex flex-col items-center p-2 bg-white border border-gray-200 rounded-lg hover:border-gray-400 transition-all relative group cursor-pointer" >
              <% headshot_variant = entry.safe_headshot_variant(:thumb) %>
              <% if headshot_variant %>
                  <%= image_tag headshot_variant, alt: entry.name, class: "w-14 h-14 rounded-lg object-cover mb-1.5" %>
              <% elsif entry.is_a?(Person) %>
                  <div class="w-14 h-14 rounded-lg bg-gray-100 flex items-center justify-center mb-1.5 text-black font-bold text-sm">
                      <%= entry.initials %>
                  </div>
              <% else %>
                  <div class="w-14 h-14 rounded-lg bg-blue-100 flex items-center justify-center mb-1.5 text-blue-600">
                      <i class="fa-solid fa-users text-xl"></i>
                  </div>
              <% end %>
              <span class="font-medium text-xs text-center leading-tight h-8 flex items-center overflow-hidden"><%= entry.name.truncate(18, omission: '...') %></span>
            </div>
          <% end %>
        <% end %>
      </div>
    <% elsif @show == "list" %>
      <div class="flex flex-col w-full mt-4 space-y-2">
        <% @entries.each do |entry| %>
          <%= link_to entry.is_a?(Person) ? manage_directory_person_path(entry) : manage_directory_group_path(entry), class: "flex bg-white items-center p-2 border border-gray-200 rounded-lg hover:border-gray-400 transition-all group cursor-pointer" do %>
            <% headshot_variant = entry.safe_headshot_variant(:thumb) %>
            <% if headshot_variant %>
              <%= image_tag headshot_variant, alt: entry.name, class: "w-8 h-8 rounded-lg object-cover mr-3" %>
            <% elsif entry.is_a?(Person) %>
              <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center mr-3 text-black font-bold">
                <%= entry.initials %>
              </div>
            <% else %>
              <div class="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center mr-3 text-blue-600">
                <i class="fa-solid fa-users text-sm"></i>
              </div>
            <% end %>
            <span class="font-medium text-base"><%= entry.name %></span>
          <% end %>
        <% end %>
      </div>
    <% end %>

    <% if @pagy.pages > 1 %>
      <div class="my-6">
        <nav class="flex items-center gap-2">
          <% if @pagy.page > 1 %>
            <%= link_to "Previous", manage_directory_path(page: @pagy.page - 1, order: params[:order], show: params[:show], filter: params[:filter], type: params[:type]), class: "inline-flex items-center justify-center rounded-md border border-slate-200 px-3 py-1 text-sm font-medium text-slate-700 transition hover:border-pink-400 hover:bg-pink-50 hover:text-pink-600" %>
          <% else %>
            <span class="inline-flex items-center justify-center rounded-md border border-slate-200 px-3 py-1 text-sm text-slate-300 cursor-not-allowed">Previous</span>
          <% end %>

          <span class="text-sm text-slate-600">Page <%= @pagy.page %> of <%= @pagy.pages %></span>

          <% if @pagy.page < @pagy.pages %>
            <%= link_to "Next", manage_directory_path(page: @pagy.page + 1, order: params[:order], show: params[:show], filter: params[:filter], type: params[:type]), class: "inline-flex items-center justify-center rounded-md border border-slate-200 px-3 py-1 text-sm font-medium text-slate-700 transition hover:border-pink-400 hover:bg-pink-50 hover:text-pink-600" %>
          <% else %>
            <span class="inline-flex items-center justify-center rounded-md border border-slate-200 px-3 py-1 text-sm text-slate-300 cursor-not-allowed">Next</span>
          <% end %>
        </nav>
      </div>
    <% end %>

  <% else %>
    <div class="text-left text-gray-500 text-sm">No entries found.</div>
  <% end %>

</div>
