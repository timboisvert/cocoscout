<%
  # Social Media & Links section
  # Parameters:
  # - entity: Person or Group instance
  entity_name = entity.is_a?(Person) ? 'person' : 'group'
  form_url = entity.is_a?(Person) ? update_profile_path(entity) : update_group_path(entity)
  socials = entity.socials.reject(&:marked_for_destruction?)
%>

<div id="social-media" class="bg-white border border-gray-200 rounded-lg overflow-hidden mb-6" data-controller="profile-section">
  <%= render "shared/section_header",
    entity: entity,
    title: "Social Media & Links",
    collapsible: true,
    visibility_toggle: true,
    visibility_field: "social_media_visible",
    visibility_checked: entity.social_media_visible? %>

  <div class="p-6" data-profile-section-target="content">
    <% if socials.any? %>
      <div class="space-y-2 mb-4">
        <% socials.each do |social| %>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
            <div class="flex items-center gap-3">
              <div class="flex items-center gap-2">
                <%= render "shared/social_icon", platform: social.platform, size_class: "w-4 h-4", color_class: "text-gray-600" %>
                <span class="px-2 py-1 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded"><%= social_platform_display_name(social.platform) %></span>
              </div>
              <% if social.platform.in?(['website', 'other']) %>
                <div class="flex flex-col">
                  <span class="text-sm text-gray-900"><%= social.display_name %></span>
                  <span class="text-xs text-gray-500">https://<%= social.handle %></span>
                </div>
              <% else %>
                <span class="text-sm text-gray-900"><%= social.display_name %></span>
              <% end %>
            </div>
            <div class="flex items-baseline gap-3">
              <button type="button"
                      data-action="click->profile-modals#openEditSocial"
                      data-social-id="<%= social.id %>"
                      data-social-platform="<%= social.platform %>"
                      data-social-handle="<%= social.handle %>"
                      data-social-name="<%= social.name %>"
                      class="text-xs text-pink-500 hover:text-pink-600 underline cursor-pointer leading-none">
                Edit
              </button>
              <%= form_with(model: entity, scope: entity_name, url: form_url, method: :patch, class: "inline m-0 leading-none") do |f| %>
                <%= f.fields_for :socials, social do |sf| %>
                  <%= sf.hidden_field :id %>
                  <%= sf.hidden_field :_destroy, value: "1" %>
                  <button type="submit" class="text-xs text-pink-500 hover:text-pink-600 underline cursor-pointer leading-none">Remove</button>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-sm text-gray-500 mb-4">No social media links added yet.</p>
    <% end %>

    <%= render "shared/button",
        text: "Add Social Media/Link",
        variant: "outline-pink",
        icon: "plus",
        data: { action: "click->profile-modals#openAddSocial" },
        type: :button %>
  </div>
</div>
