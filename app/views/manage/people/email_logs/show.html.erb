<% content_for :title, "Email: #{@email_log.subject || '(No subject)'}" %>

<div class="w-full">
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Directory", manage_directory_path],
      [@person.name, manage_person_path(@person)],
      ["Emails", manage_person_email_logs_path(@person)]
    ],
    text: @email_log.subject || "(No subject)",
    links: []
  } %>

  <div class="bg-white shadow overflow-hidden sm:rounded-lg">
    <!-- Email metadata -->
    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
      <div class="space-y-3">
        <div>
          <h3 class="text-lg leading-6 font-medium text-gray-900">
            <%= @email_log.subject || "(No subject)" %>
          </h3>
        </div>
        
        <div class="grid grid-cols-1 gap-3 sm:grid-cols-2">
          <div>
            <dt class="text-sm font-medium text-gray-500">From</dt>
            <dd class="mt-1 text-sm text-gray-900">
              <%= @email_log.user&.email_address || "Unknown" %>
            </dd>
          </div>
          
          <div>
            <dt class="text-sm font-medium text-gray-500">To</dt>
            <dd class="mt-1 text-sm text-gray-900">
              <%= @email_log.recipient %>
            </dd>
          </div>
          
          <div>
            <dt class="text-sm font-medium text-gray-500">Sent</dt>
            <dd class="mt-1 text-sm text-gray-900">
              <%= @email_log.sent_at&.strftime("%B %d, %Y at %l:%M %p") || @email_log.created_at.strftime("%B %d, %Y at %l:%M %p") %>
            </dd>
          </div>
          
          <div>
            <dt class="text-sm font-medium text-gray-500">Status</dt>
            <dd class="mt-1">
              <% if @email_log.delivery_status == "delivered" %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  Delivered
                </span>
              <% elsif @email_log.delivery_status == "failed" %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  Failed
                </span>
              <% else %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                  <%= @email_log.delivery_status.titleize %>
                </span>
              <% end %>
            </dd>
          </div>
        </div>
      </div>
    </div>

    <!-- Email body -->
    <div class="px-4 py-5 sm:p-6">
      <div class="prose max-w-none">
        <%= sanitize @email_log.body, tags: %w[p br strong em u a h1 h2 h3 h4 h5 h6 ul ol li blockquote img table thead tbody tr th td div span], attributes: %w[href src alt title class] %>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <%= link_to "â† Back to Emails", manage_person_email_logs_path(@person), class: "text-sm text-pink-600 hover:text-pink-700 font-medium" %>
  </div>
</div>
