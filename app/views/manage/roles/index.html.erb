<% content_for :title, "Roles" %>

<div class="w-full">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Roles",
    links: []
  } %>

  <p class="text-sm text-gray-500">Roles represent the parts within your production. For example, "Host" or "Comic 1"</p>

  <div class="flex flex-col md:flex-row gap-2 mt-4">

    <div class="flex-1 space-y-2">
      <% if @roles.any? %>
        <div data-controller="role-order" data-role-order-url-value="<%= reorder_manage_production_roles_path(@production) %>">
          <% @roles.each do |role| %>
            <div class="p-4 bg-white border border-gray-200 rounded-lg hover:border-gray-400 transition-all flex cursor-move mb-2" draggable="true" data-role-order-target="item" data-id="<%= role.id %>" data-action="dragstart->role-order#startDrag dragend->role-order#endDrag dragover->role-order#dragOver drop->role-order#drop touchstart->role-order#touchStart touchmove->role-order#touchMove touchend->role-order#touchEnd">
              <div class="flex items-center gap-4 flex-1">
                <span class="text-gray-400 cursor-move" title="Drag to reorder">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5" />
                  </svg>
                </span>
                <div class="flex-1">
                  <div class="font-bold text-md">
                    <%= role.name %>
                  </div>
                  <% if current_user_can_manage?(@production) %>
                    <div class="flex gap-2 items-center mt-1">
                      <%= link_to "Edit",
                          edit_manage_production_role_path(@production, role),
                          class: "text-xs underline text-pink-500 hover:text-pink-600"
                      %>
                      <%= link_to "Delete",
                          manage_production_role_path(@production, role),
                          class: "text-xs underline text-pink-500 hover:text-pink-600 cursor-pointer",
                          data: {
                            turbo_method: :delete,
                            turbo_confirm: "Are you sure you want to delete this role?"
                          }
                      %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-sm">
          No roles have been added.
        </p>
      <% end %>
    </div>

    <% if current_user_can_manage?(@production) %>
      <div class="flex-1">

        <div class="sticky top-4 border border-gray-200 rounded-lg overflow-hidden">
          <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
            <h3 class="text-sm font-semibold text-gray-900">Add a Role</h3>
          </div>
          <div class="p-4">
            <%= form_with(model: [:manage, @production, @role]) do |form| %>
              <div class="mb-2">
                <% if @role.errors[:name].any? %>
                  <p class="text-sm text-pink-600 mb-2"><%= @role.errors[:name].first %></p>
                <% end %>
                <div class="flex gap-2">
                  <%= form.text_field :name, placeholder: "Role name", autofocus: true, class: ["block shadow-sm rounded-lg border px-3 py-2 flex-1", {"border-gray-400": @role.errors[:name].none?, "border-pink-500": @role.errors[:name].any?}] %>
                  <%= form.submit "Add Role", class: "px-3 py-2 rounded-lg bg-pink-500 text-white font-bold hover:bg-pink-600 cursor-pointer whitespace-nowrap" %>
                </div>
              </div>
            <% end %>
          </div>
        </div>

      </div>
    <% end %>

  </div>

</div>
