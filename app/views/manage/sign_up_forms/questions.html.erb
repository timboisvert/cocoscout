<% content_for :title, "Questions - #{@sign_up_form.name}" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Sign-ups", manage_production_sign_up_forms_path(@production)],
      [@sign_up_form.name, manage_production_sign_up_form_path(@production, @sign_up_form)]
    ],
    text: "Questions",
    links: []
  } %>

  <!-- Navigation Tabs -->
  <div class="mb-6">
    <nav class="flex space-x-4 border-b border-gray-200">
      <%= link_to "Overview", manage_production_sign_up_form_path(@production, @sign_up_form), class: "px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" %>
      <%= link_to "Slots", slots_manage_production_sign_up_form_path(@production, @sign_up_form), class: "px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" %>
      <%= link_to "Questions", questions_manage_production_sign_up_form_path(@production, @sign_up_form), class: "px-3 py-2 text-sm font-medium border-b-2 border-pink-500 text-pink-600" %>
      <%= link_to "Registrations", registrations_manage_production_sign_up_form_path(@production, @sign_up_form), class: "px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" %>
    </nav>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Questions List -->
    <div class="lg:col-span-2">
      <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
        <%= render "shared/card_header", title: "Questions (#{@questions.count})" %>
        <div class="p-4">
          <% if @questions.any? %>
            <div class="space-y-3" data-controller="sortable" data-sortable-url-value="<%= reorder_questions_manage_production_sign_up_form_path(@production, @sign_up_form) %>">
              <% @questions.each do |question| %>
                <div class="flex items-start gap-3 py-3 px-4 bg-gray-50 border border-gray-200 rounded-lg" data-sortable-item data-id="<%= question.id %>">
                  <span class="cursor-move text-gray-400 mt-1" data-sortable-handle>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/>
                    </svg>
                  </span>
                  <div class="flex-1">
                    <div class="flex items-center gap-2">
                      <span class="text-sm font-medium text-gray-900"><%= question.text %></span>
                      <% if question.required? %>
                        <span class="text-red-500 text-xs">*Required</span>
                      <% end %>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                      Type: <%= question.question_type.humanize %>
                      <% if question.question_options.any? %>
                        â€¢ Options: <%= question.question_options.map(&:text).join(", ") %>
                      <% end %>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <%= link_to destroy_question_manage_production_sign_up_form_path(@production, @sign_up_form, question_id: question.id), 
                        method: :delete, 
                        data: { turbo_confirm: "Delete this question?" },
                        class: "text-sm text-red-500 hover:text-red-700" do %>
                      Delete
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-gray-500 text-sm text-center py-8">No questions added yet. Questions are optional but can gather additional info from registrants.</p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Add Question -->
    <div>
      <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
        <%= render "shared/card_header", title: "Add Question" %>
        <div class="p-4">
          <%= form_with url: create_question_manage_production_sign_up_form_path(@production, @sign_up_form), method: :post do |form| %>
            <div class="space-y-4">
              <div>
                <%= form.label :text, "Question Text", class: "block text-sm font-medium text-gray-700 mb-1" %>
                <%= form.text_field :text, name: "question[text]", class: "block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-pink-500 focus:ring-pink-500 text-sm", placeholder: "Enter your question..." %>
              </div>
              <div>
                <%= form.label :question_type, "Question Type", class: "block text-sm font-medium text-gray-700 mb-1" %>
                <%= form.select :question_type, 
                  [["Short Text", "short_text"], ["Long Text", "long_text"], ["Single Choice", "single_choice"], ["Multiple Choice", "multiple_choice"], ["Yes/No", "yes_no"]],
                  {},
                  name: "question[question_type]",
                  class: "block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-pink-500 focus:ring-pink-500 text-sm" %>
              </div>
              <div>
                <label class="flex items-center gap-2">
                  <%= form.check_box :required, name: "question[required]", class: "rounded border-gray-300 text-pink-500 focus:ring-pink-500" %>
                  <span class="text-sm text-gray-700">Required</span>
                </label>
              </div>
              <%= form.submit "Add Question", class: "w-full px-4 py-2 text-sm font-medium text-white bg-pink-500 rounded-lg hover:bg-pink-600 cursor-pointer" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
