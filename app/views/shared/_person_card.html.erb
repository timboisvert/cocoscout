<%
    show_delete_signup = false if local_assigns[:show_delete_signup].nil?
%>

<div class="">
    <% headshot = person.primary_headshot %>
    <% if headshot&.image&.attached? %>
        <div class="lg:hidden w-full">
            <%= image_tag url_for(headshot.image), class: "relative inline-block rounded-lg w-full" %>
        </div>
    <% end %>

    <div class="flex flex-col lg:flex-row items-start lg:space-x-6">
        <div class="flex-1 w-full">
            <div class="font-bold text-2xl sm:text-3xl mt-3"><%= person.name.truncate(40, omission: "...") %></div>

            <% if person.pronouns.present? %>
                <div class="mt-5">
                    <%= render partial: "shared/top_menu", locals: {
                        breadcrumbs: [],
                        text: "Pronouns",
                        links: []
                    } %>
                </div>
                <div class="text-sm"><%= person.pronouns %></div>
            <% end %>

            <div class="mt-5">
                <%= render partial: "shared/top_menu", locals: {
                    breadcrumbs: [],
                    text: "Email & Socials",
                    links: []
                } %>
            </div>

            <div class="flex items-center space-x-2 border-gray-200 mt-4">
                <svg width="20" height="20" class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
                <%= link_to person.email, contact_manage_person_path(person), class: "text-pink-500 text-sm hover:underline" %>
            </div>

            <div class="space-y-1 mt-1">
                <% person.socials.each do |social| %>
                    <div class="flex items-center space-x-2">
                        <%= social.icon(20) %>
                        <%= link_to social.handle, social.url, class: "text-pink-500 text-sm hover:underline", target: "_blank", rel: "noopener" %>
                    </div>
                <% end %>
            </div>

            <% if current_user_can_manage? || Current.user&.god? %>
                <div class="mt-5">
                    <%= render partial: "shared/top_menu", locals: {
                        breadcrumbs: [],
                        text: "Actions",
                        links: []
                    } %>
                </div>

                <div class="mt-2">

                    <% if current_user_can_manage? && person.organizations.include?(Current.organization) %>
                        <%= link_to "Remove from #{Current.organization.name}",
                            remove_from_organization_manage_person_path(person),
                            data: {
                                turbo_method: :post,
                                turbo_confirm: "Are you sure you want to remove #{person.name} from #{Current.organization.name}?"
                            },
                            class: "block text-xs text-pink-500 underline cursor-pointer"
                        %>
                    <% end %>

                    <% if show_delete_signup %>
                        <%= link_to "Delete Sign-up",
                            manage_production_audition_cycle_audition_request_path(@production, @audition_cycle, @audition_request),
                            data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this sign-up?" },
                            class: "block text-xs text-pink-500 underline mt-1"
                        %>
                    <% end %>
                </div>

            <% end %>

            <% if Current.user&.god? %>
                <div class="mt-5">
                    <%= render partial: "shared/top_menu", locals: {
                        breadcrumbs: [],
                        text: "God Mode Actions",
                        links: []
                    } %>
                </div>

                <div class="mt-2">

                    <% if Current.user&.god? %>
                        <div class="space-y-1">

                            <% if person.user %>
                                <%= button_to impersonate_user_path, method: :post, params: { email: person.user.email_address }, class: "text-xs text-pink-500 underline cursor-pointer" do %>
                                    Impersonate
                                <% end %>
                            <% end %>

                            <%= link_to "Edit",
                                edit_manage_person_path(person),
                                class: "block text-xs text-pink-500 underline"
                            %>

                            <%= link_to "Delete",
                                manage_person_path(person),
                                data: {
                                    turbo_method: :delete,
                                    turbo_confirm: "Are you sure you want to delete this person? This will remove them from ALL production companies."
                                },
                                class: "block text-xs text-pink-500 underline"
                            %>
                        </div>
                    <% end %>

                </div>

            <% end %>

        </div>

        <% if headshot&.image&.attached? %>
            <div class="hidden lg:block flex-shrink-0 max-w-[40%] w-full">
                <%= image_tag url_for(headshot.image), class: "relative inline-block rounded-lg w-full" %>
            </div>
        <% end %>
    </div>

</div>