<div data-controller="mobile-nav" class="fixed inset-x-0 top-0 z-30 border-b border-pink-100 bg-white lg:hidden">
  <%# ===== TOP BAR ===== %>
  <div class="flex items-center justify-between px-4 py-2.5">
    <button type="button" data-action="mobile-nav#toggle" class="p-1">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-pink-500">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
      </svg>
    </button>
    <div class="absolute left-1/2 transform -translate-x-1/2 flex items-center gap-1.5">
      <%= link_to manage_path, class: "flex items-center gap-1.5" do %>
        <%= image_tag "/icon.png", alt: "CocoScout", class: "h-5 w-5" %>
        <span class="text-lg text-pink-500 coustard-regular">CocoScout</span>
      <% end %>
    </div>
    <div class="w-6"></div>
  </div>

  <%# ===== FULL-SCREEN PANEL ===== %>
  <div data-mobile-nav-target="panel" class="hidden fixed inset-0 top-[45px] bg-white overflow-y-auto z-40">
    <div class="flex flex-col min-h-full">

      <%# ===== IMPERSONATION BANNER ===== %>
      <% if impersonating? %>
        <div class="bg-amber-500 px-4 py-3">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-white flex-shrink-0">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
              </svg>
              <div>
                <div class="text-xs font-bold text-white uppercase tracking-wider">Impersonating</div>
                <div class="text-sm font-semibold text-white"><%= Current.user.person&.name || Current.user.email_address %></div>
              </div>
            </div>
            <%= render "shared/button", text: "Stop", variant: "outline", size: "small", path: stop_impersonating_user_path, data: { turbo_method: :post } %>
          </div>
        </div>
      <% end %>

      <%# ===== MAIN CONTENT ===== %>
      <div class="flex-1 px-4 py-6">

        <%# ===== DASHBOARD SWITCHER ===== %>
        <button type="button" data-action="mobile-nav#showDashboardPopup" class="w-full flex items-center justify-between hover:bg-gray-50 rounded-lg transition cursor-pointer">
          <div class="flex items-center gap-3 min-w-0 flex-1">
            <div class="w-9 h-9 rounded-lg bg-pink-100 flex items-center justify-center flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-pink-600">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5M9 11.25v1.5M12 9v3.75m3-6v6" />
              </svg>
            </div>
            <div class="min-w-0 text-left">
              <div class="text-base font-bold text-gray-900 truncate">Production Dashboard</div>
              <div class="text-xs text-gray-500">Manage productions</div>
            </div>
          </div>
          <div class="p-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15 12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
            </svg>
          </div>
        </button>

        <%# ===== ORGANIZATION (only if multiple orgs) ===== %>
        <% if Current.organization.present? %>
          <%
            all_orgs = current_user_is_global_manager? ? Current.user.organizations.includes(:logo_attachment) : []
            other_orgs = all_orgs.reject { |o| o.id == Current.organization&.id }
            has_multiple_orgs = other_orgs.any?
          %>
          <% if has_multiple_orgs %>
            <div class="my-4 border-t border-gray-200"></div>
            <button type="button" data-action="mobile-nav#showOrgPopup" class="w-full flex items-center justify-between hover:bg-gray-50 rounded-lg transition cursor-pointer">
              <div class="flex items-center gap-3 min-w-0 flex-1">
                <% org_logo = Current.organization.logo if Current.organization.respond_to?(:logo) && Current.organization.logo&.attached? %>
                <% if org_logo %>
                  <%= image_tag org_logo, class: "w-9 h-9 rounded-lg object-cover flex-shrink-0" %>
                <% else %>
                  <div class="w-9 h-9 rounded-lg bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-sm flex-shrink-0">
                    <%= Current.organization.name[0..1].upcase %>
                  </div>
                <% end %>
                <div class="min-w-0 text-left">
                  <div class="text-base font-bold text-gray-900 truncate"><%= Current.organization.name %></div>
                  <div class="text-xs text-gray-500">Organization</div>
                </div>
              </div>
              <div class="p-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15 12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                </svg>
              </div>
            </button>
            <div class="my-4 border-t border-gray-200"></div>
          <% end %>
        <% end %>

        <%# ===== NAVIGATION LINKS ===== %>
        <% if Current.organization.present? %>
          <% has_team_access = Current.user.accessible_productions.where(organization: Current.organization).any? { |p| Current.user.role_for_production(p).present? } %>
          <nav class="space-y-1 mb-5">
            <% if has_team_access %>
              <%= link_to manage_path, class: "flex items-center gap-3 px-4 py-2 rounded-lg text-lg font-medium hover:bg-pink-50 hover:text-pink-600 transition #{controller_name == 'manage' && action_name == 'index' ? 'bg-pink-50 text-pink-600' : 'text-gray-800'}" do %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 flex-shrink-0">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                </svg>
                Home
              <% end %>

              <%= link_to manage_messages_path, class: "flex items-center gap-3 px-4 py-2 rounded-lg text-lg font-medium hover:bg-pink-50 hover:text-pink-600 transition #{controller_name == 'messages' ? 'bg-pink-50 text-pink-600' : 'text-gray-800'}" do %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 flex-shrink-0">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                </svg>
                Messages
                <% if Current.user&.unread_message_count&.> 0 %>
                  <span class="ml-auto inline-flex items-center justify-center min-w-[24px] h-6 px-2 text-xs font-bold text-white bg-pink-500 rounded-full"><%= Current.user.unread_message_count > 99 ? "99+" : Current.user.unread_message_count %></span>
                <% end %>
              <% end %>

              <%= link_to manage_shows_path, class: "flex items-center gap-3 px-4 py-2 rounded-lg text-lg font-medium hover:bg-pink-50 hover:text-pink-600 transition text-gray-800" do %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 flex-shrink-0">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
                </svg>
                Shows
              <% end %>

              <%= link_to manage_casting_path, class: "flex items-center gap-3 px-4 py-2 rounded-lg text-lg font-medium hover:bg-pink-50 hover:text-pink-600 transition text-gray-800" do %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 flex-shrink-0">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                </svg>
                Casting
              <% end %>
            <% end %>

            <%= link_to manage_signups_path, class: "flex items-center gap-3 px-4 py-2 rounded-lg text-lg font-medium hover:bg-pink-50 hover:text-pink-600 transition text-gray-800" do %>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 flex-shrink-0">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15a2.25 2.25 0 0 1 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
              </svg>
              Sign-ups
            <% end %>

            <% if has_team_access %>
              <%= link_to manage_money_index_path, class: "flex items-center gap-3 px-4 py-2 rounded-lg text-lg font-medium hover:bg-pink-50 hover:text-pink-600 transition text-gray-800" do %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 flex-shrink-0">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                Money
              <% end %>

              <%= link_to manage_directory_path, class: "flex items-center gap-3 px-4 py-2 rounded-lg text-lg font-medium hover:bg-pink-50 hover:text-pink-600 transition text-gray-800" do %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 flex-shrink-0">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm-3.375 6.375h4.5c.621 0 1.125-.504 1.125-1.125a3 3 0 0 0-6.75 0c0 .621.504 1.125 1.125 1.125Z" />
                </svg>
                Directory
              <% end %>
            <% end %>
          </nav>
        <% end %>

      </div>

      <%# ===== FOOTER ===== %>
      <div class="border-t border-gray-200 bg-gray-50 px-4 py-4">
        <div class="flex items-center gap-3">
          <% if Current.user.person&.headshot&.attached? %>
            <%= image_tag Current.user.person.headshot, class: "w-10 h-10 rounded-lg object-cover flex-shrink-0" %>
          <% else %>
            <div class="w-10 h-10 rounded-lg bg-pink-100 text-pink-500 flex items-center justify-center font-bold text-sm flex-shrink-0">
              <%= Current.user.person&.name&.split&.map(&:first)&.join&.upcase || Current.user.email_address[0].upcase %>
            </div>
          <% end %>
          <div class="min-w-0 flex-1">
            <div class="text-sm font-semibold text-gray-900 truncate"><%= Current.user.person&.name || Current.user.email_address %></div>
            <div class="text-xs text-gray-500 truncate"><%= Current.user.email_address %></div>
          </div>
          <%= render "shared/button", text: "Menu", variant: "secondary", size: "small", type: :button, data: { action: "mobile-nav#showUserPopup" }, icon: "ellipsis-horizontal" %>
        </div>
      </div>

    </div>

    <%# ===== DASHBOARD POPUP (bottom sheet) ===== %>
    <div data-mobile-nav-target="dashboardPopup" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 bg-black/40" data-action="click->mobile-nav#hideDashboardPopup"></div>
      <div class="absolute bottom-0 inset-x-0 bg-white rounded-t-2xl shadow-xl">
        <div class="px-5 py-4 border-b border-gray-100 flex items-center justify-between">
          <h3 class="text-lg font-bold text-gray-900">Switch Dashboard</h3>
          <button type="button" data-action="click->mobile-nav#hideDashboardPopup" class="p-1 rounded-lg hover:bg-gray-100 transition cursor-pointer">
            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="px-5 py-3">
          <%# Current: Production Dashboard %>
          <div class="flex items-center gap-3 px-4 py-3 rounded-lg bg-pink-50 border border-pink-200 mb-2">
            <div class="w-10 h-10 rounded-lg bg-pink-100 flex items-center justify-center flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-pink-600">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5M9 11.25v1.5M12 9v3.75m3-6v6" />
              </svg>
            </div>
            <div class="flex-1 min-w-0">
              <div class="text-sm font-bold text-gray-900">Production Dashboard</div>
              <div class="text-xs text-pink-600 font-medium">Current</div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-pink-500 flex-shrink-0">
              <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" />
            </svg>
          </div>

          <%# Talent Dashboard %>
          <%= link_to my_dashboard_path, data: { turbo: false }, class: "flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 transition mb-1" do %>
            <div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-600">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z" />
              </svg>
            </div>
            <div>
              <div class="text-sm font-semibold text-gray-700">Talent Dashboard</div>
              <div class="text-xs text-gray-500">View as performer</div>
            </div>
          <% end %>

          <%# My Profile %>
          <%= link_to profile_path, class: "flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 transition" do %>
            <div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-600">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
              </svg>
            </div>
            <div>
              <div class="text-sm font-semibold text-gray-700">My Profile</div>
              <div class="text-xs text-gray-500">Edit public profile</div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <%# ===== ORGANIZATION POPUP (bottom sheet) ===== %>
    <% if Current.organization.present? && current_user_is_global_manager? %>
      <div data-mobile-nav-target="orgPopup" class="hidden fixed inset-0 z-50">
        <div class="absolute inset-0 bg-black/40" data-action="click->mobile-nav#hideOrgPopup"></div>
        <div class="absolute bottom-0 inset-x-0 bg-white rounded-t-2xl shadow-xl max-h-[70vh] overflow-y-auto">
          <div class="sticky top-0 bg-white rounded-t-2xl border-b border-gray-100 px-5 py-4 flex items-center justify-between">
            <h3 class="text-lg font-bold text-gray-900">Switch Organization</h3>
            <button type="button" data-action="click->mobile-nav#hideOrgPopup" class="p-1 rounded-lg hover:bg-gray-100 transition cursor-pointer">
              <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
          <div class="px-5 py-3">
            <%# Current org %>
            <div class="flex items-center gap-3 px-4 py-3 rounded-xl bg-pink-50 border border-pink-200 mb-2">
              <% org_logo_current = Current.organization.logo if Current.organization.respond_to?(:logo) && Current.organization.logo&.attached? %>
              <% if org_logo_current %>
                <%= image_tag org_logo_current, class: "w-10 h-10 rounded-lg object-cover flex-shrink-0" %>
              <% else %>
                <div class="w-10 h-10 rounded-lg bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-sm flex-shrink-0">
                  <%= Current.organization.name[0..1].upcase %>
                </div>
              <% end %>
              <div class="flex-1 min-w-0">
                <div class="text-sm font-bold text-gray-900 truncate"><%= Current.organization.name %></div>
                <div class="text-xs text-pink-600 font-medium">Current</div>
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-pink-500 flex-shrink-0">
                <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" />
              </svg>
            </div>

            <%# Other orgs %>
            <%
              all_orgs_popup = Current.user.organizations.includes(:logo_attachment)
              other_orgs_popup = all_orgs_popup.reject { |o| o.id == Current.organization&.id }
            %>
            <% other_orgs_popup.each do |org| %>
              <%= form_with url: set_organization_path(id: org.id), method: :post, class: "mb-1" do %>
                <button type="submit" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-50 transition cursor-pointer text-left">
                  <% org_logo_other = org.logo if org.respond_to?(:logo) && org.logo&.attached? %>
                  <% if org_logo_other %>
                    <%= image_tag org_logo_other, class: "w-10 h-10 rounded-lg object-cover flex-shrink-0" %>
                  <% else %>
                    <div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center text-gray-600 font-bold text-sm flex-shrink-0">
                      <%= org.name[0..1].upcase %>
                    </div>
                  <% end %>
                  <span class="text-sm font-semibold text-gray-700 truncate"><%= org.name %></span>
                </button>
              <% end %>
            <% end %>

            <%# Org settings link %>
            <div class="mt-3 pt-3 border-t border-gray-100">
              <%= link_to manage_organization_path(Current.organization, anchor: "tab-0"), class: "flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-50 transition text-sm font-medium text-gray-600" do %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                </svg>
                Organization Settings
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <%# ===== USER POPUP (bottom sheet) ===== %>
    <div data-mobile-nav-target="userPopup" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 bg-black/40" data-action="click->mobile-nav#hideUserPopup"></div>
      <div class="absolute bottom-0 inset-x-0 bg-white rounded-t-2xl shadow-xl">
        <div class="px-5 py-4 border-b border-gray-100 flex items-center justify-between">
          <h3 class="text-lg font-bold text-gray-900">Account</h3>
          <button type="button" data-action="click->mobile-nav#hideUserPopup" class="p-1 rounded-lg hover:bg-gray-100 transition cursor-pointer">
            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="px-5 py-3">
          <%# Organization info for single-org users %>
          <% if Current.organization.present? %>
            <%
              all_orgs_check = current_user_is_global_manager? ? Current.user.organizations : []
              single_org = all_orgs_check.count <= 1
            %>
            <% if single_org %>
              <div class="flex items-center gap-3 px-4 py-3 mb-2">
                <% org_logo_menu = Current.organization.logo if Current.organization.respond_to?(:logo) && Current.organization.logo&.attached? %>
                <% if org_logo_menu %>
                  <%= image_tag org_logo_menu, class: "w-10 h-10 rounded-lg object-cover flex-shrink-0" %>
                <% else %>
                  <div class="w-10 h-10 rounded-lg bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-sm flex-shrink-0">
                    <%= Current.organization.name[0..1].upcase %>
                  </div>
                <% end %>
                <div class="min-w-0 flex-1">
                  <div class="text-sm font-bold text-gray-900 truncate"><%= Current.organization.name %></div>
                  <div class="text-xs text-gray-500">Organization</div>
                </div>
              </div>
              <%= link_to manage_organization_path(Current.organization, anchor: "tab-0"), class: "flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 transition text-base font-medium text-gray-700" do %>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                </svg>
                Organization Settings
              <% end %>
              <div class="my-2 border-t border-gray-100"></div>
            <% end %>
          <% end %>
          <%= link_to profile_path, class: "flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 transition text-base font-medium text-gray-700" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
            </svg>
            My Profile
          <% end %>
          <%= link_to account_path, class: "flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 transition text-base font-medium text-gray-700" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
            My Account
          <% end %>
          <% if Current.organization.present? %>
            <%= link_to manage_productions_path, class: "flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 transition text-base font-medium text-gray-700" do %>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-2.625 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.125 1.125 0 0 1 18 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-2.625 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0 1 18 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 0 1 6 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5" />
              </svg>
              Productions
            <% end %>
          <% end %>
          <% if Current.user.superadmin? %>
            <%= link_to superadmin_path, class: "flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 transition text-base font-medium text-purple-600" do %>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-purple-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 0 0-2.455 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z" />
              </svg>
              Superadmin
            <% end %>
          <% end %>
          <div class="mt-2 pt-3 border-t border-gray-100">
            <%= link_to signout_path, data: { turbo_prefetch: false }, class: "flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 transition text-base font-medium text-pink-600" do %>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-pink-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15" />
              </svg>
              Sign Out
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
