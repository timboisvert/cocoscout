<% content_for :title, "Cannot Delete Location" %>

<div class="w-full">
  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Organizations", manage_organizations_path],
      [Current.organization.name, manage_organization_path(Current.organization, anchor: "tab-2")]
    ],
    text: "Cannot Delete Location",
    links: []
  } %>

  <div class="mt-5 border border-gray-200 rounded-lg overflow-hidden">
    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900 coustard-regular"><%= @location.name %></h2>
      <p class="text-sm text-gray-600 mt-1">
        <%= "#{@location.address1}, #{@location.city}, #{@location.state} #{@location.postal_code}" %>
      </p>
    </div>

    <div class="p-6">
      <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
        <div class="flex items-start">
          <svg class="w-5 h-5 text-red-600 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div class="flex-1">
            <h3 class="text-base font-semibold text-red-900">Cannot Delete This Location</h3>
            <p class="text-sm text-red-800 mt-1">
              This location has events assigned to it. You must reassign or cancel these events before you can delete this location.
            </p>
          </div>
        </div>
      </div>

      <% if @location.upcoming_shows.any? %>
        <div class="mb-6">
          <h3 class="text-base font-semibold text-gray-900 mb-3">Upcoming Shows & Events</h3>
          <div class="border border-gray-200 rounded-lg overflow-hidden">
            <table class="w-full">
              <thead>
                <tr class="bg-gray-50 border-b border-gray-200">
                  <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Event</th>
                  <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Date & Time</th>
                  <th class="px-4 py-2 text-right text-sm font-semibold text-gray-900">Action</th>
                </tr>
              </thead>
              <tbody>
                <% @location.upcoming_shows.limit(10).each do |show| %>
                  <tr class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm text-gray-900"><%= show.display_name %></td>
                    <td class="px-4 py-3 text-sm text-gray-600">
                      <%= show.date_and_time.strftime("%A, %B %-d, %Y at %-l:%M %p") %>
                    </td>
                    <td class="px-4 py-3 text-right text-sm">
                      <%= link_to "Edit", edit_manage_production_show_path(show.production, show), class: "text-pink-500 hover:text-pink-700 underline" %>
                    </td>
                  </tr>
                <% end %>
                <% if @location.upcoming_shows.count > 10 %>
                  <tr class="bg-gray-50">
                    <td colspan="3" class="px-4 py-2 text-sm text-gray-500 text-center">
                      ... and <%= @location.upcoming_shows.count - 10 %> more events
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      <% end %>

      <% if @location.upcoming_audition_sessions.any? %>
        <div class="mb-6">
          <h3 class="text-base font-semibold text-gray-900 mb-3">Upcoming Audition Sessions</h3>
          <div class="border border-gray-200 rounded-lg overflow-hidden">
            <table class="w-full">
              <thead>
                <tr class="bg-gray-50 border-b border-gray-200">
                  <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Name</th>
                  <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Start Date & Time</th>
                  <th class="px-4 py-2 text-right text-sm font-semibold text-gray-900">Action</th>
                </tr>
              </thead>
              <tbody>
                <% @location.upcoming_audition_sessions.limit(10).each do |session| %>
                  <tr class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm text-gray-900"><%= session.name %></td>
                    <td class="px-4 py-3 text-sm text-gray-600">
                      <%= session.start_at.strftime("%A, %B %-d, %Y at %-l:%M %p") %>
                    </td>
                    <td class="px-4 py-3 text-right text-sm">
                      <%= link_to "Edit", edit_manage_audition_session_path(session), class: "text-pink-500 hover:text-pink-700 underline" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      <% end %>

      <div class="pt-4 border-t border-gray-200">
        <div class="flex gap-2">
          <%= render "shared/button", text: "Back to Location", variant: "secondary", path: manage_location_path(@location) %>
          <%= render "shared/button", text: "Back to Organization", variant: "primary", path: manage_organization_path(Current.organization, anchor: "tab-2") %>
        </div>
      </div>
    </div>
  </div>
</div>
