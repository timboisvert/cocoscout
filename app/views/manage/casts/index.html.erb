<% content_for :title, "Casting" %>

<div class="w-full">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Casting",
    links: [
      { text: "Add a Cast", path: new_manage_production_cast_path(@production) }
    ]
  } %>

  <div id="casts" class="min-w-full space-y-5">
    <% if @casts.any? %>
      <% @casts.each do |cast| %>
        <div class="border border-gray-200 rounded-lg overflow-hidden">
          <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
            <h3 class="text-sm font-semibold text-gray-900"><%= cast.name %></h3>

            <% if current_user_can_manage?(Current.production) %>
              <div class="flex gap-2">
                <%= link_to "Rename Cast", edit_manage_production_cast_path(@production, cast), class: "text-pink-500 text-xs underline" %>
                <%= link_to "Delete Cast",
                      manage_production_cast_path(@production, cast),
                      data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this cast?" },
                      class: "text-pink-500 text-xs underline" %>
              </div>
            <% end %>

          </div>
          <div class="grid grid-cols-1 gap-1 p-4" data-controller="cast-person" data-cast-person-production-id-value="<%= @production.id %>" data-cast-person-cast-id-value="<%= cast.id %>">

            <div id="cast-members-list-<%= cast.id %>">
              <%= render 'manage/casts/cast_members_list', cast: cast %>
            </div>

            <% if current_user_can_manage?(Current.production) %>
              <div id="cast-members-list-add-person-<%= cast.id %>" class="mt-4 hidden">
                <h1 class="font-bold text-lg mb-1">Add a person to this cast:</h1>
                <div class=""
                    data-controller="people-search"
                    data-people-search-url-value="<%= search_manage_people_path(format: :html) %>"
                    data-people-search-result-partial-value="manage/casts/cast_person_grid_item"
                >
                  <div class="flex items-center gap-2">
                    <input type="text" class="w-full md:w-1/2 px-3 py-2 border rounded shadow-sm" placeholder="Search for people..." data-people-search-target="input" data-action="input->people-search#search">
                    <button type="button" class="px-3 py-2 rounded bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium cursor-pointer" data-action="people-search#reset">Done</button>
                  </div>
                  <div class="" data-people-search-target="results"></div>
                </div>
              </div>
            <% end %>

          </div>

        </div>
      <% end %>
    <% else %>
      <p class="text-gray-500 text-sm">
        No casts have been created.
        <% if current_user_can_manage?(Current.production) %>
          <%= link_to "Add a Cast", new_manage_production_cast_path(@production), class: "text-pink-500 underline" %>
        <% end %>
      </p>
    <% end %>
  </div>
</div>
