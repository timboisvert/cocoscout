<%# Note: This partial is NOT cached because it contains interactive drag-drop elements
    that require real-time state. The roles data is preloaded in the controller instead. %>
<%
  # Use local variable 'show' if passed, otherwise fall back to @show
  show = local_assigns[:show] || @show
  production = show.production

  # Use preloaded data if available, otherwise fall back to show.available_roles
  # This supports both production roles and show-specific custom roles
  roles = local_assigns[:roles] || @roles || show.available_roles.to_a

  # Determine if we're using show-specific custom roles
  using_custom_roles = show.use_custom_roles?

  # If assignments_by_role_id not provided, build it from the show's assignments
  assignments_by_role_id = local_assigns[:assignments_by_role_id] || @assignments_by_role_id
  unless assignments_by_role_id
    all_assignments = show.show_person_role_assignments.includes(:role).to_a
    assignments_by_role_id = all_assignments.group_by(&:role_id)
  end

  # Build people/groups lookups if not provided
  people_by_id = local_assigns[:people_by_id] || @people_by_id
  groups_by_id = local_assigns[:groups_by_id] || @groups_by_id

  unless people_by_id && groups_by_id
    all_assignments_flat = assignments_by_role_id.values.flatten
    person_ids = all_assignments_flat.select { |a| a.assignable_type == "Person" }.map(&:assignable_id).uniq
    group_ids = all_assignments_flat.select { |a| a.assignable_type == "Group" }.map(&:assignable_id).uniq

    people_by_id ||= Person.where(id: person_ids).includes(profile_headshots: { image_attachment: :blob }).index_by(&:id)
    groups_by_id ||= Group.where(id: group_ids).includes(profile_headshots: { image_attachment: :blob }).index_by(&:id)
  end

  role_count = roles.size

  # Group roles by category for section display
  roles_by_category = roles.group_by { |r| r.category || "performing" }
  # Order categories: performing first, then others alphabetically
  category_order = ["performing"] + (roles_by_category.keys - ["performing"]).sort

  # Build vacancies lookup by role_id (include vacated_by for showing who can't make it)
  vacancies_by_role_id = local_assigns[:vacancies_by_role_id] || @vacancies_by_role_id
  unless vacancies_by_role_id
    all_vacancies = show.role_vacancies.open.includes(:role, :vacated_by).to_a
    vacancies_by_role_id = all_vacancies.group_by(&:role_id)
  end

  # Cancelled vacancies where person can't make it but is still cast
  # Hash keyed by [role_id, assignable_type, assignable_id]
  cancelled_vacancies_by_assignment = local_assigns[:cancelled_vacancies_by_assignment] || @cancelled_vacancies_by_assignment || {}

  # Click-to-add mode for Manual Entry or Hybrid casting
  click_to_add = local_assigns[:click_to_add] || false

  # Linkage info for JS finalize logic
  is_linked = show.linked?
  sync_info = local_assigns[:sync_info]
  all_in_sync = sync_info.present? ? sync_info[:all_in_sync] : true
%>
<div id="show-roles" data-drop-role-target="rolesContainer" data-show-id="<%= show.id %>" data-production-id="<%= production.id %>" data-is-linked="<%= is_linked %>" data-all-in-sync="<%= all_in_sync %>" data-click-to-add="<%= click_to_add %>">

  <% if role_count == 0 %>
    <div class="text-sm text-gray-500">
      <% if using_custom_roles %>
        No custom roles defined for this event yet.
        <%= link_to "Manage Custom Roles", edit_manage_production_show_path(production, show, anchor: "tab-3"), class: "text-pink-500 underline" %>
      <% else %>
        You haven't added any roles to this production yet.
        <%= link_to "Add Roles", manage_production_roles_path(production), class: "text-pink-500 underline" %>
      <% end %>
    </div>
  <% end %>

  <div class="space-y-4">
    <% category_order.each do |category| %>
      <% category_roles = roles_by_category[category] || [] %>
      <% next if category_roles.empty? %>

      <% if roles_by_category.keys.size > 1 %>
        <div class="flex items-center gap-2 pt-2 first:pt-0">
          <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wide capitalize"><%= category %></h3>
          <div class="flex-1 border-t border-gray-200"></div>
        </div>
      <% end %>

      <div class="space-y-1">
    <% category_roles.each do |role| %>

      <%
        assignments = assignments_by_role_id[role.id] || []
        # Sort assignments by position for display
        sorted_assignments = assignments.sort_by { |a| a.position || 0 }

        # Build a hash of slot_position => assignment
        # Handle legacy assignments with position=0 by assigning them sequentially
        assignments_by_slot = {}
        legacy_assignments = []

        sorted_assignments.each do |a|
          if a.position.present? && a.position > 0
            assignments_by_slot[a.position] = a
          else
            legacy_assignments << a
          end
        end

        # Assign legacy (position=0) assignments to available slots
        next_slot = 1
        legacy_assignments.each do |a|
          while assignments_by_slot[next_slot] && next_slot <= (role.quantity || 1)
            next_slot += 1
          end
          if next_slot <= (role.quantity || 1)
            assignments_by_slot[next_slot] = a
            next_slot += 1
          end
        end

        total_slots = role.quantity || 1
        filled_slots = assignments.size
        has_assignment = assignments.any?
        is_fully_filled = filled_slots >= total_slots

        is_restricted = role.restricted?
        eligible_members = is_restricted ? role.eligible_members : []
        eligible_member_keys = eligible_members.map { |m| "#{m.class.name}_#{m.id}" }
        open_vacancies = vacancies_by_role_id[role.id] || []
        has_open_vacancy = open_vacancies.any?

        # All roles now use role-id (both production and show-specific are in Role model)
        role_data_attrs = { "role-id": role.id }
      %>

      <% if is_restricted %>
        <%# Restricted role - show clickable headshots instead of drag-drop %>
        <div class="bg-white border <%= has_open_vacancy ? 'border-amber-300 bg-amber-50' : 'border-gray-200' %> rounded-lg overflow-hidden hover:border-gray-300 transition-all"
            <%= role_data_attrs.map { |k, v| "data-#{k}=\"#{v}\"" }.join(" ").html_safe %>>

          <div class="p-3">
            <div class="flex flex-col sm:grid sm:grid-cols-[140px_1fr] gap-2 sm:gap-4 sm:items-center">
              <div class="font-semibold text-sm text-gray-900 flex items-center gap-1">
                <%= role.name %>
                <% if total_slots > 1 %>
                  <span class="text-xs px-1.5 py-0.5 rounded-full <%= is_fully_filled ? 'bg-green-100 text-green-700' : 'bg-pink-100 text-pink-700' %>">
                    <%= filled_slots %>/<%= total_slots %>
                  </span>
                <% end %>
                <span class="text-pink-500" title="Restricted role">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                  </svg>
                </span>
              </div>

              <div class="space-y-2">
                <%# Show all slots (filled and empty) for multi-person roles %>
                <% (1..total_slots).each do |slot_position| %>
                  <% assignment = assignments_by_slot[slot_position] %>
                  <% if assignment %>
                    <%# Filled slot - show the assigned person/group/guest %>
                    <%
                      is_guest = assignment.guest?
                      assignable = nil
                      cant_make_it_vacancy = nil
                      unless is_guest
                        assignable = if assignment.assignable_type == "Person"
                          people_by_id[assignment.assignable_id] || assignment.assignable
                        else
                          groups_by_id[assignment.assignable_id] || assignment.assignable
                        end
                        cant_make_it_vacancy = cancelled_vacancies_by_assignment[[role.id, assignable.class.name, assignable.id]] if assignable
                      end
                    %>
                    <div class="flex items-center gap-3 p-2 border <%= cant_make_it_vacancy ? 'border-amber-300 bg-amber-50' : 'border-gray-200 bg-white' %> rounded-lg group">
                      <% if is_guest %>
                        <%# Guest assignment - show placeholder avatar %>
                        <div class="w-10 h-10 rounded-lg bg-purple-100 text-purple-700 flex items-center justify-center font-bold text-xs flex-shrink-0">
                          <%= assignment.display_initials %>
                        </div>
                      <% else %>
                        <% headshot_variant = assignable&.safe_headshot_variant(:thumb) %>
                        <% if headshot_variant %>
                          <%= image_tag headshot_variant, alt: assignable.name, class: "w-10 h-10 rounded-lg object-cover flex-shrink-0 #{cant_make_it_vacancy ? 'ring-2 ring-amber-400' : ''}" %>
                        <% else %>
                          <div class="w-10 h-10 rounded-lg <%= cant_make_it_vacancy ? 'bg-amber-100 text-amber-700 ring-2 ring-amber-400' : 'bg-gray-200 text-gray-700' %> flex items-center justify-center font-bold text-xs flex-shrink-0">
                            <%= assignable&.initials %>
                          </div>
                        <% end %>
                      <% end %>

                      <div class="flex-1 min-w-0">
                        <span class="font-medium text-sm truncate block">
                          <%= is_guest ? assignment.guest_name : assignable&.name %>
                        </span>
                        <% if cant_make_it_vacancy %>
                          <div class="flex items-center gap-1 text-amber-600">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                            </svg>
                            <span class="text-xs font-medium">
                              <% if cant_make_it_vacancy.finding_replacement? %>
                                Can't make it – looking for replacement
                              <% elsif cant_make_it_vacancy.open? %>
                                Can't make it
                              <% elsif cant_make_it_vacancy.not_filling? %>
                                Can't make it – no replacement
                              <% elsif cant_make_it_vacancy.filled? %>
                                Can't make it – replaced
                              <% else %>
                                Can't make it
                              <% end %>
                            </span>
                          </div>
                        <% end %>
                      </div>
                      <div class="flex items-center gap-1 md:opacity-0 md:group-hover:opacity-100 transition-all">
                        <button type="button"
                          class="text-xs font-medium text-pink-600 hover:text-pink-700 hover:bg-pink-100 rounded-md px-2 py-1 cursor-pointer"
                          data-action="click->drop-role#removeAssignment"
                          data-assignment-id="<%= assignment.id %>"
                          data-assignable-type="<%= is_guest ? '' : assignable.class.name %>"
                          data-assignable-id="<%= is_guest ? '' : assignable.id %>"
                          title="Remove assignment"
                        >
                          Remove
                        </button>
                      </div>
                    </div>
                  <% else %>
                    <%# Empty slot - show eligible members to select from %>
                    <div class="p-2 border-2 border-dashed border-gray-200 rounded-lg">
                      <% if eligible_members.any? %>
                        <div class="flex flex-wrap gap-2">
                          <% eligible_members.each do |member| %>
                            <%
                              member_key = "#{member.class.name}_#{member.id}"
                              is_assigned_elsewhere = (local_assigns[:assigned_member_keys] || @assigned_member_keys || Set.new).include?(member_key)
                              # Also check if already assigned to this role
                              is_assigned_to_this_role = sorted_assignments.any? { |a| a.assignable_type == member.class.name && a.assignable_id == member.id }
                            %>
                            <button type="button"
                              class="flex items-center gap-2 p-1.5 border rounded-lg transition-all cursor-pointer <%= (is_assigned_elsewhere || is_assigned_to_this_role) ? 'border-gray-200 bg-gray-50 opacity-50' : 'border-gray-200 hover:border-pink-400 hover:bg-pink-50' %>"
                              data-action="click->drop-role#assignFromClick"
                              <%= role_data_attrs.map { |k, v| "data-#{k}=\"#{v}\"" }.join(" ").html_safe %>
                              data-assignable-type="<%= member.class.name %>"
                              data-assignable-id="<%= member.id %>"
                              title="<%= (is_assigned_elsewhere || is_assigned_to_this_role) ? "#{member.name} is already assigned" : "Cast #{member.name}" %>"
                              <%= 'disabled' if is_assigned_elsewhere || is_assigned_to_this_role %>
                            >
                              <% headshot_variant = member.safe_headshot_variant(:thumb) %>
                              <% if headshot_variant %>
                                <%= image_tag headshot_variant, alt: member.name, class: "w-6 h-6 rounded-lg object-cover flex-shrink-0" %>
                              <% else %>
                                <div class="w-6 h-6 rounded-lg bg-gray-200 flex items-center justify-center text-gray-700 font-bold text-[10px] flex-shrink-0">
                                  <%= member.initials %>
                                </div>
                              <% end %>
                              <span class="text-xs font-medium text-gray-700 max-w-16 truncate"><%= member.name %></span>
                            </button>
                          <% end %>
                        </div>
                      <% else %>
                        <p class="text-sm text-gray-400 italic text-center">No eligible members</p>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>

        </div>
      <% else %>
        <%# Non-restricted role - use drag-drop as before %>
        <div class="bg-white border <%= has_open_vacancy ? 'border-amber-300 bg-amber-50' : 'border-gray-200' %> rounded-lg overflow-hidden hover:border-gray-300 transition-all"
            data-drop-role-target="role"
            <%= role_data_attrs.map { |k, v| "data-#{k}=\"#{v}\"" }.join(" ").html_safe %>
            data-role-restricted="false"
            data-action="drop->drop-role#assign dragover->drop-role#allowDrop dragleave->drop-role#dragLeave">

          <div class="p-3">
            <div class="flex flex-col sm:grid sm:grid-cols-[140px_1fr] gap-2 sm:gap-4 sm:items-center">
              <div class="font-semibold text-sm text-gray-900 flex items-center gap-1">
                <%= role.name %>
                <% if total_slots > 1 %>
                  <span class="text-xs px-1.5 py-0.5 rounded-full <%= is_fully_filled ? 'bg-green-100 text-green-700' : 'bg-pink-100 text-pink-700' %>">
                    <%= filled_slots %>/<%= total_slots %>
                  </span>
                <% end %>
              </div>

              <div class="space-y-2">
                <%# Show all slots (filled and empty) for multi-person roles %>
                <% (1..total_slots).each do |slot_position| %>
                  <% assignment = assignments_by_slot[slot_position] %>
                  <% if assignment %>
                    <%# Filled slot - show the assigned person/group/guest with drag-drop %>
                    <%
                      is_guest = assignment.guest?
                      assignable = nil
                      cant_make_it_vacancy = nil
                      unless is_guest
                        assignable = if assignment.assignable_type == "Person"
                          people_by_id[assignment.assignable_id] || assignment.assignable
                        else
                          groups_by_id[assignment.assignable_id] || assignment.assignable
                        end
                        cant_make_it_vacancy = cancelled_vacancies_by_assignment[[role.id, assignable.class.name, assignable.id]] if assignable
                      end
                    %>
                    <div class="flex items-center gap-3 p-2 border <%= cant_make_it_vacancy ? 'border-amber-300 bg-amber-50' : 'border-gray-200 bg-white' %> rounded-lg hover:border-pink-300 hover:bg-pink-50 transition-all group relative <%= is_guest ? '' : 'cursor-grab active:cursor-grabbing' %>"
                        <%= is_guest ? '' : 'draggable="true"' %>
                        data-action="<%= is_guest ? '' : 'dragstart->drop-role#dragStartAssignment dragend->drop-role#dragEnd' %>"
                        data-assignable-type="<%= is_guest ? '' : assignable.class.name %>"
                        data-assignable-id="<%= is_guest ? '' : assignable.id %>"
                        data-assignment-id="<%= assignment.id %>"
                        data-source-role-id="<%= role.id %>">
                      <% if is_guest %>
                        <%# Guest assignment - show placeholder avatar %>
                        <div class="w-10 h-10 rounded-lg bg-purple-100 text-purple-700 flex items-center justify-center font-bold text-xs flex-shrink-0">
                          <%= assignment.display_initials %>
                        </div>
                      <% else %>
                        <% headshot_variant = assignable&.safe_headshot_variant(:thumb) %>
                        <% if headshot_variant %>
                          <%= image_tag headshot_variant, alt: assignable.name, class: "w-10 h-10 rounded-lg object-cover flex-shrink-0 #{cant_make_it_vacancy ? 'ring-2 ring-amber-400' : ''}", draggable: false %>
                        <% else %>
                          <div class="w-10 h-10 rounded-lg <%= cant_make_it_vacancy ? 'bg-amber-100 text-amber-700 ring-2 ring-amber-400' : 'bg-gray-200 text-gray-700' %> flex items-center justify-center font-bold text-xs flex-shrink-0">
                            <%= assignable&.initials %>
                          </div>
                        <% end %>
                      <% end %>

                      <div class="flex-1 min-w-0">
                        <span class="font-medium text-sm truncate block">
                          <%= is_guest ? assignment.guest_name : assignable&.name %>
                        </span>
                        <% if cant_make_it_vacancy %>
                          <div class="flex items-center gap-1 text-amber-600">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                            </svg>
                            <span class="text-xs font-medium">
                              <% if cant_make_it_vacancy.finding_replacement? %>
                                Can't make it – looking for replacement
                              <% elsif cant_make_it_vacancy.open? %>
                                Can't make it
                              <% elsif cant_make_it_vacancy.not_filling? %>
                                Can't make it – no replacement
                              <% elsif cant_make_it_vacancy.filled? %>
                                Can't make it – replaced
                              <% else %>
                                Can't make it
                              <% end %>
                            </span>
                          </div>
                        <% end %>
                      </div>
                      <div class="flex items-center gap-1 md:opacity-0 md:group-hover:opacity-100 transition-all">
                        <button type="button"
                          class="text-xs font-medium text-pink-600 hover:text-pink-700 hover:bg-pink-100 rounded-md px-2 py-1 cursor-pointer"
                          data-action="click->drop-role#removeAssignment"
                          data-assignment-id="<%= assignment.id %>"
                          data-assignable-type="<%= is_guest ? '' : assignable.class.name %>"
                          data-assignable-id="<%= is_guest ? '' : assignable.id %>"
                          title="Remove assignment"
                        >
                          Remove
                        </button>
                      </div>
                    </div>
                  <% else %>
                    <%# Empty slot - check for vacancy or show drop zone %>
                    <%
                      # Find if there's an open vacancy for this role
                      slot_vacancy = open_vacancies.find { |v| v.slot_position == slot_position } if open_vacancies.any?
                    %>
                    <% if slot_vacancy && !is_linked %>
                      <%# Non-linked show with open vacancy - show who can't make it %>
                      <% vacated_by = slot_vacancy.vacated_by %>
                      <div class="p-3 border-2 border-dashed border-amber-300 bg-amber-50 rounded-lg"
                          data-action="drop->drop-role#assign dragover->drop-role#allowDrop dragleave->drop-role#dragLeave"
                          data-slot-position="<%= slot_position %>">
                        <div class="flex items-center gap-2">
                          <% if vacated_by %>
                            <% headshot_variant = vacated_by.safe_headshot_variant(:thumb) %>
                            <% if headshot_variant %>
                              <%= image_tag headshot_variant, alt: vacated_by.name, class: "w-8 h-8 rounded-lg object-cover flex-shrink-0 opacity-50 grayscale" %>
                            <% else %>
                              <div class="w-8 h-8 rounded-lg bg-gray-300 flex items-center justify-center text-gray-500 font-bold text-xs flex-shrink-0">
                                <%= vacated_by.initials %>
                              </div>
                            <% end %>
                          <% end %>
                          <div class="flex-1">
                            <div class="flex items-center gap-1.5 text-amber-700">
                              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 flex-shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                              </svg>
                              <span class="text-xs font-medium">
                                <% if vacated_by %>
                                  <%= vacated_by.name %> can't make it
                                <% else %>
                                  Looking for replacement
                                <% end %>
                              </span>
                            </div>
                            <p class="text-xs text-amber-600 mt-0.5">
                              <span class="hidden md:inline">Drag a talent pool member here, or</span>
                              <%= link_to "find a replacement", manage_production_vacancy_path(production, slot_vacancy), class: "underline hover:text-amber-800" %>
                            </p>
                          </div>
                        </div>
                        <%# Mobile assign button %>
                        <button type="button"
                          class="md:hidden mt-2 flex items-center justify-center gap-2 w-full p-2 bg-amber-100 border border-amber-300 rounded-lg text-amber-700 text-sm hover:bg-amber-200 transition-all cursor-pointer"
                          data-action="click->drop-role#openAssignModal"
                          data-role-id="<%= role.id %>"
                          data-role-name="<%= role.name %>">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                          </svg>
                          Assign replacement
                        </button>
                      </div>
                    <% else %>
                      <%# Regular empty slot %>
                      <% if click_to_add %>
                        <%# Click-to-add mode: Make desktop slots clickable too %>
                        <button type="button"
                          class="hidden md:flex items-center justify-center gap-2 w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-400 text-sm hover:border-pink-400 hover:bg-pink-50 hover:text-pink-600 transition-all cursor-pointer"
                          data-action="click->drop-role#openAddPersonModal drop->drop-role#assign dragover->drop-role#allowDrop dragleave->drop-role#dragLeave"
                          data-role-id="<%= role.id %>"
                          data-role-name="<%= role.name %>"
                          data-slot-position="<%= slot_position %>">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                          </svg>
                          Click to add someone
                        </button>
                      <% else %>
                        <%# Talent pool mode: Show drag zone on desktop %>
                        <div class="hidden md:flex items-center justify-center p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-400 text-sm hover:border-pink-400 hover:bg-pink-50 hover:text-pink-600 transition-all"
                            data-action="drop->drop-role#assign dragover->drop-role#allowDrop dragleave->drop-role#dragLeave"
                            data-slot-position="<%= slot_position %>">
                          Drag a talent pool member here
                        </div>
                      <% end %>
                      <button type="button"
                        class="md:hidden flex items-center justify-center gap-2 w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 text-sm hover:border-pink-400 hover:bg-pink-50 hover:text-pink-600 transition-all cursor-pointer"
                        data-action="click->drop-role#openAssignModal"
                        data-role-id="<%= role.id %>"
                        data-role-name="<%= role.name %>">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        Assign someone
                      </button>
                    <% end %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>

        </div>
      <% end %>
    <% end %>
      </div>
    <% end %>
  </div>

</div>