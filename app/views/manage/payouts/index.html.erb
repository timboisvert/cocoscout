<% content_for :title, "Money - #{@production.name}" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice, alert: alert } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Money",
    links: []
  } %>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <div class="bg-white rounded-lg border border-gray-200 p-5">
      <div class="text-sm text-gray-500 mb-1">Pending Payouts</div>
      <div class="text-2xl font-semibold text-gray-900"><%= @pending_count %></div>
      <div class="text-xs text-gray-500 mt-1">drafts awaiting approval</div>
    </div>
    <div class="bg-white rounded-lg border border-gray-200 p-5">
      <div class="text-sm text-gray-500 mb-1">Approved</div>
      <div class="text-2xl font-semibold text-green-600"><%= number_to_currency(@total_approved) %></div>
      <div class="text-xs text-gray-500 mt-1">ready to pay out</div>
    </div>
    <div class="bg-white rounded-lg border border-gray-200 p-5">
      <div class="text-sm text-gray-500 mb-1">Paid Out</div>
      <div class="text-2xl font-semibold text-pink-600"><%= number_to_currency(@total_paid) %></div>
      <div class="text-xs text-gray-500 mt-1">total distributed</div>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

    <!-- Payout Schemes -->
    <div>
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">Payout Schemes</h2>
        <%= link_to manage_production_money_payout_schemes_path(@production), class: "text-sm text-pink-600 hover:text-pink-700" do %>
          Manage schemes →
        <% end %>
      </div>

      <% if @payout_schemes.any? %>
        <div class="space-y-2">
          <% @payout_schemes.each do |scheme| %>
            <%= link_to manage_production_money_payout_scheme_path(@production, scheme), class: "block bg-white rounded-lg border border-gray-200 p-4 hover:bg-gray-50 transition-colors" do %>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="font-medium text-gray-900"><%= scheme.name %></span>
                  <% if scheme.is_default? %>
                    <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium bg-pink-100 text-pink-700">Default</span>
                  <% end %>
                </div>
                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </div>
              <p class="text-sm text-gray-500 mt-1"><%= scheme.rules_summary %></p>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <div class="bg-gray-50 rounded-lg border border-dashed border-gray-300 p-6 text-center">
          <p class="text-gray-600 mb-3">No payout schemes yet.</p>
          <%= link_to manage_production_presets_money_payout_schemes_path(@production), class: "inline-flex items-center gap-2 text-pink-600 hover:text-pink-700 font-medium" do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Create your first scheme
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Recent Shows -->
    <div>
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">Recent Shows</h2>
        <%= link_to manage_production_money_show_payouts_path(@production), class: "text-sm text-pink-600 hover:text-pink-700" do %>
          View all →
        <% end %>
      </div>

      <% if @shows.any? %>
        <div class="space-y-2">
          <% @shows.each do |show| %>
            <%
              financials = show.show_financials
              payout = show.show_payout
              has_data = financials&.has_data?
              status = payout&.status || "no_data"
            %>
            <%= link_to manage_production_money_show_payout_path(@production, show), class: "block bg-white rounded-lg border border-gray-200 px-3 py-2 hover:border-gray-400 transition-all" do %>
              <div class="flex items-center gap-4">
                <%# Date Box %>
                <div class="flex-shrink-0 w-14 text-center">
                  <div class="text-xs font-semibold text-pink-600 uppercase"><%= show.date_and_time.strftime("%b") %></div>
                  <div class="text-2xl font-bold text-gray-900"><%= show.date_and_time.strftime("%-d") %></div>
                  <div class="text-xs text-gray-500"><%= show.date_and_time.strftime("%a") %></div>
                </div>

                <%# Show Details %>
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 flex-wrap">
                    <span class="font-medium text-gray-900">
                      <%= show.secondary_name.presence || show.event_type.titleize %>
                    </span>
                    <% case status %>
                    <% when "no_data" %>
                      <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-600">Needs Data</span>
                    <% when "draft" %>
                      <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-700">Draft</span>
                    <% when "approved" %>
                      <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium bg-green-100 text-green-700">Approved</span>
                    <% when "paid" %>
                      <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium bg-pink-100 text-pink-700">Paid</span>
                    <% end %>
                  </div>
                  <div class="text-sm text-gray-600">
                    <%= show.date_and_time.strftime("%l:%M %p").strip %>
                    <% if has_data %>
                      · <%= financials.ticket_count %> tickets · <%= number_to_currency(financials.ticket_revenue) %> revenue
                      <% if payout&.total_payout %>
                        · <%= number_to_currency(payout.total_payout) %> payout
                      <% end %>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <div class="bg-gray-50 rounded-lg border border-dashed border-gray-300 p-6 text-center">
          <p class="text-gray-600">No past shows yet.</p>
        </div>
      <% end %>
    </div>

  </div>
</div>
