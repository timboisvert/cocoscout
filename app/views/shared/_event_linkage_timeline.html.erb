<%#
  Event Linkage Display - Option C: Timeline Style
  
  Shows linked events as a vertical timeline with connector lines.
  Siblings have large dots, children have smaller indented dots.
  
  Required params:
    - event_linkage: EventLinkage object
  
  Optional params:
    - show_production: Show production name (default: false)
%>

<%
  show_production = local_assigns.fetch(:show_production, false)
  siblings = event_linkage.sibling_shows.order(:date_and_time)
  children = event_linkage.child_shows.order(:date_and_time)
  all_events = (siblings + children).sort_by(&:date_and_time)
  primary = siblings.first
%>

<div class="border border-gray-200 rounded-lg overflow-hidden hover:border-gray-400 transition-all bg-white">
  <%# Header %>
  <div class="px-4 py-3 border-b border-gray-100 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <div class="w-3 h-3 rounded-full bg-pink-500"></div>
      <span class="text-sm font-medium text-gray-900"><%= event_linkage.display_name %></span>
    </div>
    <span class="text-xs text-gray-500">
      <%= all_events.count %> linked events
    </span>
  </div>
  
  <%# Timeline %>
  <div class="relative px-4 py-3">
    <%# Vertical line %>
    <div class="absolute left-8 top-3 bottom-3 w-0.5 bg-gray-200"></div>
    
    <div class="space-y-0">
      <% all_events.each_with_index do |show, index| %>
        <% is_sibling = show.linkage_sibling? %>
        <% is_first = index == 0 %>
        <% is_last = index == all_events.length - 1 %>
        
        <a href="#" class="relative flex items-start py-2 hover:bg-pink-50 -mx-4 px-4 transition group <%= 'pl-8' unless is_sibling %>">
          <%# Timeline dot %>
          <div class="relative z-10 flex-shrink-0 <%= is_sibling ? 'ml-0' : 'ml-4' %>">
            <% if is_sibling %>
              <%# Large dot for siblings %>
              <div class="w-4 h-4 rounded-full bg-pink-500 border-2 border-white shadow-sm"></div>
            <% else %>
              <%# Small dot for children %>
              <div class="w-2.5 h-2.5 rounded-full bg-amber-400 border-2 border-white shadow-sm ml-0.5 mt-0.5"></div>
            <% end %>
          </div>
          
          <%# Event Content %>
          <div class="ml-4 flex-1 min-w-0">
            <div class="flex items-center justify-between">
              <div>
                <span class="text-sm font-medium <%= is_sibling ? 'text-gray-900' : 'text-gray-700' %> group-hover:text-pink-600">
                  <%= show.event_type.titleize %>
                </span>
                <% if is_sibling %>
                  <span class="ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-700">
                    show
                  </span>
                <% else %>
                  <span class="ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-700">
                    prep
                  </span>
                <% end %>
              </div>
              
              <svg class="w-4 h-4 text-gray-400 group-hover:text-pink-500 opacity-0 group-hover:opacity-100 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
            
            <div class="text-xs text-gray-500 mt-0.5">
              <%= show.date_and_time.strftime("%A, %B %-d") %> @ <%= show.date_and_time.strftime("%-I:%M %p") %>
              <% if show.location %>
                <span class="text-gray-400">•</span> <%= show.location.name %>
              <% elsif show.is_online? %>
                <span class="text-gray-400">•</span> Online
              <% end %>
            </div>
          </div>
        </a>
      <% end %>
    </div>
  </div>
  
  <%# Footer with summary %>
  <div class="px-4 py-2 bg-gray-50 border-t border-gray-100 flex items-center justify-between">
    <div class="text-xs text-gray-500">
      <span class="inline-flex items-center gap-1">
        <span class="w-2 h-2 rounded-full bg-pink-500"></span>
        <%= siblings.count %> <%= "performance".pluralize(siblings.count) %>
      </span>
      <% if children.any? %>
        <span class="mx-2 text-gray-300">|</span>
        <span class="inline-flex items-center gap-1">
          <span class="w-2 h-2 rounded-full bg-amber-400"></span>
          <%= children.count %> <%= "rehearsal".pluralize(children.count) %>
        </span>
      <% end %>
    </div>
    
    <% if show_production && primary&.production %>
      <span class="text-xs text-gray-500"><%= primary.production.name %></span>
    <% end %>
  </div>
</div>
