<% content_for :title, "Auditions" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Auditions",
    links: []
  } %>

  <div class="w-full mt-10">
    <h1 class="font-bold text-2xl">Call to Audition</h1>
    <% if !@production.call_to_auditions.any? %>
      <div class="mb-5">
        You don&apos;t currently have any open Calls to Audition for this production.
      </div>
      <%= render partial: "shared/link_button", locals: {text: "Open a Call to Audition", path: new_production_call_to_audition_path(@production)} %>
    <% end %>
  </div>
  <div class="w-full">
    <% @production.call_to_auditions.order(:opens_at).each do |call_to_audition| %>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-1 md:gap-4">

        <div class="p-4 pb-6 border border-gray-200 rounded-lg hover:border-gray-400 transition-all">
          <p class="mb-2">

            <% if call_to_audition.timeline_status == :upcoming %>
              You've scheduled your Call to Audition to open
              on <b><%= call_to_audition.opens_at.strftime("%B %-d, %Y") %></b> and
              close on <b><%= call_to_audition.closes_at.strftime("%B %-d, %Y") %></b>.
            <% elsif call_to_audition.timeline_status == :open %>
              Your Call to Audition has been open since
              <b><%= call_to_audition.opens_at.strftime("%B %-d, %Y") %></b> and
              will close on <b><%= call_to_audition.closes_at.strftime("%B %-d, %Y") %></b>.
            <% else %>
              Your Call to Audition began
              on <b><%= call_to_audition.opens_at.strftime("%B %-d, %Y") %></b> and
              closed on <b><%= call_to_audition.closes_at.strftime("%B %-d, %Y") %></b>.
            <% end %>

          </p>

          <h2 class="font-bold text-lg col-span-1 mb-2 border-t-2 border-gray-200 pt-3 mt-5">Sign-up Form</h2>
          <div>
            <div class="w-full flex items-center mx-auto" data-controller="clipboard">
              <%= text_field_tag "", call_to_audition.respond_url, class: "block w-64 text-sm text-black bg-white shadow-sm rounded-lg border px-3 py-2 w-full border-gray-400", disabled: true, data: { clipboard_target: "textField" } %>
              <p class="ml-1 font-medium rounded-lg text-sm px-2 py-1 h-9 text-center mb-0 inline-block bg-pink-500 text-white hover:bg-gray-100 hover:text-pink-500 focus:ring-4 focus:outline-none focus:ring-gray-200 cursor-pointer" data-action="click->clipboard#copy">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
                </svg>
              </p>
            </div>
            <div class="mt-2">
              <%= render partial: "shared/link_button", locals: {text: "Edit Form", path: edit_production_call_to_audition_path(@production, call_to_audition)} %>
              <%= render partial: "shared/link_button", locals: {text: "Preview Form", path: production_call_to_audition_preview_path(@production, call_to_audition)} %>
            </div>
          </div>

        </div>

        <div class="p-4 pb-6 border border-gray-200 rounded-lg hover:border-gray-400 transition-all">
          <h2 class="font-bold text-lg col-span-1 mb-2">Audition Requests</h2>
          <div class="grid grid-cols-2 gap-2 mb-4">
            <%= link_to production_call_to_audition_audition_requests_path(@production, call_to_audition, status: :unreviewed) do %>
              <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all min-h-24">
                <p class="font-bold text-5xl text-center"><%= call_to_audition.counts[:unreviewed] %></p>
                <p class="text-xs text-center">Unreviewed</p>
              </div>
            <% end %>
            <%= link_to production_call_to_audition_audition_requests_path(@production, call_to_audition, status: :undecided) do %>
              <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all min-h-24">
                <p class="font-bold text-5xl text-center"><%= call_to_audition.counts[:undecided] %></p>
                <p class="text-xs text-center">Undecided</p>
              </div>
            <% end %>
            <%= link_to production_call_to_audition_audition_requests_path(@production, call_to_audition, status: :accepted) do %>
              <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all min-h-24">
                <p class="font-bold text-5xl text-center"><%= call_to_audition.counts[:accepted] %></p>
                <p class="text-xs text-center">Accepted</p>
              </div>
            <% end %>
            <%= link_to production_call_to_audition_audition_requests_path(@production, call_to_audition, status: :passed) do %>
              <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all min-h-24">
                <p class="font-bold text-5xl text-center"><%= call_to_audition.counts[:passed] %></p>
                <p class="text-xs text-center">Passed</p>
              </div>
            <% end %>
          </div>
          <%= render partial: "shared/link_button", locals: {text: "View all Audition Requests", path: production_call_to_audition_audition_requests_path(@production, call_to_audition)} %>
        </div>

      </div>
    </div>
    <div class="w-full mt-10">
      <h1 class="font-bold text-2xl mb-2">Auditions</h1>
      <div class="grid grid-cols-1">
        <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 transition-all">

          <% if @production.audition_sessions.any? %>
            <div class="grid grid-cols-1 gap-1 mb-2">
              <% @production.audition_sessions.each do |session| %>
                <%= link_to production_audition_session_path(@production, session) do %>
                  <div class="p-3 border border-gray-200 rounded-lg hover:border-gray-400 transition-all">
                    <div class="flex flex-row items-center justify-between mb-2">
                      <p class="text-md font-semibold"><%= session.start_at.strftime("%-m/%-d/%Y at %-l:%M %p") %></p>
                    </div>
                    <% if session.auditions.any? %>
                      <div class="grid grid-cols-8 lg:grid-cols-12 gap-1 w-full">
                        <% session.auditions.each do |audition| %>
                          <div class="flex flex-col items-center p-3 border border-gray-200 rounded-lg hover:border-gray-400 transition-all">

                            <% if audition.person.headshot.present? %>
                                <%= image_tag audition.person.headshot.variant(:thumb), alt: audition.person.stage_name, class: "w-12 h-12 rounded-lg object-cover mb-1" %>
                            <% else %>
                                <div class="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center mb-1 text-black font-bold">
                                    <%= audition.person.initials %>
                                </div>
                            <% end %>

                            <span class="font-medium text-xs text-center"><%= audition.person.stage_name.truncate(20, omission: '...') %></span>
                          </div>
                        <% end %>

                        <% if (!session.is_full? && !session.is_overbooked?) %>
                          <span class="inline-flex items-center text-xs text-gray-500 h-full text-center ml-2">
                              <div class="flex flex-col items-center justify-center">
                                  Add up to<br><%= session.maximum_auditionees - session.auditions.count %> more
                              </div>
                          </span>
                        <% end %>

                      </div>
                    <% else %>
                      <p class="text-gray-500 font-semibold text-xs">No auditions scheduled for this session.</p>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            </div>
          <% end %>

          <div class="flex justify-between space-x-2">
            <div>
              <% if @production.audition_sessions.any? %>
                <%= render partial: "shared/link_button", locals: {text: "Manage Audition Sessions", path: production_audition_sessions_path(@production)} %>
              <% end %>

              <%= render partial: "shared/link_button", locals: {text: "+ Schedule an Audition Session", path: new_production_audition_session_path(@production)} %>
            </div>
            <div>
              <%= render partial: "shared/link_button", locals: {text: "Audition Session Summary", path: production_audition_session_summary_path(@production)} %>
            </div>
          </div>

        </div>

      </div>
    <% end %>
  </div>
</div>
