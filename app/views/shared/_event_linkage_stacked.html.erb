<%#
  Event Linkage Display - Option B: Stacked Card

  Shows linked events as a single card with all siblings listed vertically,
  and children in a gray inset section below. Always expanded.

  Required params:
    - event_linkage: EventLinkage object

  Optional params:
    - show_production: Show production name (default: false)
%>

<%
  show_production = local_assigns.fetch(:show_production, false)
  siblings = event_linkage.sibling_shows.order(:date_and_time)
  children = event_linkage.child_shows.order(:date_and_time)
  primary = siblings.first
%>

<div class="border border-gray-200 rounded-lg overflow-hidden hover:border-gray-400 transition-all">
  <%# Header with linkage indicator %>
  <div class="bg-gradient-to-r from-pink-50 to-white px-4 py-2 border-b border-gray-200 flex items-center gap-2">
    <svg class="w-4 h-4 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
    </svg>
    <span class="text-sm font-medium text-pink-700"><%= event_linkage.display_name %></span>
    <% if show_production && primary&.production %>
      <span class="text-xs text-gray-500">• <%= primary.production.name %></span>
    <% end %>
  </div>

  <%# Sibling Shows - Full rows %>
  <div class="divide-y divide-gray-100">
    <% siblings.each_with_index do |show, index| %>
      <a href="#" class="flex items-center px-4 py-3 bg-white hover:bg-pink-50 transition group">
        <div class="flex items-center gap-4 flex-1">
          <%# Date Box %>
          <div class="flex-shrink-0 w-14 text-center">
            <div class="text-xs font-semibold text-pink-600 uppercase"><%= show.date_and_time.strftime("%b") %></div>
            <div class="text-2xl font-bold text-gray-900"><%= show.date_and_time.strftime("%-d") %></div>
            <div class="text-xs text-gray-500"><%= show.date_and_time.strftime("%a") %></div>
          </div>

          <%# Show Details %>
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2">
              <span class="text-sm font-medium text-gray-900 group-hover:text-pink-600">
                <%= show.event_type.titleize %>
              </span>
              <% if index == 0 %>
                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-pink-100 text-pink-700">
                  primary
                </span>
              <% end %>
            </div>
            <div class="text-xs text-gray-500 mt-0.5">
              <%= show.date_and_time.strftime("%-I:%M %p") %>
              <% if show.location %>
                • <%= show.location.name %>
              <% elsif show.is_online? %>
                • Online
              <% end %>
            </div>
          </div>
        </div>

        <svg class="w-4 h-4 text-gray-400 group-hover:text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    <% end %>
  </div>

  <%# Child Shows (Rehearsals) - Inset Section %>
  <% if children.any? %>
    <div class="bg-gray-50 border-t border-gray-200">
      <div class="px-4 py-2 flex items-center gap-2 border-b border-gray-200">
        <svg class="w-3.5 h-3.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <span class="text-xs font-medium text-gray-600 uppercase tracking-wide">
          Rehearsals & Prep (<%= children.count %>)
        </span>
      </div>

      <div class="divide-y divide-gray-100">
        <% children.each do |show| %>
          <a href="#" class="flex items-center px-4 py-2 pl-8 hover:bg-gray-100 transition group">
            <div class="flex items-center gap-3 flex-1">
              <%# Smaller Date Box %>
              <div class="flex-shrink-0 w-10 text-center">
                <div class="text-xs text-gray-500"><%= show.date_and_time.strftime("%b %-d") %></div>
                <div class="text-xs text-gray-400"><%= show.date_and_time.strftime("%a") %></div>
              </div>

              <%# Details %>
              <div class="flex-1 min-w-0">
                <span class="text-sm text-gray-700 group-hover:text-gray-900">
                  <%= show.event_type.titleize %>
                </span>
                <span class="text-xs text-gray-500 ml-2">
                  <%= show.date_and_time.strftime("%-I:%M %p") %>
                </span>
              </div>
            </div>

            <svg class="w-3.5 h-3.5 text-gray-300 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
