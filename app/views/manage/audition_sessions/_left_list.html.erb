<div class="p-4 rounded-lg border border-gray-200" id="left_panel">

    <h2 class="font-semibold text-lg mb-1">Audition Requests</h2>

    <span class="text-sm text-gray-500 mb-3 block">
        Drag each person from the list on the left to an audition slot on the right to schedule them.
    </span>

    <div class="flex space-x-2 mb-4">
        <%= link_to "To Be Scheduled",
                manage_production_audition_sessions_path(production, filter: "to_be_scheduled"),
                data: { turbo_prefetch: false },
                class: "px-3 py-1 rounded-md border text-sm #{(filter.blank? || filter == "to_be_scheduled") ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
        <%= link_to "All Accepted",
                manage_production_audition_sessions_path(production, filter: "accepted"),
                data: { turbo_prefetch: false },
                class: "px-3 py-1 rounded-md border text-sm #{(filter == "accepted") ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
        <%= link_to "All Requests",
                manage_production_audition_sessions_path(production, filter: "all"),
                data: { turbo_prefetch: false },
                class: "px-3 py-1 rounded-md border text-sm #{(filter == "all") ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200'}"
        %>
    </div>

    <% if production.audition_requests(filter: filter || "to_be_scheduled").any? %>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
            <% production.audition_requests(filter: filter || "to_be_scheduled").each do |audition_request| %>

                <% scheduled = audition_request.scheduled_in_any?(production.audition_sessions) %>

                <div
                    class="flex flex-col items-center p-3 border border-gray-200 rounded-lg hover:border-gray-400 transition-all cursor-grab bg-[#f9f9f7]"
                    data-drag-target="item" data-id="<%= audition_request.id %>" draggable="true" data-action="dragstart->drag#dragStart"
                >
                    <% if audition_request.person.headshot.present? %>
                      <%= image_tag audition_request.person.headshot.variant(:thumb), alt: audition_request.person.name, class: "w-12 h-12 rounded-lg object-cover mb-1 #{'opacity-40' if scheduled}", draggable: false %>
                    <% else %>
                     <div class="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center mb-1 text-black font-bold">
                        <%= audition_request.person.initials %>
                    </div>
                    <% end %>
                    <span class="font-medium text-xs text-center <%= 'text-gray-300' if scheduled %>"><%= audition_request.person.name.truncate(20, omission: '...') %></span>
                </div>
            <% end %>
        </div>
    <% else %>
        <% if filter == "to_be_scheduled" %>
            <p class="text-gray-500 text-sm">All Accepted audition requests have been scheduled.</p>
        <% else %>
            <p class="text-gray-500 text-sm">No audition requests.</p>
        <% end %>
    <% end %>
</div>