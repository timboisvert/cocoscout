<div class="flex flex-col md:flex-row gap-4">

  <div class="flex-1 space-y-2">
    <% if @questions.any? %>
      <div class="space-y-2" data-controller="question-order" data-question-order-url="<%= reorder_questions_manage_production_call_to_audition_path(@production, @call_to_audition) %>">
        <% @questions.each do |question| %>
          <div class="p-4 border border-gray-200 bg-white rounded-lg hover:border-gray-400 transition-all cursor-move" draggable="true" data-question-order-target="item" data-id="<%= question.id %>" data-action="dragstart->question-order#startDrag dragend->question-order#endDrag dragover->question-order#dragOver drop->question-order#drop touchstart->question-order#touchStart touchmove->question-order#touchMove touchend->question-order#touchEnd" onclick="event.stopPropagation();">
            <div class="flex items-start gap-4">
              <span class="text-gray-400 cursor-move mt-1" title="Drag to reorder">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5" />
                </svg>
              </span>
              <div class="flex-1">
                <p class="mb-1 font-bold">
                  <%= question.text %>
                </p>
                <p class="text-sm text-gray-500 mb-1">
                  Type:
                  <% if question.question_type == "text" %>
                  Short Text
                  <% elsif question.question_type == "textarea" %>
                  Long Text
                  <% elsif question.question_type == "yesno" %>
                  Yes/No
                  <% elsif question.question_type == "multiple-multiple" %>
                  Select Multiple Options
                  <span class="ml-1 text-gray-500">(Options: <%= question.question_options.pluck(:text).join(", ") %>)</span>
                  <% elsif question.question_type == "multiple-single" %>
                  Select Single Option
                  <span class="ml-1 text-gray-500">(Options: <%= question.question_options.pluck(:text).join(", ") %>)</span>
                  <% end %>
                </p>
                <p class="text-sm text-gray-500 mb-2">
                  Required: <%= question.required ? "Yes" : "No" %>
                </p>
                <div class="flex gap-2 items-baseline">
                  <%= link_to "Edit",
                      form_manage_production_call_to_audition_path(@production, @call_to_audition, question_id: question.id),
                      class: "text-xs underline text-pink-500 hover:text-pink-600",
                      data: { turbo_frame: "_top" }
                  %>
                  <%= button_to "Delete",
                      destroy_question_manage_production_call_to_audition_path(@production, @call_to_audition, question_id: question.id),
                      method: :delete,
                      form: { data: { turbo_confirm: "Are you sure you want to delete this question?" }, class: "inline" },
                      class: "text-xs underline text-pink-500 hover:text-pink-600 cursor-pointer border-0 bg-transparent p-0 font-normal leading-none"
                  %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="p-4 border border-gray-200 bg-white rounded-lg text-center text-gray-500">
        No custom questions yet. Add your first question using the form on the right.
      </div>
    <% end %>
  </div>

  <div class="flex-1">
    <div class="sticky top-4 border border-gray-200 rounded-lg overflow-hidden bg-white" id="question-form">
      <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
        <h3 class="text-md font-semibold text-gray-900 coustard-regular"><%= @question.persisted? ? "Edit Question" : "Add a Question" %></h3>
        <p class="text-xs text-gray-500 mt-1">Custom Questions are shown at the bottom of the Audition sign-up form.</p>
      </div>

      <%= form_with(
        url: @question.persisted? ? update_question_manage_production_call_to_audition_path(@production, @call_to_audition, question_id: @question.id) : create_question_manage_production_call_to_audition_path(@production, @call_to_audition),
        model: @question,
        method: @question.persisted? ? :patch : :post,
        class: "p-6"
      ) do |form| %>

        <div class="mb-4">
          <% if @question_error %>
            <%= form.label :text, "Question Text is required", class: "text-pink-500 text-sm font-medium" %>
          <% else %>
            <%= form.label :text, "Question Text", class: "text-sm font-medium" %>
          <% end %>
          <%= form.text_field :text, class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400": @question.errors[:text].none?, "border-pink-500": @question.errors[:text].any?}] %>
        </div>

        <div data-controller="form-toggle">
          <div class="flex gap-2 mb-4">
            <div class="flex-1">
              <%= form.label :question_type, "Question Type", class: "text-sm font-medium" %>
              <%= form.select :question_type,
                [["Short Text", "text"], ["Long Text", "textarea"], ["Yes/No", "yesno"], ["Select Multiple Options", "multiple-multiple"], ["Select Single Option", "multiple-single"]],
                {},
                { class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400": @question.errors[:question_type].none?, "border-pink-500": @question.errors[:question_type].any?}],
                  data: { "form-toggle-target": "select", action: "change->form-toggle#toggle"}
                } %>
            </div>

            <div class="w-32">
              <%= form.label :required, "Required", class: "text-sm font-medium" %>
              <%= form.select :required,
                [["No", false], ["Yes", true]],
                {},
                { class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400": @question.errors[:required].none?, "border-pink-500": @question.errors[:required].any?}] } %>
            </div>
          </div>

          <div data-form-toggle-target="section" data-toggle-value="multiple" class="hidden mb-4">
            <%= render partial: "multiple_options", locals: { form: form } %>
          </div>
        </div>

        <div class="border-t border-gray-200 pt-4">
          <%= form.submit @question.persisted? ? "Update Question" : "Add Question", class: "w-full sm:w-auto rounded-lg px-3.5 py-2.5 bg-pink-500 hover:bg-pink-600 text-white font-medium cursor-pointer" %>
          <% if @question.persisted? %>
            <%= link_to "Cancel", form_manage_production_call_to_audition_path(@production, @call_to_audition, questions_open: true), class: "w-full sm:w-auto text-center mt-2 sm:mt-0 sm:ml-2 rounded-lg px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

</div>