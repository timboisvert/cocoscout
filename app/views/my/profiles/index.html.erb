<% content_for :title, "My Profiles" %>

<div class="w-full">
  <%= render partial: "shared/notice", locals: { notice: notice, alert: flash[:alert] } %>

  <!-- Header -->
  <div class="bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
      <h3 class="text-md font-semibold text-gray-900 coustard-regular">My Profiles</h3>
      <%= link_to new_my_profile_path, class: "inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-pink-600 hover:text-pink-700 hover:bg-pink-50 rounded-lg transition-colors" do %>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        Create New Profile
      <% end %>
    </div>

    <div class="p-6">
      <p class="text-sm text-gray-600 mb-6">
        Manage your performer profiles. You can have multiple profiles for different personas (e.g., your real name and a stage name).
        Your default profile is used when signing up for auditions.
      </p>

      <% if @profiles.any? %>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <% @profiles.each do |profile| %>
            <div class="relative group border-2 <%= profile.default_profile? ? 'border-pink-300 bg-pink-50/30' : 'border-gray-200' %> rounded-lg p-5 hover:border-pink-300 hover:shadow-md transition-all">

              <%# Default Badge %>
              <% if profile.default_profile? %>
                <div class="absolute top-3 right-3">
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium text-pink-700 bg-pink-100 rounded-full">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                    Default
                  </span>
                </div>
              <% end %>

              <div class="flex items-start gap-4">
                <%# Headshot %>
                <% headshot = profile.profile_headshots.order(created_at: :desc).first %>
                <% if headshot&.image&.attached? %>
                  <%= image_tag headshot.image.variant(resize_to_fill: [80, 80]), class: "w-20 h-20 rounded-lg object-cover flex-shrink-0" %>
                <% else %>
                  <div class="w-20 h-20 rounded-lg bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white font-bold text-xl flex-shrink-0">
                    <%= profile.initials %>
                  </div>
                <% end %>

                <%# Profile Info %>
                <div class="flex-1 min-w-0">
                  <h4 class="text-lg font-semibold text-gray-900 truncate"><%= profile.name %></h4>
                  <% if profile.pronouns.present? %>
                    <p class="text-sm text-gray-500"><%= profile.pronouns %></p>
                  <% end %>
                  <p class="text-xs text-gray-400 mt-1 truncate"><%= profile.email %></p>
                </div>
              </div>

              <%# Actions %>
              <div class="mt-4 pt-4 border-t border-gray-200 flex flex-wrap items-center gap-2">
                <%= link_to edit_my_profile_path(profile), class: "text-sm text-pink-600 hover:text-pink-700 underline" do %>
                  Edit
                <% end %>

                <% unless profile.default_profile? %>
                  <span class="text-gray-300">·</span>
                  <%= button_to "Set as Default", set_default_my_profile_path(profile), method: :post, class: "text-sm text-pink-600 hover:text-pink-700 underline cursor-pointer" %>
                  <span class="text-gray-300">·</span>
                  <%= button_to "Archive", archive_my_profile_path(profile), method: :post, class: "text-sm text-gray-500 hover:text-red-600 underline cursor-pointer", data: { turbo_confirm: "Are you sure you want to archive this profile? It will no longer appear in audition sign-ups." } %>
                <% end %>

                <% if profile.public_profile_enabled && profile.public_key.present? %>
                  <span class="text-gray-300">·</span>
                  <%= link_to public_profile_path(profile.public_key), target: "_blank", class: "text-sm text-gray-500 hover:text-pink-600 underline" do %>
                    View Public Profile
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>

          <%# Add New Profile Card %>
          <%= link_to new_my_profile_path, class: "group flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-pink-400 hover:bg-pink-50/30 transition-all min-h-[180px]" do %>
            <div class="w-14 h-14 rounded-full bg-gray-100 group-hover:bg-pink-100 flex items-center justify-center mb-3 transition-colors">
              <svg class="w-7 h-7 text-gray-400 group-hover:text-pink-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
            </div>
            <span class="text-sm font-medium text-gray-600 group-hover:text-pink-600 transition-colors">Create New Profile</span>
          <% end %>
        </div>
      <% else %>
        <%# Empty State %>
        <div class="text-center py-12">
          <div class="w-16 h-16 mx-auto rounded-full bg-pink-100 flex items-center justify-center mb-4">
            <svg class="w-8 h-8 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
          </div>
          <h4 class="text-lg font-semibold text-gray-900 mb-2">No Profiles Yet</h4>
          <p class="text-sm text-gray-600 mb-6 max-w-md mx-auto">
            Create your first profile to start auditioning. You can add headshots, resumes, and more later.
          </p>
          <%= render "shared/button",
            text: "Create Your First Profile",
            variant: "primary",
            icon: "plus",
            type: :link,
            path: new_my_profile_path %>
        </div>
      <% end %>
    </div>
  </div>

  <%# Info Box %>
  <div class="p-4 bg-pink-50 border border-pink-200 rounded-lg">
    <div class="flex gap-3">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-pink-600 flex-shrink-0 mt-0.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
      </svg>
      <div class="text-sm text-pink-800">
        <p class="font-medium mb-1">About Multiple Profiles</p>
        <p>Multiple profiles let you audition under different names or personas. For example, you might have a profile for your legal name and another for a stage name. Each profile can have its own headshots, resume, and performance history.</p>
      </div>
    </div>
  </div>
</div>
