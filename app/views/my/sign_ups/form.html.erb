<% content_for :title, @sign_up_form.name %>

<div class="min-h-screen bg-gray-50 py-8" data-controller="sign-up-confirmation" data-sign-up-confirmation-submit-url-value="<%= my_submit_sign_up_form_path(@code, instance_id: @instance&.id) %>" data-sign-up-confirmation-change-mode-value="<%= @my_registration.blank? %>">
  <div class="max-w-6xl mx-auto px-4">

    <!-- Full-Width Header -->
    <div class="mb-8 sm:mb-10">
      <h1 class="text-3xl sm:text-4xl font-bold text-slate-900 mb-3 coustard-regular"><%= @sign_up_form.name %></h1>
    </div>

    <%= render partial: "shared/notice", locals: { notice: notice, alert: flash[:alert] } %>

    <%# Event Picker - shown when multiple events are open %>
    <% if @show_event_picker && @open_instances.present? %>
      <div class="mb-8">
        <h2 class="text-lg font-semibold text-slate-900 mb-2">Select an Event</h2>
        <p class="text-sm text-slate-600 mb-4">Multiple events are currently accepting sign-ups. Please select the one you'd like to register for.</p>

        <div class="space-y-2">
          <% @open_instances.each do |instance| %>
            <%= render "shared/show_row",
                show: instance.show,
                link_path: my_sign_up_form_path(@code, instance_id: instance.id),
                right_panel: instance.closes_at.present? && instance.closes_at > Time.current ? :countdown : nil,
                closes_at: instance.closes_at %>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if @my_registrations.present? %>
      <%
        queued_regs = @my_registrations.select(&:queued?)
        assigned_regs = @my_registrations.reject(&:queued?)
      %>
      <div class="mb-8 bg-pink-50 border border-pink-200 rounded-lg p-5 sm:p-6" data-sign-up-confirmation-target="changeSlotSection">
        <div class="flex items-start gap-4">
          <div class="flex-shrink-0 mt-0.5">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-pink-600">
              <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
            </svg>
          </div>
          <div class="flex-1">
            <% if queued_regs.any? %>
              <h3 class="font-semibold text-pink-900 mb-2">You're in the Queue</h3>
              <p class="text-sm text-pink-800 mb-3">
                <% queue_position = queued_regs.first.position %>
                Your position: <span class="font-medium">#<%= queue_position %></span>
              </p>
              <p class="text-sm text-pink-700 mb-3">The organizer will assign you to a slot.</p>
            <% elsif assigned_regs.count == 1 %>
              <h3 class="font-semibold text-pink-900 mb-2">You're Registered</h3>
              <p class="text-sm text-pink-800 mb-3">
                Your slot: <span class="font-medium"><%= assigned_regs.first.sign_up_slot.display_name %></span>
              </p>
            <% else %>
              <h3 class="font-semibold text-pink-900 mb-2">You're Registered</h3>
              <div class="text-sm text-pink-800 mb-3">
                <p class="mb-1">Your slots:</p>
                <ul class="list-disc list-inside space-y-1">
                  <% assigned_regs.each do |reg| %>
                    <li><span class="font-medium"><%= reg.sign_up_slot.display_name %></span></li>
                  <% end %>
                </ul>
              </div>
            <% end %>
            <% if @can_register_more %>
              <p class="text-sm text-pink-700 mb-3">
                You can register for <%= @registrations_remaining %> more slot<%= @registrations_remaining == 1 ? '' : 's' %>.
              </p>
            <% end %>
            <% if @sign_up_form.allow_cancel %>
              <div class="flex flex-wrap gap-2">
                <button
                  type="button"
                  data-action="click->sign-up-confirmation#openCancelConfirmation"
                  class="inline-flex items-center gap-1 px-3 py-2 bg-red-50 text-red-700 text-sm font-medium rounded border border-red-200 hover:bg-red-100 transition-colors cursor-pointer"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                  Cancel Registration<%= @my_registrations.count > 1 ? 's' : '' %>
                </button>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <%# Registration Deadline Countdown - shown when closes_at is set %>
    <% if !@show_event_picker && @instance&.closes_at.present? && @instance.closes_at > Time.current %>
      <div class="mb-6 bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-center gap-3"
           data-controller="countdown"
           data-countdown-until-value="<%= @instance.closes_at.iso8601 %>"
           data-countdown-expired-action-value="refresh">
        <div class="flex-shrink-0">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-amber-600">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
        </div>
        <div class="flex-1">
          <span class="text-sm text-amber-800">Registration closes </span>
          <span class="text-sm font-semibold text-amber-900 tabular-nums" data-countdown-target="clock">--</span>
        </div>
      </div>
    <% end %>

    <%# Only show the form content if we're not in event picker mode %>
    <% unless @show_event_picker %>
    <!-- Two Column Layout: Info & Form -->
    <div class="grid lg:grid-cols-2 gap-8 lg:gap-12">

      <!-- Left Column: Instruction Text, Show Info, Map -->
      <div class="space-y-6">
        <% if @sign_up_form.instruction_text.present? %>
          <div class="bg-gradient-to-br from-slate-50 to-white border border-slate-200 rounded-lg p-6 sm:p-8 shadow-sm">
            <div class="prose prose-slate max-w-none text-slate-700">
              <%= @sign_up_form.instruction_text %>
            </div>
          </div>
        <% end %>

        <%# Show Info - just the show_row, no wrapper box %>
        <% if @show.present? %>
          <%= render "shared/show_row", show: @show, show_location: true %>

          <%# Location Box with Map %>
          <% if @show.location.present? && !@show.is_online %>
            <% loc = @show.location %>
            <% address = [loc.address1, loc.address2, loc.city, loc.state, loc.postal_code].compact.reject(&:blank?).join(', ') %>
            <div class="bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden">
              <div class="p-4 space-y-4">
                <%# Location name and address %>
                <div>
                  <div class="font-semibold text-gray-900"><%= loc.name %></div>
                  <div class="text-sm text-gray-600 mt-1">
                    <% if loc.address1.present? %>
                      <%= loc.address1 %><br>
                    <% end %>
                    <% if loc.address2.present? %>
                      <%= loc.address2 %><br>
                    <% end %>
                    <% if loc.city.present? || loc.state.present? || loc.postal_code.present? %>
                      <%= loc.city %><% if loc.city.present? && loc.state.present? %>,<% end %> <%= loc.state %> <%= loc.postal_code %>
                    <% end %>
                  </div>
                </div>

                <%# Full-width Map %>
                <div class="w-full h-[200px]">
                  <iframe
                    width="100%"
                    height="100%"
                    style="border:0; border-radius: 0.5rem;"
                    loading="lazy"
                    allowfullscreen
                    referrerpolicy="no-referrer-when-downgrade"
                    src="https://www.google.com/maps?q=<%= URI.encode_www_form_component(address) %>&output=embed">
                  </iframe>
                </div>

                <%# 50/50 buttons %>
                <div class="grid grid-cols-2 gap-2">
                  <a href="http://maps.apple.com/?address=<%= URI.encode_www_form_component(address) %>" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center gap-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                    </svg>
                    Open in Maps
                  </a>
                  <a href="https://www.google.com/maps/search/?api=1&query=<%= URI.encode_www_form_component(address) %>" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center gap-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                    </svg>
                    Google Maps
                  </a>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>

      <!-- Right Column: Form -->
      <div class="space-y-4">

        <!-- Profile Section -->
        <div class="bg-white border border-slate-200 rounded-lg shadow-sm">
          <div class="p-5">
            <% if Current.user&.person %>
              <% profile = Current.user.person %>
              <label class="block text-sm font-medium text-gray-700 mb-3">Signing up as:</label>
              <div class="flex items-center gap-3 px-4 py-3 bg-white border border-gray-300 rounded-lg">
                <% if profile.headshot&.attached? %>
                  <%= image_tag profile.headshot.variant(resize_to_fill: [48, 48]), class: "w-12 h-12 rounded object-cover flex-shrink-0" %>
                <% else %>
                  <div class="w-12 h-12 rounded bg-gray-200 flex items-center justify-center flex-shrink-0">
                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                <% end %>
                <div class="flex-1 text-left min-w-0">
                  <div class="font-medium text-gray-900 truncate"><%= profile.name %></div>
                  <div class="text-sm text-gray-500 truncate">@<%= profile.public_key %></div>
                </div>
              </div>
              <div class="mt-0 text-left">
                <%= link_to profile_path, target: "_blank", class: "text-xs text-pink-500 hover:text-pink-600 underline" do %>
                  Edit Profile
                <% end %>
              </div>
            <% else %>
              <%# Guest sign-up (require_login is false) %>
              <label class="block text-sm font-medium text-gray-700 mb-3">Your Info:</label>
              <div class="space-y-3">
                <div>
                  <label for="guest_name" class="block text-sm text-gray-600 mb-1">Name <span class="text-red-500">*</span></label>
                  <input type="text" name="guest_name" id="guest_name" required
                         class="block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-pink-500 focus:ring-pink-500"
                         placeholder="Your name">
                </div>
                <div>
                  <label for="guest_email" class="block text-sm text-gray-600 mb-1">Email <span class="text-gray-400">(optional)</span></label>
                  <input type="email" name="guest_email" id="guest_email"
                         class="block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-pink-500 focus:ring-pink-500"
                         placeholder="your@email.com">
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- Slot Selection -->
        <% if @sign_up_form.admin_assigns? %>
          <%# Admin Assigns mode: User joins a queue, admin assigns later %>
          <div class="bg-white border border-slate-200 rounded-lg shadow-sm">
            <div class="p-5">
              <%
                # Calculate queue position (what position they'd be in)
                current_queue_size = @instance&.queued_registrations&.count || 0
                queue_limit = @sign_up_form.queue_limit
                queue_full = queue_limit.present? && current_queue_size >= queue_limit
              %>
              <div class="text-center space-y-4">
                <div>
                  <p class="text-sm text-gray-600 mb-2">Join the queue and the organizer will assign you to a slot</p>
                  <% if current_queue_size > 0 %>
                    <p class="text-2xl font-bold text-gray-900"><%= current_queue_size %></p>
                    <p class="text-sm text-gray-500">people in queue</p>
                  <% end %>
                </div>
                <% if queue_full %>
                  <p class="text-sm text-gray-500 py-2">Queue is full</p>
                <% else %>
                  <button
                    type="button"
                    data-action="click->sign-up-confirmation#joinQueue"
                    class="w-full py-3 px-4 bg-pink-600 hover:bg-pink-700 text-white font-medium rounded-lg transition-colors cursor-pointer"
                  >
                    Join Queue
                  </button>
                <% end %>
              </div>
            </div>
          </div>
        <% elsif @sign_up_form.slot_selection_mode == "auto_assign" %>
          <%# Auto-assign mode: Single button to get next available slot %>
          <div class="bg-white border border-slate-200 rounded-lg shadow-sm">
            <div class="p-5">
              <% available_slot = @slots.find { |s| !s.full? && !s.is_held? } %>
              <%
                # For waitlists (open_list/simple_capacity), show total spots remaining
                # For other modes, show count of available slots
                is_waitlist_mode = %w[simple_capacity open_list].include?(@sign_up_form.slot_generation_mode)
                if is_waitlist_mode
                  total_spots_remaining = @slots.sum { |s| s.is_held? ? 0 : s.spots_remaining }
                else
                  total_spots_remaining = @slots.reject { |s| s.full? || s.is_held? }.count
                end
              %>
              <% if available_slot %>
                <div class="text-center space-y-4">
                  <% if total_spots_remaining < 1000 %>
                    <div>
                      <p class="text-sm text-gray-600 mb-2">You'll be assigned the next available spot</p>
                      <p class="text-2xl font-bold text-gray-900"><%= total_spots_remaining %></p>
                      <p class="text-sm text-gray-500">spot<%= total_spots_remaining == 1 ? '' : 's' %> remaining</p>
                    </div>
                  <% end %>
                  <button
                    type="button"
                    data-action="click->sign-up-confirmation#selectSlot"
                    data-slot-id="<%= available_slot.id %>"
                    data-slot-name="Next Available Spot"
                    data-spots-remaining="<%= total_spots_remaining %>"
                    data-capacity="1"
                    class="w-full py-3 px-4 bg-pink-600 hover:bg-pink-700 text-white font-medium rounded-lg transition-colors cursor-pointer"
                  >
                    Sign Up Now
                  </button>
                </div>
              <% else %>
                <p class="text-sm text-gray-500 text-center py-4">No spots available at this time.</p>
              <% end %>
            </div>
          </div>
        <% else %>
          <%# Choose slot mode: Show all slots %>
          <div class="bg-white border border-slate-200 rounded-lg shadow-sm" data-sign-up-confirmation-target="slotList">
            <div class="p-5">
              <label class="block text-sm font-medium text-gray-700 mb-3">
                <% if @my_registrations.present? && @can_register_more %>
                  Add Another Slot
                <% else %>
                  Select a Slot
                <% end %>
                <% if @sign_up_form.registrations_per_person.to_i > 1 && @sign_up_form.registrations_per_person < 999 %>
                  <span class="text-gray-500 font-normal">(up to <%= @sign_up_form.registrations_per_person %> per person)</span>
                <% end %>
              </label>
              <% if @slots.any? %>
                <%
                  # Build a set of slot IDs the user has registered for
                  my_slot_ids = @my_registrations.map(&:sign_up_slot_id).to_set
                %>
                <div class="space-y-2">
                  <% @slots.each do |slot| %>
                    <% my_slot = my_slot_ids.include?(slot.id) %>
                    <% if slot.is_held? %>
                      <div class="relative py-3 px-4 bg-gray-100 border border-gray-200 rounded-lg">
                        <div class="flex items-center justify-center">
                          <span class="text-sm font-medium text-gray-500"><%= slot.held_reason.presence || "Unavailable" %></span>
                        </div>
                      </div>
                    <% elsif my_slot %>
                      <%# Current user's slot - pink with white text %>
                      <div class="py-3 px-4 bg-pink-500 border border-pink-500 rounded-lg">
                        <div class="flex items-center justify-between">
                          <div class="flex items-center gap-2">
                            <span class="text-sm font-medium text-white"><%= slot.display_name %></span>
                            <% if @sign_up_form.show_registrations %>
                              <span class="text-sm text-pink-100"><%= Current.user&.person&.name %></span>
                            <% end %>
                          </div>
                          <span class="text-xs text-pink-100 font-medium">Your slot</span>
                        </div>
                      </div>
                    <% elsif slot.full? %>
                      <div class="py-3 px-4 bg-gray-100 border border-gray-200 rounded-lg opacity-60">
                        <div class="flex items-center justify-between">
                          <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600"><%= slot.display_name %></span>
                            <% if @sign_up_form.show_registrations && slot.sign_up_registrations.any? %>
                              <% names = slot.sign_up_registrations.filter { |r| r.status != 'cancelled' }.map { |r| r.person&.name || 'Anonymous' }.join(', ') %>
                              <% if names.present? %>
                                <span class="text-sm text-gray-500"><%= names %></span>
                              <% end %>
                            <% end %>
                          </div>
                          <% if slot.capacity > 1 %>
                            <span class="text-xs text-gray-500">Full</span>
                          <% end %>
                        </div>
                      </div>
                    <% elsif @my_registrations.present? && !@can_register_more %>
                      <%# User has reached limit - show slot as non-clickable %>
                      <div class="py-3 px-4 bg-white border border-gray-200 rounded-lg opacity-60">
                        <div class="flex items-center gap-2">
                          <span class="text-sm text-gray-600"><%= slot.display_name %></span>
                          <% if @sign_up_form.show_registrations && slot.sign_up_registrations.any? %>
                            <% names = slot.sign_up_registrations.filter { |r| r.status != 'cancelled' }.map { |r| r.person&.name || 'Anonymous' }.join(', ') %>
                            <% if names.present? %>
                              <span class="text-sm text-gray-500"><%= names %></span>
                            <% end %>
                          <% end %>
                        </div>
                      </div>
                    <% else %>
                      <button
                        type="button"
                        data-action="click->sign-up-confirmation#selectSlot"
                        data-slot-id="<%= slot.id %>"
                        data-slot-name="<%= slot.display_name %>"
                        data-spots-remaining="<%= slot.spots_remaining %>"
                        data-capacity="<%= slot.capacity %>"
                        class="w-full flex items-center justify-between py-3 px-4 bg-white border border-gray-200 rounded-lg cursor-pointer hover:border-pink-300 hover:bg-pink-50 transition-colors text-left group"
                      >
                        <div class="flex-1 flex items-center gap-2">
                          <span class="text-sm font-medium text-gray-900 group-hover:text-pink-700"><%= slot.display_name %></span>
                          <% if @sign_up_form.show_registrations && slot.sign_up_registrations.any? %>
                            <% names = slot.sign_up_registrations.filter { |r| r.status != 'cancelled' }.map { |r| r.person.name rescue 'Anonymous' }.join(', ') %>
                            <% if names.present? %>
                              <span class="text-sm text-gray-500"><%= names %></span>
                            <% end %>
                          <% end %>
                        </div>
                        <% if slot.capacity > 1 && slot.capacity < 1000 %>
                          <span class="text-xs text-pink-600 font-medium flex-shrink-0 ml-4"><%= slot.spots_remaining %> spot<%= slot.spots_remaining == 1 ? '' : 's' %> left</span>
                        <% else %>
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-gray-400 group-hover:text-pink-500 flex-shrink-0 ml-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                          </svg>
                        <% end %>
                      </button>
                    <% end %>
                  <% end %>
                </div>
              <% else %>
                <p class="text-sm text-gray-500 text-center py-4">No slots available at this time.</p>
              <% end %>
            </div>
          </div>
        <% end %>

        <!-- Questions Section -->
        <% if @questions.any? %>
          <div class="bg-white border border-slate-200 rounded-lg shadow-sm p-5 space-y-5">
            <% @questions.each do |question| %>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <%= question.text %>
                  <% if question.required? %>
                    <span class="text-gray-500 text-sm">(required)</span>
                  <% end %>
                </label>

                <%= render_question_input(question, {}) %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    <% end %> <%# end unless @show_event_picker %>
  </div>

  <!-- Confirmation Modal -->
  <div data-sign-up-confirmation-target="modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" data-action="click->sign-up-confirmation#close keydown.esc@window->sign-up-confirmation#close">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full overflow-hidden" data-action="click->sign-up-confirmation#stopPropagation">
      <!-- Modal Header -->
      <div class="bg-pink-600 px-6 py-4">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold text-white">Confirm Sign-Up</h2>
          <button type="button" data-action="click->sign-up-confirmation#close" class="text-white/80 hover:text-white cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="p-6 space-y-5">
        <!-- Show Info -->
        <% if @show.present? %>
          <div class="bg-slate-50 rounded-lg p-4">
            <div class="flex items-center gap-4">
              <%# Date Box %>
              <div class="flex-shrink-0 w-14 text-center">
                <div class="text-xs font-semibold text-pink-600 uppercase"><%= @show.date_and_time.strftime("%b") %></div>
                <div class="text-2xl font-bold text-gray-900"><%= @show.date_and_time.strftime("%-d") %></div>
                <div class="text-xs text-gray-500"><%= @show.date_and_time.strftime("%a") %></div>
              </div>
              <%# Show Details %>
              <div class="flex-1 min-w-0">
                <p class="font-medium text-gray-900"><%= @show.secondary_name.presence || @show.event_type.titleize %></p>
                <p class="text-sm text-gray-500"><%= @show.date_and_time.strftime("%-I:%M %p") %></p>
                <% if @show.location.present? %>
                  <p class="text-sm text-gray-500"><%= @show.location.name %></p>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Selected Slot (hidden for waitlist modes) -->
        <% unless %w[simple_capacity open_list].include?(@sign_up_form.slot_generation_mode) %>
          <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex items-center gap-3">
              <div class="flex-shrink-0 w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-pink-600">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-xs text-gray-500 uppercase tracking-wide mb-0.5">Your Slot</p>
                <p class="font-semibold text-gray-900" data-sign-up-confirmation-target="slotName"></p>
                <p class="text-sm text-gray-500 hidden" data-sign-up-confirmation-target="slotInfo"></p>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Profile Info (if logged in) -->
        <% if Current.user&.person %>
          <% profile = Current.user.person %>
          <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex items-center gap-3">
              <% if profile.headshot&.attached? %>
                <%= image_tag profile.headshot.variant(resize_to_fill: [40, 40]), class: "w-10 h-10 rounded object-cover flex-shrink-0" %>
              <% else %>
                <div class="w-10 h-10 rounded bg-gray-200 flex items-center justify-center flex-shrink-0">
                  <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                  </svg>
                </div>
              <% end %>
              <div class="flex-1 min-w-0">
                <p class="text-xs text-gray-500 uppercase tracking-wide mb-0.5">Signing up as</p>
                <p class="font-medium text-gray-900 truncate"><%= profile.name %></p>
                <p class="text-sm text-gray-500 truncate">@<%= profile.public_key %></p>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Modal Footer -->
      <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
        <%= form_with url: my_submit_sign_up_form_path(@code, instance_id: @instance&.id), method: :post, local: true, class: "flex gap-3 justify-end" do |form| %>
          <input type="hidden" name="slot_id" value="" data-sign-up-confirmation-target="hiddenSlotId">
          <%= render "shared/button", text: "Cancel", type: :button, variant: "secondary", size: "large", data: { action: "click->sign-up-confirmation#close" } %>
          <%= render "shared/button", text: "Confirm Sign-Up", variant: "primary", size: "large", data: { "sign-up-confirmation-target": "confirmButton", action: "click->sign-up-confirmation#confirm" } %>
        <% end %>
      </div>
    </div>
  </div>
</div>
