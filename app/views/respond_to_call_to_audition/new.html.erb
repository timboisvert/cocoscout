<div class="w-full max-w-4xl">
  <h1 class="font-bold text-4xl"><%= @production.name %></h1>
  <h2 class="font-bold text-2xl pt-5">Audition sign-up form</h2>

  <% if @call_to_audition.header_text.present? %>
    <div class="pt-5">
      <%= @call_to_audition.header_text %>
    </div>
  <% end %>

  <%= form_with(model: @audition_request, url: handle_respond_to_call_to_audition_path(@call_to_audition.hex_code), method: :post, class: "contents", data: { turbo: false }) do |form| %>

    <% if @audition_request.errors.any? %>
      <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-lg mt-3">
        <h2><%= pluralize(@audition_request.errors.count, "error") %> prohibited this audition_request from being saved:</h2>

        <ul class="list-disc ml-6">
          <% @audition_request.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form.fields_for @person do |person_form| %>

      <div class="my-5">
        <% if @person.errors[:email].none? %>
          <%= person_form.label :email %>
        <% else %>
          <%= person_form.label :email, "Email is required", class: "text-red-500" %>
        <% end %>

        <%= person_form.text_field :email, class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": @person.errors[:email].none?, "border-red-400 focus:outline-red-600": @person.errors[:email].any?}] %>
      </div>

      <div class="my-5">
        <% if @person.errors[:email].none? %>
          <%= person_form.label :stage_name, "Stage Name" %>
        <% else %>
          <%= person_form.label :stage_name, "Stage Name is required", class: "text-red-500"  %>
        <% end %>
        <%= person_form.text_field :stage_name, class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": @person.errors[:stage_name].none?, "border-red-400 focus:outline-red-600": @person.errors[:stage_name].any?}] %>
      </div>

      <div class="my-5">
        <%= person_form.label :pronouns %>
        <span class="text-sm text-gray-500"> (optional)</span>
        <%= person_form.text_field :pronouns, class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": @person.errors[:pronouns].none?, "border-red-400 focus:outline-red-600": @person.errors[:pronouns].any?}] %>
      </div>

      <div class="my-5">
        <%= person_form.label :socials %>
        <span class="text-sm text-gray-500"> (optional)</span>
        <%= person_form.text_field :socials, class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": @person.errors[:socials].none?, "border-red-400 focus:outline-red-600": @person.errors[:socials].any?}] %>
      </div>

      <div class="my-5 md:flex md:w-full">
        <div class="md:mr-5 md:w-half">

          <%
            if @person.resume.attached?
              label_text = "Replace Resume/CV"
            else
              label_text = "Resume/CV"
            end
          %>
          <%= person_form.label :resume, label_text %>
          <div class="block shadow-sm rounded-lg border px-3 py-2 mt-2 w-half border-gray-400">
            <%= person_form.file_field :resume, class: "text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" %>
          </div>
        </div>
        <div class="my-5 md:my-0 md:ml-5 md:w-half">
          <%
            if @person.headshot.attached?
              label_text = "Replace Headshot"
            else
              label_text = "Headshot"
            end
          %>
          <%= person_form.label :headshot, label_text %>
          <div class="block shadow-sm rounded-lg border px-3 py-2 mt-2 w-half border-gray-400">
            <%= person_form.file_field :headshot, class: "text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" %>
          </div>
        </div>
      </div>
    <% end %>

  <% if @questions.any? %>
    <% @questions.each do |question| %>
      <div class="my-5">
        <label><%= question.text %>

        <% if question.question_type == "text" %>
          <%= text_area_tag "question[#{question.id}]", @answers[question.id], class: ["block shadow-sm rounded-lg border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": @person.errors[:socials].none?, "border-red-400 focus:outline-red-600": @person.errors[:socials].any?}] %>
        <% elsif question.question_type == "yesno" %>
          <div class="px-2 py-1 pt-2"><%= radio_button_tag "question[#{question.id}]", "yes", checked: (@answers[question.id] == "yes") %> Yes</div>
          <div class="px-2"><%= radio_button_tag "question[#{question.id}]", "no", checked: (@answers[question.id] == "no") %> No</div>
       <% end %>
      </div>
    <% end %>
  <% end %>

  <div class="inline pb-5">
    <%
      if @call_to_audition.new_record?
        submit_text = "Submit"
      else
        submit_text = "Update"
      end
    %>
    <%= form.submit submit_text, class: "w-full sm:w-auto rounded-lg px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer" %>
  </div>

  <% end %>

</div>
