<% content_for :title, "#{@production.name} - Visual Assets" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Visual Assets",
    links: []
  } %>

  <div class="w-full pt-4">
    <%= render partial: "shared/top_menu", locals: {
      breadcrumbs: [],
      text: "Logo",
      links: []
    } %>

    <% logo_variant = @production.safe_logo_variant(:small) %>
    <% if logo_variant %>
      <%= image_tag logo_variant, class: "h-auto" %>

      <% if current_user_can_manage?(@production) %>
        <div>
          <%= link_to "Replace logo", edit_logo_manage_production_visual_asset_path(@production, :logo), class: "text-pink-500 underline text-sm" %>
        </div>
      <% end %>
    <% else %>
      <span class="text-sm text-gray-500">
        No logo added.

        <% if current_user_can_manage?(@production) %>
          <%= link_to "Upload a logo", new_logo_manage_production_visual_assets_path(@production), class: "text-pink-500 underline" %>
        <% end %>
      </span>
    <% end %>
  </div>

  <div class="w-full pt-4">

    <%= render partial: "shared/top_menu", locals: {
      breadcrumbs: [],
      text: "Production/Season Posters",
      links: [
        { text: "Add a Poster", path: new_poster_manage_production_visual_assets_path(@production) }
      ]
    } %>

    <% if @production.posters.any? %>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 w-full">
        <% @production.posters.each do |poster| %>
          <div class="bg-white rounded shadow p-4 flex flex-col <%= 'ring-2 ring-pink-500' if poster.is_primary %>">
            <% image_variant = poster.safe_image_variant(:small) %>
            <% if image_variant %>
              <%= image_tag image_variant, class: "w-full h-auto object-cover mb-2" %>
            <% end %>
            
            <div class="flex items-center gap-2 mb-2">
              <span class="font-semibold flex-1"><%= poster.name.presence || "Untitled Poster" %></span>
              <% if poster.is_primary %>
                <span class="inline-flex items-center rounded-md bg-pink-50 px-2 py-1 text-xs font-medium text-pink-700 ring-1 ring-inset ring-pink-600/10">Primary</span>
              <% end %>
            </div>

            <% if current_user_can_manage?(@production) %>
              <div class="flex flex-wrap gap-2 mt-2">
                <% unless poster.is_primary %>
                  <%= link_to "Set as Primary",
                        set_primary_poster_manage_production_visual_asset_path(@production, poster),
                        data: { turbo_method: :patch },
                        class: "text-sm underline text-pink-500 hover:text-pink-600" %>
                <% end %>
                <%= link_to "Edit", edit_poster_manage_production_visual_asset_path(@production, poster), class: "text-sm underline text-pink-500 hover:text-pink-600" %>
                <%= link_to "Delete",
                      destroy_poster_manage_production_visual_asset_path(@production, poster),
                      data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this poster?" },
                      class: "text-sm underline text-pink-500 hover:text-pink-600" %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-gray-500 text-sm mt-2">
        No posters added.
        <% if current_user_can_manage?(@production) %>
          <%= link_to "Add a poster", new_poster_manage_production_visual_assets_path(@production), class: "text-pink-500 underline" %>
        <% end %>
      </div>
    <% end %>

  </div>

</div>
