<% content_for :title, "Registrations - #{@sign_up_form.name}" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Sign-ups", manage_production_sign_up_forms_path(@production)],
      [@sign_up_form.name, manage_production_sign_up_form_path(@production, @sign_up_form)]
    ],
    text: "Registrations",
    links: []
  } %>

  <!-- Navigation Tabs -->
  <div class="mb-6">
    <nav class="flex space-x-4 border-b border-gray-200">
      <%= link_to "Overview", manage_production_sign_up_form_path(@production, @sign_up_form), class: "px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" %>
      <%= link_to "Slots", slots_manage_production_sign_up_form_path(@production, @sign_up_form), class: "px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" %>
      <%= link_to "Questions", questions_manage_production_sign_up_form_path(@production, @sign_up_form), class: "px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" %>
      <%= link_to "Registrations", registrations_manage_production_sign_up_form_path(@production, @sign_up_form), class: "px-3 py-2 text-sm font-medium border-b-2 border-pink-500 text-pink-600" %>
    </nav>
  </div>

  <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
    <%= render "shared/card_header", title: "Registrations (#{@registrations.active.count})" %>
    <div class="divide-y divide-gray-200">
      <% if @registrations.any? %>
        <% current_slot = nil %>
        <% @registrations.each do |registration| %>
          <% if registration.sign_up_slot != current_slot %>
            <% current_slot = registration.sign_up_slot %>
            <div class="px-4 py-2 bg-gray-50 border-t border-gray-200">
              <span class="text-sm font-medium text-gray-700"><%= current_slot.display_name %></span>
              <span class="text-xs text-gray-500 ml-2">
                (<%= current_slot.active_registrations_count %>/<%= current_slot.capacity %> filled)
              </span>
            </div>
          <% end %>
          <div class="flex items-center justify-between px-4 py-3 hover:bg-gray-50">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-medium text-gray-600">
                <%= registration.display_initials %>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-900"><%= registration.display_name %></div>
                <div class="text-xs text-gray-500">
                  <% if registration.display_email.present? %>
                    <%= registration.display_email %> â€¢
                  <% end %>
                  Registered <%= time_ago_in_words(registration.registered_at) %> ago
                  <% if registration.guest? %>
                    <span class="ml-1 text-purple-600">(Guest)</span>
                  <% end %>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center rounded px-2 py-0.5 text-xs font-medium <%=
                case registration.status
                when 'confirmed' then 'bg-green-100 text-green-800'
                when 'waitlisted' then 'bg-yellow-100 text-yellow-800'
                when 'cancelled' then 'bg-red-100 text-red-800'
                end
              %>">
                <%= registration.status.capitalize %>
              </span>
              <% unless registration.cancelled? %>
                <%= link_to cancel_registration_manage_production_sign_up_form_path(@production, @sign_up_form, registration_id: registration.id),
                    method: :delete,
                    data: { turbo_confirm: "Cancel this registration?" },
                    class: "text-xs text-red-500 hover:text-red-700" do %>
                  Cancel
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="px-4 py-8 text-center text-gray-500">
          <p class="text-sm">No registrations yet.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
