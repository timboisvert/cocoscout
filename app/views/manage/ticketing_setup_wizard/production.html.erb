<%= render layout: "manage/ticketing_setup_wizard/wizard_layout", locals: { current_step: 1, step_name: "Production" } do %>
  <div class="text-center mb-6">
    <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <svg class="w-8 h-8 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
      </svg>
    </div>
    <h2 class="text-xl font-bold text-gray-900 coustard-regular">Which production needs ticketing?</h2>
    <p class="text-gray-600 mt-2">Select the production you want to set up for ticket sales.</p>
  </div>

  <%= form_with url: manage_ticketing_setup_wizard_save_production_path, method: :post, local: true do |form| %>
    <div class="space-y-3">
      <% if @production_being_edited %>
        <div class="p-4 bg-pink-50 border border-pink-200 rounded-lg">
          <label class="flex items-center gap-3 cursor-pointer">
            <input type="radio" name="production_id" value="<%= @production_being_edited.id %>" checked
                   class="h-4 w-4 text-pink-600 border-gray-300 focus:ring-pink-500 accent-pink-500">
            <div>
              <span class="font-medium text-gray-900"><%= @production_being_edited.name %></span>
              <span class="text-sm text-gray-500 ml-2">(editing existing setup)</span>
            </div>
          </label>
        </div>
      <% end %>

      <% if @available_productions.any? %>
        <% @available_productions.each do |production| %>
          <div class="p-4 border border-gray-200 rounded-lg hover:border-pink-300 transition-colors">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="production_id" value="<%= production.id %>"
                     <%= "checked" if @wizard_state[:production_id] == production.id %>
                     class="h-4 w-4 text-pink-600 border-gray-300 focus:ring-pink-500 accent-pink-500">
              <div class="flex-1">
                <span class="font-medium text-gray-900"><%= production.name %></span>
                <div class="text-sm text-gray-500">
                  <%= pluralize(production.shows.count, "show") %>
                  <% next_show = production.shows.select { |s| s.date_and_time >= Time.current }.min_by(&:date_and_time) %>
                  <% if next_show %>
                    â€¢ Next: <%= next_show.date_and_time.strftime("%b %d") %>
                  <% end %>
                </div>
              </div>
            </label>
          </div>
        <% end %>
      <% else %>
        <div class="text-center py-8 text-gray-500">
          <p>All your productions already have ticketing set up.</p>
          <p class="mt-2">
            <%= link_to "View existing setups", manage_ticketing_index_path, class: "text-pink-600 hover:text-pink-800" %>
            or
            <%= link_to "create a new production", manage_productions_wizard_path, class: "text-pink-600 hover:text-pink-800" %>
          </p>
        </div>
      <% end %>
    </div>

    <% if @available_productions.any? || @production_being_edited %>
      <div class="mt-8 flex justify-end">
        <%= render "shared/button", text: "Next", variant: "primary", size: "medium", type: :submit %>
      </div>
    <% end %>
  <% end %>
<% end %>
