<% content_for :title, "Money - #{@production.name}" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice, alert: alert } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "Money",
    links: []
  } %>

  <%# Profitability Summary %>
  <%= render partial: "manage/payouts/profitability_summary", locals: {
    summary: @financial_summary,
    selected_period: @selected_period,
    production: @production
  } %>

  <%# Payout Stats Cards %>
  <div class="mb-8 pt-6 border-t border-gray-200">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Payouts</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white rounded-lg border border-gray-200 p-5">
        <div class="text-sm text-gray-500 mb-1">Awaiting Calculation</div>
        <div class="text-2xl font-semibold text-pink-600"><%= @needs_calculation_count %> shows</div>
        <div class="text-xs text-gray-500">need financial data or calculation</div>
      </div>
      <div class="bg-white rounded-lg border border-gray-200 p-5">
        <div class="text-sm text-gray-500 mb-1">Awaiting Payout</div>
        <div class="text-2xl font-semibold text-pink-600"><%= number_to_currency(@total_awaiting_payout) %></div>
        <div class="text-xs text-gray-500"><%= @awaiting_payout_count %> shows · <%= @awaiting_payout_people_count %> people</div>
      </div>
      <div class="bg-white rounded-lg border border-gray-200 p-5">
        <div class="text-sm text-gray-500 mb-1">Paid Out</div>
        <div class="text-2xl font-semibold text-pink-600"><%= number_to_currency(@total_paid) %></div>
        <div class="text-xs text-gray-500"><%= @paid_shows_count %> shows · <%= @paid_people_count %> people</div>
      </div>
    </div>
  </div>

  <%# Shows & Events List with Filters %>
  <div class="mb-8 pt-6 border-t border-gray-200" data-controller="money-filter">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold text-gray-900">Shows & Events</h2>
      <%# Toggle for hiding non-revenue events %>
      <label class="flex items-center gap-2 cursor-pointer">
        <span class="text-sm text-gray-600">Hide non-revenue events</span>
        <button type="button"
                data-money-filter-target="toggle"
                data-action="click->money-filter#toggle"
                class="relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-pink-600 focus:ring-offset-2 bg-pink-600"
                role="switch"
                aria-checked="true">
          <span data-toggle-dot class="pointer-events-none inline-block h-5 w-5 translate-x-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"></span>
        </button>
      </label>
    </div>

    <%# Filter Bar %>
    <%= render "shared/filters/filter_bar", filter_groups: [
      {
        label: "Status",
        filters: [
          { text: "All", path: manage_production_money_index_path(@production, filter: "all", period: @selected_period), active: @filter == "all" },
          { text: "Awaiting Financials", path: manage_production_money_index_path(@production, filter: "awaiting_financials", period: @selected_period), active: @filter == "awaiting_financials" },
          { text: "Awaiting Calculation", path: manage_production_money_index_path(@production, filter: "awaiting_calculation", period: @selected_period), active: @filter == "awaiting_calculation" },
          { text: "Awaiting Payout", path: manage_production_money_index_path(@production, filter: "awaiting_payout", period: @selected_period), active: @filter == "awaiting_payout" },
          { text: "Paid", path: manage_production_money_index_path(@production, filter: "paid", period: @selected_period), active: @filter == "paid" }
        ]
      }
    ] %>

    <% if @shows.any? %>
      <div class="space-y-2">
        <% @shows.each do |show| %>
          <%= render partial: "manage/payouts/money_show_row", locals: { show: show, production: @production, hide_non_revenue: true } %>
        <% end %>
      </div>
    <% else %>
      <div class="bg-gray-50 rounded-lg border border-dashed border-gray-300 p-8 text-center">
        <p class="text-gray-600">
          <% if @filter == "all" %>
            No past shows yet. Shows & events will appear here after they occur.
          <% elsif @filter == "awaiting_financials" %>
            All revenue events have financial data entered.
          <% elsif @filter == "awaiting_calculation" %>
            No shows awaiting calculation.
          <% elsif @filter == "awaiting_payout" %>
            No shows awaiting payout.
          <% elsif @filter == "paid" %>
            No paid shows yet.
          <% else %>
            No shows with this status.
          <% end %>
        </p>
      </div>
    <% end %>
  </div>
</div>
