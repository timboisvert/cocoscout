<% content_for :title, "God Mode" %>

<div class="w-full">

  <%= render partial: "shared/notice", locals: { notice: notice } %>

  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [],
    text: "God Mode",
    links: []
  } %>

  <div class="flex flex-col md:flex-row gap-2 mt-4">

    <div class="flex-1">
      <div class="sticky top-4 border border-gray-200 rounded-lg overflow-hidden">
        <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
            <h3 class="text-md font-semibold text-gray-900 coustard-regular">Impersonate</h3>
        </div>
        <div class="p-4">

          <%= form_with url: impersonate_user_path, method: :post, local: true, class: "flex items-center space-x-2" do |f| %>
            <%= f.email_field :email, required: true, autocapitalize: "none", class: "inline-block shadow-sm rounded-lg border px-3 py-2 w-96 border-gray-400" %>
            <%= f.submit "Impersonate", class: "sm:w-auto rounded-lg px-3.5 py-2.5 text-white bg-pink-500 hover:bg-pink-600 inline-block font-medium cursor-pointer" %>
          <% end %>

          <% if @recent_impersonations.any? %>
            <h1 class="text-sm font-medium mt-4 mb-1">Recent Impersonations:</h1>
            <div class="grid grid-cols-1 gap-2">
              <% @recent_impersonations.each do |recent| %>
                <div class="p-2 border border-gray-200 rounded-lg hover:border-gray-400 transition-all items-top">
                  <%= button_to impersonate_user_path, method: :post, params: { email: recent["email"] }, class: "w-full text-left cursor-pointer" do %>
                    <div class="font-bold text-pink-500"><%= recent["name"] %></div>
                    <div class="text-sm text-gray-500"><%= recent["email"] %></div>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% end %>

          <% if session[:impersonate_user_id] %>
            <div class="my-4">
              <%= button_to "Stop Impersonating", stop_impersonating_user_path, method: :post, class: "px-3 py-1 rounded bg-gray-500 text-white" %>
            </div>
          <% end %>

        </div>
      </div>
    </div>

    <div class="flex-1 sticky top-4 border border-gray-200 rounded-lg overflow-hidden">
      <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-md font-semibold text-gray-900 coustard-regular">Change Email Address</h3>
      </div>
      <div class="p-4">
        <p class="text-xs text-gray-500">This will update the user's email_address and their person's email to the new address.</p>
        <%= form_with url: change_email_user_path, method: :post, local: true, class: "space-y-3 mt-2" do |f| %>
          <div>
            <%= f.label :old_email, "Current Email Address", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.email_field :old_email, required: true, autocapitalize: "none", class: "block shadow-sm rounded-lg border px-3 py-2 w-full border-gray-400" %>
          </div>
          <div>
            <%= f.label :new_email, "New Email Address", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.email_field :new_email, required: true, autocapitalize: "none", class: "block shadow-sm rounded-lg border px-3 py-2 w-full border-gray-400" %>
          </div>
          <%= f.submit "Change Email", class: "rounded-lg px-3.5 py-2.5 text-white bg-pink-500 hover:bg-pink-600 font-medium cursor-pointer" %>
        <% end %>
      </div>
    </div>


</div>