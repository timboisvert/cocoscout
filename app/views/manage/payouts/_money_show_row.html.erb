<%#
  Money Show Row - Four Panel Layout

  Required:
    - show: Show object
    - production: Production object

  Panels:
    1-2. Date/Time box + Show info (left half) -> links to show detail
    3. Financials summary with indicator -> links to edit financials
    4. Payout status and progress -> links to payout detail
%>

<%
  financials = show.show_financials
  payout = show.show_payout
  has_data = financials&.has_data?
  is_revenue_event = show.revenue_event?

  # Determine actionable status
  if payout
    status = payout.actionable_status
    status_label = payout.actionable_status_label
    status_class = payout.actionable_status_badge_class
  elsif has_data
    status = "ready_to_calculate"
    status_label = "Ready to Calculate"
    status_class = "bg-blue-100 text-blue-700"
  else
    status = "needs_financials"
    status_label = "Needs Financial Data"
    status_class = "bg-amber-100 text-amber-700"
  end
%>

<div class="bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all <%= is_revenue_event ? '' : 'opacity-60' %>">
  <div class="flex flex-col lg:flex-row">

    <%# Panel 1 & 2: Show Info (left half) %>
    <%= link_to manage_production_show_path(production, show), class: "flex-1 flex items-center gap-4 px-4 py-3 hover:bg-gray-50 transition-colors rounded-t-lg lg:rounded-l-lg lg:rounded-tr-none" do %>
      <%# Date Box %>
      <div class="flex-shrink-0 w-14 text-center">
        <div class="text-xs font-semibold text-pink-600 uppercase"><%= show.date_and_time.strftime("%b") %></div>
        <div class="text-2xl font-bold text-gray-900"><%= show.date_and_time.strftime("%-d") %></div>
        <div class="text-xs text-gray-500"><%= show.date_and_time.strftime("%a") %></div>
      </div>

      <%# Show Details %>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 flex-wrap">
          <span class="font-medium text-gray-900">
            <%= show.secondary_name.presence || show.event_type.titleize %>
          </span>
          <% unless is_revenue_event %>
            <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-500">
              Non-revenue
            </span>
          <% end %>
        </div>
        <div class="text-sm text-gray-600">
          <%= show.date_and_time.strftime("%l:%M %p").strip %>
          <% if show.location.present? %>
            &middot; <%= show.location.name %>
          <% elsif show.is_online %>
            &middot; Online
          <% end %>
        </div>
      </div>
    <% end %>

    <%# Panel 3: Financials %>
    <%= link_to manage_production_edit_financials_money_show_payout_path(production, show), class: "w-full lg:w-1/4 px-4 py-3 border-t lg:border-t-0 lg:border-l border-gray-200 hover:bg-gray-50 transition-colors" do %>
      <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Financials</div>
      <% if has_data && is_revenue_event %>
        <div class="text-sm font-medium text-gray-900">
          <%= number_to_currency(financials.total_revenue) %> revenue
        </div>
        <% if financials.calculated_expenses > 0 %>
          <div class="text-xs text-gray-500">
            <%= number_to_currency(financials.calculated_expenses) %> expenses
          </div>
        <% end %>
      <% elsif is_revenue_event %>
        <div class="flex items-center gap-1 text-amber-600">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs font-medium">Enter data</span>
        </div>
      <% else %>
        <div class="text-xs text-gray-400">N/A</div>
      <% end %>
    <% end %>

    <%# Panel 4: Payout Status %>
    <%= link_to manage_production_money_show_payout_path(production, show), class: "w-full lg:w-1/4 px-4 py-3 border-t lg:border-t-0 lg:border-l border-gray-200 hover:bg-gray-50 transition-colors rounded-b-lg lg:rounded-r-lg lg:rounded-bl-none" do %>
      <div class="text-[10px] text-gray-400 uppercase tracking-wide mb-1">Payout</div>
      <% if is_revenue_event %>
        <div class="flex items-center justify-between gap-2">
          <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium <%= status_class %>">
            <%= status_label %>
          </span>
          <% if payout&.total_payout && payout.total_payout > 0 %>
            <span class="text-sm font-semibold text-gray-900"><%= number_to_currency(payout.total_payout) %></span>
          <% end %>
        </div>
      <% else %>
        <div class="text-xs text-gray-400">N/A</div>
      <% end %>
    <% end %>

  </div>
</div>
