<% content_for :title, "Review - Auditions" %>

<div class="w-full mb-10">
  <%= render partial: "shared/notice", locals: { notice: notice } %>
  <%= render partial: "shared/top_menu", locals: {
    breadcrumbs: [
      ["Auditions", manage_production_auditions_path(@production)]
    ],
    text: "Review",
    links: []
  } %>

  <%= render partial: "lifecycle_panel", locals: { current_step: :review } %>

  <%= render partial: "archived_banner" %>

  <% if @call_to_audition.blank? %>
    <div class="mb-5 text-gray-500 text-sm">
      You aren't currently offering auditions for <%= @production.name %>
    </div>
  <% else %>
    <% call_to_audition = @call_to_audition %>

    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden mb-6">
      <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
        <h3 class="text-md font-semibold text-gray-900 coustard-regular">Sign-ups</h3>
      </div>
      <div class="p-6">
        <p class="text-sm text-gray-500 mb-6">Review and decide on each auditionee's application.</p>

      <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-6">
        <%= link_to manage_production_call_to_audition_audition_requests_path(@production, call_to_audition, filter: :unreviewed) do %>
          <div class="p-4 bg-white border border-gray-200 rounded-lg hover:border-gray-400 transition-all min-h-24">
            <p class="font-bold text-5xl text-center"><%= call_to_audition.counts[:unreviewed] %></p>
            <p class="text-xs text-center">Unreviewed</p>
          </div>
        <% end %>
        <%= link_to manage_production_call_to_audition_audition_requests_path(@production, call_to_audition, filter: :undecided) do %>
          <div class="p-4 bg-white border border-gray-200 rounded-lg hover:border-gray-400 transition-all min-h-24">
            <p class="font-bold text-5xl text-center"><%= call_to_audition.counts[:undecided] %></p>
            <p class="text-xs text-center">Revisit</p>
          </div>
        <% end %>
        <%= link_to manage_production_call_to_audition_audition_requests_path(@production, call_to_audition, filter: :accepted) do %>
          <div class="p-4 bg-white border border-gray-200 rounded-lg hover:border-gray-400 transition-all min-h-24">
            <p class="font-bold text-5xl text-center"><%= call_to_audition.counts[:accepted] %></p>
            <p class="text-xs text-center">Yes</p>
          </div>
        <% end %>
        <%= link_to manage_production_call_to_audition_audition_requests_path(@production, call_to_audition, filter: :passed) do %>
          <div class="p-4 bg-white border border-gray-200 rounded-lg hover:border-gray-400 transition-all min-h-24">
            <p class="font-bold text-5xl text-center"><%= call_to_audition.counts[:passed] %></p>
            <p class="text-xs text-center">No</p>
          </div>
        <% end %>
      </div>

      <%= render partial: "shared/link_button", locals: {text: "View all Sign-ups", path: manage_production_call_to_audition_audition_requests_path(@production, call_to_audition, filter: :all)} %>
      </div>
    </div>

    <% if call_to_audition.audition_type == "in_person" %>
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
      <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
        <h3 class="text-md font-semibold text-gray-900 coustard-regular">Schedule Auditions</h3>
      </div>
      <div class="p-6">
        <p class="text-sm text-gray-500 mb-6">Assign people to audition sessions.</p>

        <% if @call_to_audition.audition_sessions.any? %>
          <div class="space-y-2">
            <% @call_to_audition.audition_sessions.order(:start_at).each do |session| %>
              <div class="border border-gray-200 rounded-lg p-4 flex items-start gap-6">
                <!-- Date/Time on the left -->
                <div class="w-72 flex-shrink-0">
                  <p class="text-sm font-semibold text-gray-900"><%= session.start_at.strftime("%A, %b %-d, %Y at %-l:%M %p") %></p>
                  <% if session.location.present? %>
                    <div class="mt-2">
                      <span class="inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset bg-gray-50 text-gray-700 ring-gray-600/10">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" /></svg>
                        <%= session.location.name %>
                      </span>
                    </div>
                  <% end %>
                </div>

                <!-- People list on the right -->
                <div class="flex-1">
                  <% if session.auditions.any? %>
                    <div class="grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-10 gap-2">
                      <% session.auditions.each do |audition| %>
                        <div class="flex flex-col items-center text-center">
                          <% headshot_variant = audition.person.safe_headshot_variant(:thumb) %>
                          <% if headshot_variant %>
                            <%= image_tag headshot_variant, alt: audition.person.name, class: "w-10 h-10 rounded-lg object-cover mb-1" %>
                          <% else %>
                            <div class="w-10 h-10 rounded-lg bg-pink-100 flex items-center justify-center mb-1 text-pink-600 font-bold text-xs">
                              <%= audition.person.initials %>
                            </div>
                          <% end %>
                          <span class="text-xs text-gray-700 font-medium text-center"><%= audition.person.name.truncate(10, omission: '...') %></span>
                        </div>
                      <% end %>
                    </div>
                  <% else %>
                    <p class="text-gray-500 text-sm">No auditions scheduled</p>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>

          <div class="mt-4">
            <%= render partial: "shared/link_button", locals: {text: "Schedule Auditions", path: schedule_auditions_manage_production_call_to_audition_path(@production, @call_to_audition)} %>
          </div>
        <% else %>
          <p class="text-gray-500 text-sm mb-4">No audition sessions have been scheduled yet.</p>
          <%= render partial: "shared/link_button", locals: {text: "Schedule Auditions", path: manage_production_call_to_audition_audition_sessions_path(@production, @call_to_audition)} %>
        <% end %>
      </div>
    </div>
    <% end %>

    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden mt-6">
      <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
        <% if call_to_audition.audition_type == "video_upload" %>
          <h3 class="text-md font-semibold text-gray-900 coustard-regular">Finalize Audition Review and Notify</h3>
        <% else %>
          <h3 class="text-md font-semibold text-gray-900 coustard-regular">Finalize Audition Plans and Notify</h3>
        <% end %>
      </div>
      <div class="p-6">
        <% if call_to_audition.audition_type == "video_upload" %>
          <p class="text-sm text-gray-500 mb-4">Send notification emails to all applicants about their audition status.</p>
        <% else %>
          <p class="text-sm text-gray-500 mb-4">Send notification emails to all applicants about their audition status and schedule.</p>
        <% end %>

        <% # Get all audition requests %>
        <% audition_requests = call_to_audition.audition_requests.includes(:person) %>
        <% accepted_requests = audition_requests.where(status: :accepted) %>
        <% not_accepted_requests = audition_requests.where.not(status: :accepted) %>

        <% # Get all scheduled person IDs for this call to audition %>
        <% scheduled_person_ids = call_to_audition.audition_sessions.joins(:auditions).pluck('auditions.person_id').uniq %>

        <% # Load email assignments for all people %>
        <% email_assignments = call_to_audition.audition_email_assignments.where(person_id: audition_requests.map(&:person_id)).index_by(&:person_id) %>
        <% # Load custom email groups %>
        <% custom_groups = call_to_audition.email_groups.where(group_type: 'invitation').order(:created_at) %>

        <% if call_to_audition.finalize_audition_invitations %>
          <%# Finalized state - show notice and require button click to edit %>
          <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0">
                <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="flex-1">
                <h4 class="text-sm font-semibold text-green-900 mb-1">Audition Invitations Finalized</h4>
                <p class="text-sm text-green-800 mb-3">
                  Notification emails have been sent and applicants can now see their invitation status. To make changes and send additional notifications, click the button below.
                </p>
                <button
                  type="button"
                  onclick="this.parentElement.parentElement.parentElement.style.display='none'; document.getElementById('invitation-editing-area').style.display='block';"
                  class="font-medium rounded-lg text-sm px-4 py-2 text-center text-white bg-green-600 hover:bg-green-700 transition cursor-pointer"
                >
                  Edit Invitations & Send More Notifications
                </button>
              </div>
            </div>
          </div>
          <div id="invitation-editing-area" style="display: none;">
        <% end %>

        <% if accepted_requests.any? || not_accepted_requests.any? %>
          <div data-controller="email-groups tabs" data-email-groups-production-id-value="<%= @production.id %>" data-email-groups-call-to-audition-id-value="<%= call_to_audition.id %>" data-email-groups-group-type-value="invitation">

            <nav class="flex flex-wrap gap-2 border-b border-gray-200 mb-4">
              <% # Helper method to get email group ID for a person %>
              <% get_email_group_id = lambda do |person|
                assignment = email_assignments[person.id]
                if assignment&.email_group_id.present?
                  assignment.email_group_id
                else
                  # Default group: people are in "Invited to Audition" ONLY if they're currently scheduled
                  # Otherwise they go to "Not Invited" even if their request status is "accepted"
                  if scheduled_person_ids.include?(person.id)
                    "invitation_accepted"
                  else
                    "invitation_not_accepted"
                  end
                end
              end %>
              <% # Group all applicants by their email group %>
              <% people_by_group = audition_requests.map(&:person).group_by(&get_email_group_id) %>

              <%# Tab for accepted invitations %>
              <% accepted_group_people = people_by_group["invitation_accepted"] || [] %>
              <button
                type="button"
                data-tabs-target="tab"
                data-index="0"
                data-group-tab
                data-group-id="invitation_accepted"
                data-action="tabs#select email-groups#selectGroup"
                class="px-3 lg:px-4 py-2 text-xs lg:text-sm font-medium bg-white border-b-2 text-pink-600 border-pink-600 cursor-pointer whitespace-nowrap hover:text-pink-600 flex items-center gap-2"
              >
                <svg class="hidden w-5 h-5 text-pink-600" data-email-groups-target="tabIndicator" data-tab-group-id="invitation_accepted" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
                </svg>
                <span>Invited to Audition (<%= accepted_group_people.size %>)</span>
              </button>

              <%# Tab for not accepted %>
              <% not_accepted_group_people = people_by_group["invitation_not_accepted"] || [] %>
              <button
                type="button"
                data-tabs-target="tab"
                data-index="1"
                data-group-tab
                data-group-id="invitation_not_accepted"
                data-action="tabs#select email-groups#selectGroup"
                class="px-3 lg:px-4 py-2 text-xs lg:text-sm font-medium bg-white border-b-2 text-gray-500 bg-gray-50 border-transparent cursor-pointer whitespace-nowrap hover:text-pink-600 flex items-center gap-2"
              >
                <svg class="hidden w-5 h-5 text-pink-600" data-email-groups-target="tabIndicator" data-tab-group-id="invitation_not_accepted" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
                </svg>
                <span>Not Invited (<%= not_accepted_group_people.size %>)</span>
              </button>

              <%# Custom email group tabs %>
              <% custom_groups.each_with_index do |custom_group, idx| %>
                <% group_people = people_by_group[custom_group.group_id] || [] %>
                <button
                  type="button"
                  data-tabs-target="tab"
                  data-index="<%= 2 + idx %>"
                  data-group-tab
                  data-group-id="<%= custom_group.group_id %>"
                  data-action="tabs#select email-groups#selectGroup"
                  class="px-3 lg:px-4 py-2 text-xs lg:text-sm font-medium bg-white border-b-2 text-gray-500 bg-gray-50 border-transparent cursor-pointer whitespace-nowrap hover:text-pink-600 flex items-center gap-2"
                >
                  <svg class="hidden w-5 h-5 text-pink-600" data-email-groups-target="tabIndicator" data-tab-group-id="<%= custom_group.group_id %>" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
                  </svg>
                  <span><%= custom_group.name %> (<%= group_people.size %>)</span>
                </button>
              <% end %>

              <%# Add button for creating new email group %>
              <button
                type="button"
                data-action="click->email-groups#createNewGroup"
                class="px-3 lg:px-4 py-2 text-xs lg:text-sm font-medium bg-white border-b-2 border-transparent text-gray-400 hover:text-pink-600 cursor-pointer whitespace-nowrap"
              >
                + New Email Group
              </button>
            </nav>

            <div class="space-y-4">
              <%# Panel for accepted invitations %>
              <div data-tabs-target="panel" data-group-panel data-group-id="invitation_accepted">
                <div class="mb-4">
                  <h5 class="text-sm font-semibold text-gray-900 mb-3">People being invited to audition:</h5>
                  <div class="flex flex-wrap gap-2">
                    <% if accepted_group_people.any? %>
                      <% accepted_group_people.each do |person| %>
                        <% assignment = email_assignments[person.id] %>
                        <% request = audition_requests.find { |r| r.person_id == person.id } %>
                        <% original_group = request&.status == 'accepted' ? 'invitation_accepted' : 'invitation_not_accepted' %>
                        <div
                          class="inline-flex items-center gap-2 px-2 py-1 rounded text-xs font-medium border border-gray-200 hover:border-pink-400 cursor-pointer transition-all"
                          data-person-id="<%= person.id %>"
                          data-email-assignment-id="<%= assignment&.id || '' %>"
                          data-original-group="<%= original_group %>"
                          data-action="click->email-groups#showPopup"
                        >
                          <% headshot_variant = person.safe_headshot_variant(:thumb) %>
                          <% if headshot_variant %>
                            <%= image_tag headshot_variant, alt: person.name, class: "w-5 h-5 rounded object-cover flex-shrink-0", draggable: false %>
                          <% else %>
                            <div class="w-5 h-5 rounded bg-gray-200 flex items-center justify-center text-black font-bold text-xs flex-shrink-0">
                              <%= person.initials %>
                            </div>
                          <% end %>
                          <span><%= person.name %></span>
                        </div>
                      <% end %>
                    <% else %>
                      <p class="text-sm text-gray-500 italic">No people in this group yet.</p>
                    <% end %>
                  </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-900 mb-2">Notification Email</label>
                    <textarea
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                      rows="6"
                    >Dear [Name],

Congratulations! You've been invited to audition for <%= @production.name %>.

<% if call_to_audition.audition_type == "video_upload" %>Your audition materials have been received and are under review. We'll notify you once decisions have been made.<% else %>Your audition is scheduled for [Date and Time] at [Location]. Please arrive 10 minutes early.

You can view your full audition details on your Auditions page.<% end %>

We look forward to seeing you!

Best regards,
The <%= @production.name %> Team</textarea>
                  </div>

                  <% if accepted_group_people.any? %>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                      <label class="flex items-center gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          data-email-groups-target="reviewCheckbox"
                          data-checkbox-group-id="invitation_accepted"
                          data-action="change->email-groups#checkAllReviewed"
                          class="rounded accent-pink-500 border-gray-300 text-pink-600 focus:ring-pink-500"
                        >
                        <span class="text-sm text-gray-700">I have reviewed the recipient list and email text for this group</span>
                      </label>
                    </div>
                  <% end %>
                </div>

              <%# Panel for not accepted %>
              <div data-tabs-target="panel" data-group-panel data-group-id="invitation_not_accepted" class="hidden">
                <div class="mb-4">
                  <h5 class="text-sm font-semibold text-gray-900 mb-3">People not being invited to audition:</h5>
                  <div class="flex flex-wrap gap-2">
                    <% if not_accepted_group_people.any? %>
                      <% not_accepted_group_people.each do |person| %>
                        <% assignment = email_assignments[person.id] %>
                        <% request = audition_requests.find { |r| r.person_id == person.id } %>
                        <% original_group = request&.status == 'accepted' ? 'invitation_accepted' : 'invitation_not_accepted' %>
                        <div
                          class="inline-flex items-center gap-2 px-2 py-1 rounded text-xs font-medium border border-gray-200 hover:border-pink-400 cursor-pointer transition-all"
                          data-person-id="<%= person.id %>"
                          data-email-assignment-id="<%= assignment&.id || '' %>"
                          data-original-group="<%= original_group %>"
                          data-action="click->email-groups#showPopup"
                        >
                          <% headshot_variant = person.safe_headshot_variant(:thumb) %>
                          <% if headshot_variant %>
                            <%= image_tag headshot_variant, alt: person.name, class: "w-5 h-5 rounded object-cover flex-shrink-0", draggable: false %>
                          <% else %>
                            <div class="w-5 h-5 rounded bg-gray-200 flex items-center justify-center text-black font-bold text-xs flex-shrink-0">
                              <%= person.initials %>
                            </div>
                          <% end %>
                          <%= person.name %>
                        </div>
                      <% end %>
                    <% else %>
                      <p class="text-sm text-gray-500 italic">No people in this group yet.</p>
                    <% end %>
                  </div>
                </div>

                  <div>
                    <label class="block text-sm font-semibold text-gray-900 mb-2">Notification Email</label>
                    <textarea
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                      rows="6"
                    >Dear [Name],

Thank you so much for your interest in <%= @production.name %>. We truly appreciate you taking the time to apply.

Unfortunately, we won't be able to offer you an audition for this production at this time. We received many qualified applicants and had to make some difficult decisions.

We encourage you to apply for future productions and wish you all the best in your performing arts journey.

Best regards,
The <%= @production.name %> Team</textarea>
                  </div>

                  <% if not_accepted_group_people.any? %>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                      <label class="flex items-center gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          data-email-groups-target="reviewCheckbox"
                          data-checkbox-group-id="invitation_not_accepted"
                          data-action="change->email-groups#checkAllReviewed"
                          class="rounded accent-pink-500 border-gray-300 text-pink-600 focus:ring-pink-500"
                        >
                        <span class="text-sm text-gray-700">I have reviewed the recipient list and email text for this group</span>
                      </label>
                    </div>
                  <% end %>
                </div>

              <%# Custom email group panels %>
              <% custom_groups.each do |custom_group| %>
                <% group_people = people_by_group[custom_group.group_id] || [] %>
                <div data-tabs-target="panel" data-group-panel data-group-id="<%= custom_group.group_id %>" class="hidden">
                  <div class="mb-4">
                    <h5 class="text-sm font-semibold text-gray-900 mb-3">People in this email group:</h5>
                    <div class="flex flex-wrap gap-2">
                      <% if group_people.any? %>
                        <% group_people.each do |person| %>
                          <% assignment = email_assignments[person.id] %>
                          <% request = audition_requests.find { |r| r.person_id == person.id } %>
                          <% original_group = request&.status == 'accepted' ? 'invitation_accepted' : 'invitation_not_accepted' %>
                          <div
                            class="inline-flex items-center gap-2 px-2 py-1 rounded text-xs font-medium border border-gray-200 hover:border-pink-400 cursor-pointer transition-all"
                            data-person-id="<%= person.id %>"
                            data-email-assignment-id="<%= assignment&.id || '' %>"
                            data-original-group="<%= original_group %>"
                            data-action="click->email-groups#showPopup"
                          >
                            <% headshot_variant = person.safe_headshot_variant(:thumb) %>
                            <% if headshot_variant %>
                              <%= image_tag headshot_variant, alt: person.name, class: "w-5 h-5 rounded object-cover flex-shrink-0", draggable: false %>
                            <% else %>
                              <div class="w-5 h-5 rounded bg-gray-200 flex items-center justify-center text-black font-bold text-xs flex-shrink-0">
                                <%= person.initials %>
                              </div>
                            <% end %>
                            <span><%= person.name %></span>
                          </div>
                        <% end %>
                      <% else %>
                        <p class="text-sm text-gray-500 italic">No people in this group yet. Click on people in other groups to move them here.</p>
                      <% end %>
                    </div>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold text-gray-900 mb-2">Notification Email</label>
                    <textarea
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                      rows="6"
                      placeholder="Type your custom email message here..."
                    ><%= custom_group.email_template %></textarea>
                  </div>

                  <% if group_people.empty? %>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                      <button
                        type="button"
                        data-action="click->email-groups#deleteGroup"
                        data-group-id="<%= custom_group.id %>"
                        class="bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition-colors text-sm font-medium"
                      >
                        Delete this empty email group
                      </button>
                    </div>
                  <% else %>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                      <label class="flex items-center gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          data-email-groups-target="reviewCheckbox"
                          data-checkbox-group-id="<%= custom_group.group_id %>"
                          data-action="change->email-groups#checkAllReviewed"
                          class="rounded accent-pink-500 border-gray-300 text-pink-600 focus:ring-pink-500"
                        >
                        <span class="text-sm text-gray-700">I have reviewed the recipient list and email text for this group</span>
                      </label>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>

            <%# Send notifications section (shown when all groups are reviewed) %>
            <div
              data-email-groups-target="sendSection"
              class="hidden mt-6 p-4 bg-pink-50 border border-pink-200 rounded-lg"
            >
              <h4 class="text-sm font-semibold text-gray-900 mb-2">Ready to Send Notifications and Reveal Decisions</h4>
              <p class="text-sm text-gray-700 mb-4">
                All email groups have been reviewed. Click the button below to send notification emails to all applicants about their audition status.
              </p>
              <button
                type="button"
                data-action="click->email-groups#sendNotifications"
                data-email-groups-notification-type-value="invitation"
                class="font-medium rounded-lg text-sm px-5 py-2.5 text-center text-white bg-pink-500 hover:bg-pink-600 inline-block cursor-pointer transition"
              >
                Send Audition Invitation Notifications
              </button>
            </div>
          </div>
        <% end %>

        <% if call_to_audition.finalize_audition_invitations %>
          </div> <%# Close invitation-editing-area %>
        <% end %>
      </div>
    </div>

  <% end %>
</div>
