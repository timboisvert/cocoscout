<% content_for :title, @production.name %>

<div class="w-full bg-gradient-to-b from-gray-50 to-white min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">

    <%# Hero Section with Poster or Logo %>
    <% primary_poster = @production.primary_poster %>
    <% has_poster = primary_poster&.image&.attached? %>
    <% has_logo = @production.logo.attached? %>
    <% has_image = has_poster || has_logo %>

    <% if has_image %>
      <%# With Image: Left-Right Layout %>
      <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6">
        <div class="relative">
          <%# Background Pattern %>
          <div class="absolute inset-0 bg-gradient-to-br from-pink-50 via-white to-purple-50 opacity-50"></div>

          <div class="relative flex flex-col sm:flex-row items-stretch">
            <%# Primary Poster or Logo - Left Side %>
            <div class="flex-shrink-0 w-full sm:w-48 md:w-64">
              <% if has_poster %>
                <% poster_variant = primary_poster.safe_image_variant(:small) %>
                <% if poster_variant %>
                  <%= image_tag poster_variant, class: "w-full h-full object-cover", alt: @production.name %>
                <% end %>
              <% elsif has_logo %>
                <% logo_variant = @production.safe_logo_variant(:small) %>
                <% if logo_variant %>
                  <%= image_tag logo_variant, class: "w-full h-full object-contain p-4", alt: @production.name %>
                <% end %>
              <% end %>
            </div>

            <%# Name - Right Side %>
            <div class="flex-1 p-6 sm:p-8 flex items-center">
              <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-gray-900 inter-bold leading-tight"><%= @production.name %></h1>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <%# No Image: Simple Header %>
      <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6 p-6 sm:p-8">
        <div class="flex items-center gap-4">
          <%# Initials Placeholder %>
          <div class="w-16 h-16 rounded-lg bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center flex-shrink-0">
            <span class="text-2xl font-bold text-white"><%= @production.initials %></span>
          </div>
          <div>
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-gray-900 inter-bold leading-tight"><%= @production.name %></h1>
          </div>
        </div>
      </div>
    <% end %>

    <%# Description Section %>
    <% if @production.description.present? %>
      <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6 p-6 sm:p-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-3">About</h2>
        <p class="text-gray-700 leading-relaxed"><%= @production.description %></p>
      </div>
    <% end %>

    <%# Cast Members Section (People and Groups) %>
    <% if @cast_members.present? %>
      <% cast_cache_key = ["production_cast_v2", @production.id, @production.talent_pools.maximum(:updated_at), @cast_members.map(&:updated_at).max] %>
      <% cache cast_cache_key do %>
        <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-900">Cast</h2>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3">
              <% @cast_members.each do |member| %>
                <% has_public_profile = member.public_profile_enabled? && member.public_key.present? %>
                <% if has_public_profile %>
                  <%= link_to public_profile_path(member.public_key), class: "group text-center" do %>
                    <div class="aspect-square rounded-lg overflow-hidden bg-gray-100 mb-2">
                      <% if member.primary_headshot&.image&.attached? %>
                        <% headshot_variant = member.primary_headshot.safe_image_variant(:small) %>
                        <% if headshot_variant %>
                          <%= image_tag headshot_variant, class: "w-full h-full object-cover group-hover:scale-105 transition-transform", alt: member.name %>
                        <% else %>
                          <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-400 to-pink-600">
                            <span class="text-xl font-bold text-white"><%= member.initials %></span>
                          </div>
                        <% end %>
                      <% else %>
                        <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-400 to-pink-600">
                          <span class="text-xl font-bold text-white"><%= member.initials %></span>
                        </div>
                      <% end %>
                    </div>
                    <p class="text-xs font-medium text-gray-900 group-hover:text-pink-600 transition-colors truncate"><%= member.name %></p>
                    <% if member.is_a?(Group) %>
                      <p class="text-xs text-gray-500 truncate">Group</p>
                    <% end %>
                  <% end %>
                <% else %>
                  <div class="text-center">
                    <div class="aspect-square rounded-lg overflow-hidden bg-gray-100 mb-2">
                      <% if member.primary_headshot&.image&.attached? %>
                        <% headshot_variant = member.primary_headshot.safe_image_variant(:small) %>
                        <% if headshot_variant %>
                          <%= image_tag headshot_variant, class: "w-full h-full object-cover", alt: member.name %>
                        <% else %>
                          <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-300 to-gray-400">
                            <span class="text-xl font-bold text-white"><%= member.initials %></span>
                          </div>
                        <% end %>
                      <% else %>
                        <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-300 to-gray-400">
                          <span class="text-xl font-bold text-white"><%= member.initials %></span>
                        </div>
                      <% end %>
                    </div>
                    <p class="text-xs font-medium text-gray-700 truncate"><%= member.name %></p>
                    <% if member.is_a?(Group) %>
                      <p class="text-xs text-gray-500 truncate">Group</p>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>

    <%# Upcoming Shows Section %>
    <% if @upcoming_shows.any? %>
      <% shows_cache_key = ["production_shows_v2", @production.id, @upcoming_shows.map(&:updated_at).max] %>
      <% cache shows_cache_key do %>
        <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-900">Upcoming Shows & Events</h2>
          </div>
          <div class="p-4 space-y-1">
            <% @upcoming_shows.each do |show| %>
              <%= render partial: "shared/show_row", locals: {
                show: show,
                link_path: public_profile_show_path(@production.public_key, show.id),
                show_location: true
              } %>
            <% end %>
          </div>
      </div>
      <% end %>
    <% end %>

    <%# Footer %>
    <div class="text-center text-sm text-gray-400 mt-8">
      Powered by <a href="<%= root_path %>" class="text-pink-500 hover:text-pink-600">CocoScout</a>
    </div>

  </div>
</div>